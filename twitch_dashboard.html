<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Live Dashboard</title>
    <style>
        :root {
            --animation-duration: 0.5s;
            --transition-duration: 0.3s;
            --shadow-intensity: 0.15;
            --twitch-purple: #9146ff;
            --twitch-dark: #0e0e10;
            --twitch-gray: #18181b;
            
            /* Zero to One Phase Colors */
            --phase-zero: #ff6b6b;
            --phase-first: #4ecdc4;
            --phase-building: #45b7d1;
            --phase-urgent: #ff9f43;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #9146ff 0%, #0e0e10 50%, #18181b 100%);
            color: white;
            overflow-x: hidden;
        }

        /* Zero to One Phase System - Single Layout with Phase Control */
        #dashboard-container {
            transition: all var(--transition-duration) ease-in-out;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }


        /* Modern Circular Chat Score Gauge */
        .chat-score-gauge-enhanced {
            margin: 3rem auto 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            max-width: 450px;
            position: relative;
            display: flex !important;
            flex-direction: column;
            align-items: center;
            gap: 2.5rem;
            order: 2;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10;
            background: linear-gradient(135deg, rgba(12, 12, 22, 0.98), rgba(22, 22, 32, 0.98));
            backdrop-filter: blur(25px);
            border-radius: 28px;
            padding: 3rem 2.5rem;
            border: 2px solid rgba(145, 70, 255, 0.4);
            box-shadow: 
                0 16px 50px rgba(0, 0, 0, 0.4),
                0 6px 20px rgba(145, 70, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .chat-score-gauge-enhanced:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                0 8px 25px rgba(145, 70, 255, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* AI Prompt Area - Single Instance */
        .ai-prompt-area-enhanced {
            margin-bottom: 4rem;
            max-width: 600px;
            width: 100%;
            transition: all var(--transition-duration) ease-in-out;
            order: 1;
        }

        /* Main Metrics Grid - Single Instance */
        .main-metrics-grid {
            width: 100%;
            transition: all var(--transition-duration) ease-in-out;
            order: 3;
        }

        .key-metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
        }

        .analytics-grid .community-column,
        .analytics-grid .metrics-column,
        .analytics-grid .revenue-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* PHASE-BASED VISIBILITY CONTROL */

        /* ZERO VIEWERS PHASE - Minimalist Screen */
        .phase-zero_viewers {
            justify-content: center;
            text-align: center;
        }

        .phase-zero_viewers .chat-score-gauge-enhanced {
            transform: scale(1.5);
            transform-origin: center center;
            margin-bottom: 3rem;
        }

        .phase-zero_viewers .ai-prompt-area-enhanced {
            transform: scale(1.1);
            margin-bottom: 5rem;
        }

        .phase-zero_viewers .ai-prompt-header {
            background: linear-gradient(135deg, var(--phase-zero) 0%, #ff8a80 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .phase-zero_viewers .ai-prompt-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
        }

        .phase-zero_viewers .ai-prompt-phase {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .phase-zero_viewers .main-metrics-grid {
            display: none;
        }

        /* FIRST VIEWER PHASE - Celebration Screen */
        .phase-first_viewer {
            background: linear-gradient(135deg, var(--phase-first) 0%, #2c3e50 100%);
            border-radius: 20px;
            padding: 3rem;
        }


        .phase-first_viewer .chat-score-gauge-enhanced {
            transform: scale(1.2);
            transform-origin: center center;
            margin: 4rem auto 2rem;
        }

        .phase-first_viewer .ai-prompt-area-enhanced {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: urgentPulse 2s infinite;
        }

        .phase-first_viewer .main-metrics-grid {
            display: none;
        }

        /* BUILDING AUDIENCE PHASE - Full Dashboard */
        .phase-building_audience {
            align-items: flex-start;
            text-align: left;
        }


        .phase-building_audience .chat-score-gauge-enhanced {
            transform: scale(1);
            margin-bottom: 1rem;
        }

        .phase-building_audience .ai-prompt-area-enhanced {
            transform: scale(1);
            margin-bottom: 1rem;
        }

        .phase-building_audience .main-metrics-grid {
            display: block;
        }

        /* Desktop Spacing Enhancements */
        @media (min-width: 1200px) {
            .ai-prompt-area-enhanced {
                margin-bottom: 5rem;
            }
            
            .chat-score-gauge-enhanced {
                margin: 4rem auto 3rem;
            }
            
            .phase-zero_viewers .ai-prompt-area-enhanced {
                margin-bottom: 6rem;
            }
            
            .phase-zero_viewers .chat-score-gauge-enhanced {
                margin: 5rem auto 3rem;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .analytics-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            #dashboard-container {
                padding: 1rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .phase-zero_viewers .chat-score-gauge-enhanced {
                transform: scale(1.2);
                transform-origin: center center;
            }
            
            .key-metrics-row {
                grid-template-columns: 1fr;
            }
            
            .ai-prompt-area-enhanced {
                margin-bottom: 3rem;
            }
            
            .chat-score-gauge-enhanced {
                margin: 2rem auto 1rem;
                padding: 2rem 1.5rem;
            }
            
            .circular-gauge-container {
                width: 220px;
                height: 220px;
            }
            
            .gauge-center {
                width: 160px;
                height: 160px;
            }
            
            .gauge-score {
                font-size: 2.2rem;
            }
            
            .gauge-needle {
                height: 70px;
            }
            
            .gauge-levels-container {
                max-width: 280px;
                gap: 0.25rem;
            }
            
            .gauge-level {
                min-width: 45px;
                padding: 0.25rem;
            }
            
            .level-text {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .chat-score-gauge-enhanced {
                padding: 1.5rem 1rem;
                margin: 1.5rem auto 1rem;
            }
            
            .circular-gauge-container {
                width: 200px;
                height: 200px;
            }
            
            .gauge-center {
                width: 140px;
                height: 140px;
            }
            
            .gauge-score {
                font-size: 2rem;
            }
            
            .gauge-needle {
                height: 60px;
            }
            
            .gauge-levels-container {
                max-width: 240px;
                gap: 0.1rem;
            }
            
            .gauge-level {
                min-width: 40px;
                padding: 0.2rem;
            }
            
            .level-text {
                font-size: 0.65rem;
            }
        }

        /* First Viewer Alert - Full Screen Celebration */
        .first-viewer-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--phase-first) 0%, #2c3e50 100%);
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: firstViewerCelebration 3s ease-in-out;
        }

        .first-viewer-alert.show {
            display: flex;
        }

        .first-viewer-content {
            text-align: center;
            animation: bounceIn 1s ease-out;
        }

        .first-viewer-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: pulse 2s infinite;
        }

        .first-viewer-message {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .first-viewer-close {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .first-viewer-close:hover {
            background: white;
            color: var(--phase-first);
        }

        @keyframes firstViewerCelebration {
            0% { opacity: 0; transform: scale(0.8); }
            20% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }


        /* Enhanced AI Prompt Area with ABT Coach */
        .ai-prompt-area-enhanced {
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.1) 0%, rgba(0, 0, 0, 0.3) 100%);
            border: 2px solid var(--twitch-purple);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        /* ABT Coach Timer */
        .abt-timer-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(145, 70, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(145, 70, 255, 0.2);
        }

        .abt-timer-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff4444 0deg,
                #ff8800 90deg,
                #88ff88 180deg,
                #00ddff 270deg,
                #ff4444 360deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: timerPulse 1s ease-in-out infinite;
        }

        .abt-timer-inner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(10, 10, 20, 0.95), rgba(20, 20, 30, 0.95));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.8);
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .abt-timer-text {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .abt-mute-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .abt-mute-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .abt-mute-toggle.muted {
            background: rgba(255, 68, 68, 0.2);
            border-color: rgba(255, 68, 68, 0.4);
            color: #ff6b6b;
        }

        /* First Viewer Catcher */
        .first-viewer-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.95), rgba(145, 70, 255, 0.95));
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: firstViewerCelebration 3s ease-in-out;
        }

        .first-viewer-alert.show {
            display: flex;
        }

        @keyframes firstViewerCelebration {
            0% { 
                opacity: 0; 
                transform: scale(0.8);
            }
            20% { 
                opacity: 1; 
                transform: scale(1.1);
            }
            80% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(1);
            }
        }

        .first-viewer-content {
            text-align: center;
            color: white;
            z-index: 10001;
        }

        .first-viewer-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            animation: titleBounce 1s ease-in-out infinite alternate;
        }

        @keyframes titleBounce {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .first-viewer-message {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .first-viewer-greeting {
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .first-viewer-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .first-viewer-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .first-viewer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* Confetti Animation */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confettiFall 3s linear infinite;
        }

        .confetti:nth-child(odd) {
            background: #4ecdc4;
            animation-delay: -0.5s;
        }

        .confetti:nth-child(even) {
            background: #45b7d1;
            animation-delay: -1s;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Persistence Engine - Milestones */
        .milestones-section {
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.95), rgba(30, 30, 45, 0.95));
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(145, 70, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .milestones-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1.5rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.5);
        }

        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .milestone-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .milestone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(145, 70, 255, 0.2);
        }

        .milestone-card.completed {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(145, 70, 255, 0.2));
            border-color: rgba(78, 205, 196, 0.4);
        }

        .milestone-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .milestone-icon {
            font-size: 1.5rem;
        }

        .milestone-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }

        .milestone-progress {
            margin-bottom: 1rem;
        }

        .milestone-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .milestone-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .milestone-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .milestone-progress-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 0.5rem;
            text-align: center;
        }

        .milestone-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.4;
        }

        .milestone-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Stream Summary */
        .stream-summary {
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid rgba(145, 70, 255, 0.2);
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
            text-align: center;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .summary-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .summary-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 0.5rem;
        }

        .summary-stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .ai-prompt-area-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }

        .ai-prompt-area-enhanced.urgent {
            border-color: var(--phase-urgent);
            background: linear-gradient(135deg, rgba(255, 159, 67, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
            animation: urgentPulse 1s infinite;
        }

        .ai-prompt-area-enhanced.high-priority {
            border-color: var(--phase-first);
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 159, 67, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 159, 67, 0.8); }
        }

        /* Phase-specific visibility */
        .phase-zero_viewers .metric-card:not(.chat-score-card):not(.ai-prompt-card):not(.chat-score-gauge-enhanced),
        .phase-zero_viewers .revenue-metrics,
        .phase-zero_viewers .top-users,
        .phase-zero_viewers .chat-activity-log {
            display: none !important;
        }

        /* Ensure gauge is always visible */
        .chat-score-gauge-enhanced {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        .phase-first_viewer .first-viewer-alert {
            display: flex;
        }

        .phase-building_audience .metric-card,
        .phase-building_audience .revenue-metrics,
        .phase-building_audience .top-users,
        .phase-building_audience .chat-activity-log {
            display: block;
        }


        /* Header Styles */
        .header {
            background: rgba(14, 14, 16, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--twitch-purple);
            box-shadow: 0 4px 20px rgba(145, 70, 255, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(145, 70, 255, 0.8);
        }

        .header h1 .emoji {
            font-size: 2.8rem;
            margin-right: 15px;
            filter: drop-shadow(0 0 10px rgba(145, 70, 255, 0.6));
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        /* Channel Input Display */
        .channel-input-display {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .channel-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .channel-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .channel-input-group label {
            font-size: 0.9rem;
            color: #ccc;
            font-weight: 500;
        }

        .channel-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(145, 70, 255, 0.3);
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .channel-input:focus {
            outline: none;
            border-color: var(--twitch-purple);
            box-shadow: 0 0 15px rgba(145, 70, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .channel-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .connect-btn {
            background: linear-gradient(135deg, var(--twitch-purple), #7c3aed);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.3);
            min-width: 120px;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(145, 70, 255, 0.4);
            background: linear-gradient(135deg, #a855f7, var(--twitch-purple));
        }

        .connect-btn:active {
            transform: translateY(0);
        }

        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-connected { color: #4CAF50; }
        .status-connecting { color: #FFC107; }
        .status-disconnected { color: #f44336; }

        /* Session Info Display */
        .session-info-display {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .session-info {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.95rem;
            justify-content: center;
        }

        .session-info span {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0;
            background: none;
            border: none;
        }

        .session-id { color: #4CAF50; font-weight: 600; }
        .session-status { color: #FFC107; font-weight: 600; }
        .session-username { color: #2196F3; font-weight: 600; }
        .session-topic { color: #FF9800; font-weight: 600; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .total-sessions { color: #9C27B0; font-weight: 600; }
        .last-update { color: #607D8B; font-weight: 600; font-size: 12px; }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 8px;
            margin: 20px;
            border: 2px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .language-btn {
            background: rgba(145, 70, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(145, 70, 255, 0.3);
        }

        .language-btn:hover {
            background: rgba(145, 70, 255, 0.4);
            transform: translateY(-2px);
        }

        .language-btn.active {
            background: var(--twitch-purple);
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.4);
        }

        /* Tier 2: Current State Panel */
        .current-state-panel {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .current-state-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .community-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .alerts-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Tier 3: Strategic View Panel */
        .strategic-view-panel {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default */
        }

        .strategic-view-panel.visible {
            display: block;
        }

        .strategic-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--twitch-purple), #7c3aed);
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.3);
            z-index: 1000;
        }

        .strategic-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(145, 70, 255, 0.4);
        }

        /* Main Dashboard Grid (Legacy) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Metric Cards */
        .metric-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(145, 70, 255, 0.3);
            border-color: rgba(145, 70, 255, 0.6);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--twitch-purple), #ffffff);
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.3);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(145, 70, 255, 0.6);
            transition: all 0.3s ease;
        }

        .metric-value.updated {
            animation: valueUpdate 0.5s ease;
        }

        @keyframes valueUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .metric-subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .trend-up { color: #4CAF50; }
        .trend-down { color: #f44336; }
        .trend-stable { color: #FFC107; }

        /* Twitch Specific Metrics */
        .twitch-metrics {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .twitch-metric {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .twitch-metric:hover {
            background: rgba(145, 70, 255, 0.2);
            transform: scale(1.05);
        }

        .twitch-metric-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .twitch-metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.5);
        }

        .twitch-metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Chat Activity */
        .chat-activity {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .chat-message {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-left: 3px solid var(--twitch-purple);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .chat-username {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-right: 10px;
        }

        .chat-text {
            color: #ffffff;
        }

        .chat-timestamp {
            font-size: 0.8rem;
            opacity: 0.6;
            float: right;
        }

        /* Top Users */
        .top-users {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-item {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .user-item:hover {
            background: rgba(145, 70, 255, 0.2);
            transform: translateY(-2px);
        }

        .user-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Revenue Metrics */
        .revenue-metrics {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .revenue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        /* Revenue Breakdown */
        .revenue-breakdown {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .breakdown-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFC107;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .breakdown-item.total {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            font-weight: 600;
        }
        
        .breakdown-label {
            color: #E0E0E0;
            font-size: 14px;
        }
        
        .breakdown-value {
            color: #4CAF50;
            font-weight: 600;
            font-size: 14px;
        }
        
        .breakdown-item.total .breakdown-value {
            color: #FFC107;
            font-size: 16px;
        }

        /* AI Prompts */
        .ai-prompts {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .prompt-item {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid var(--twitch-purple);
        }

        .prompt-type {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-bottom: 5px;
        }

        .prompt-message {
            color: #ffffff;
            margin-bottom: 5px;
        }

        .prompt-timestamp {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }

        .status-online { 
            background: #4CAF50; 
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            animation: pulse-green 2s infinite;
        }
        .status-offline { 
            background: #f44336; 
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.6);
        }
        .status-connecting { 
            background: #FFC107; 
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
            animation: pulse-yellow 1s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes pulse-yellow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .current-state-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .urgent-content {
                flex-direction: column;
                gap: 15px;
                height: auto;
                padding: 15px 0;
            }
            
            .ai-prompt-area {
                flex: 1;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
        }

        @media (max-width: 768px) {
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .metric-value {
                font-size: 2rem;
            }
            
            .strategic-toggle {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(145, 70, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--twitch-purple);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Live Chat Score Gauge */
        .chat-score-gauge {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        /* Gauge Title Section */
        .gauge-title-section {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .gauge-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0 0 0.8rem 0;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        .gauge-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            font-weight: 500;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.3px;
        }

        /* Circular Gauge Container */
        .circular-gauge-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Desktop-specific gauge styling */
        @media (min-width: 769px) {
            .circular-gauge-container {
                width: 280px;
                height: 280px;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .gauge-ring {
                width: 280px;
                height: 280px;
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .gauge-center {
                width: 200px;
                height: 200px;
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .gauge-score {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .gauge-needle {
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
        }

        .gauge-ring {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: rgba(20, 20, 30, 0.8);
            position: relative;
            display: flex !important;
            align-items: center;
            justify-content: center;
            visibility: visible !important;
            opacity: 1 !important;
            box-shadow: 
                0 0 40px rgba(145, 70, 255, 0.6),
                0 0 80px rgba(145, 70, 255, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 0.4);
            animation: gaugeGlow 4s ease-in-out infinite alternate;
            margin: 0 auto;
            border: 4px solid rgba(145, 70, 255, 0.6);
            min-width: 280px;
            min-height: 280px;
            max-width: 280px;
            max-height: 280px;
        }

        .gauge-progress {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 240px;
            height: 240px;
            border-radius: 50%;
            background: conic-gradient(
                from -90deg,
                #ff4757 0deg,
                #ff6b35 20deg,
                #feca57 40deg,
                #48dbfb 60deg,
                #0abde3 80deg,
                #3742fa 100deg,
                #2f3542 120deg,
                #ff4757 140deg,
                #ff6b35 160deg,
                #feca57 180deg,
                #48dbfb 200deg,
                #0abde3 220deg,
                #3742fa 240deg,
                #2f3542 260deg,
                #ff4757 280deg,
                #ff6b35 300deg,
                #feca57 320deg,
                #48dbfb 340deg,
                #0abde3 360deg
            );
            transform: translate(-50%, -50%);
            z-index: 1;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            mask: radial-gradient(circle at center, transparent 60%, black 60%);
            -webkit-mask: radial-gradient(circle at center, transparent 60%, black 60%);
        }

        @keyframes gaugeGlow {
            0% { box-shadow: 0 0 25px rgba(145, 70, 255, 0.4), inset 0 0 15px rgba(0, 0, 0, 0.3); }
            100% { box-shadow: 0 0 35px rgba(145, 70, 255, 0.6), inset 0 0 20px rgba(0, 0, 0, 0.4); }
        }

        .gauge-progress {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from -90deg,
                transparent 0deg,
                transparent 180deg,
                rgba(145, 70, 255, 0.3) 180deg,
                rgba(145, 70, 255, 0.3) 360deg
            );
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .gauge-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(8, 8, 18, 0.98), rgba(18, 18, 28, 0.98));
            display: flex !important;
            align-items: center;
            justify-content: center;
            z-index: 2;
            visibility: visible !important;
            opacity: 1 !important;
            border: 4px solid rgba(145, 70, 255, 0.4);
            box-shadow: 
                inset 0 0 30px rgba(0, 0, 0, 0.7),
                0 0 25px rgba(145, 70, 255, 0.3),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
        }

        .gauge-score {
            font-size: 3.2rem;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 
                0 0 30px rgba(255, 255, 255, 0.9),
                0 0 60px rgba(145, 70, 255, 0.6),
                0 4px 8px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 4;
            visibility: visible !important;
            opacity: 1 !important;
            display: block !important;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .gauge-score.updated {
            animation: scorePulse 0.6s ease;
        }

        @keyframes scorePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .gauge-needle {
            position: absolute;
            width: 6px;
            height: 100px;
            background: linear-gradient(to top, #ffffff, #ff6b6b, #9146ff, #00d4ff);
            border-radius: 3px;
            transform-origin: bottom center;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3;
            visibility: visible !important;
            opacity: 1 !important;
            display: block !important;
            box-shadow: 
                0 0 15px rgba(255, 255, 255, 0.8),
                0 0 30px rgba(145, 70, 255, 0.6),
                0 0 45px rgba(0, 212, 255, 0.4);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
        }

        /* Gauge Levels */
        .gauge-levels-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
            gap: 0.8rem;
            padding: 1rem 0;
        }

        .gauge-level {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            padding: 0.8rem;
            border-radius: 12px;
            min-width: 60px;
        }

        .gauge-level:hover {
            color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
            background: rgba(145, 70, 255, 0.1);
        }

        .gauge-level.active {
            color: #ffffff;
            transform: translateY(-2px) scale(1.05);
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.2), rgba(145, 70, 255, 0.1));
            box-shadow: 0 4px 12px rgba(145, 70, 255, 0.3);
        }

        .level-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .gauge-level.active .level-dot {
            background: linear-gradient(135deg, #ffffff, #9146ff, #00d4ff);
            box-shadow: 
                0 0 20px rgba(255, 255, 255, 0.9),
                0 0 40px rgba(145, 70, 255, 0.6),
                0 0 60px rgba(0, 212, 255, 0.4);
            transform: scale(1.3);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        .level-text {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Chat Score Animation */
        .gauge-score.updated {
            animation: scorePulse 0.6s ease;
        }

        @keyframes scorePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Strategic Metrics Styling */
        .strategic-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .recommendation-card {
            background: rgba(145, 70, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            background: rgba(145, 70, 255, 0.15);
            transform: translateY(-2px);
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-text {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .health-score-excellent {
            color: #4CAF50;
        }

        .health-score-good {
            color: #FFC107;
        }

        .health-score-poor {
            color: #f44336;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--twitch-purple);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>
    <!-- First Viewer Alert - Full Screen Celebration -->
    <div class="first-viewer-alert" id="firstViewerAlert">
        <div class="first-viewer-content">
            <div class="first-viewer-title"> FIRST VIEWER! </div>
            <div class="first-viewer-message" id="firstViewerMessage">
                Someone just joined your stream!<br>
                This is the beginning of your community!
            </div>
            <button class="first-viewer-close" onclick="closeFirstViewerAlert()">
                Continue Streaming
            </button>
        </div>
    </div>


    <div class="header">
        <h1><span class="emoji"></span>Twitch Live Dashboard</h1>
        <p>Real-time analytics and engagement tracking for your Twitch stream</p>
    </div>

    <!-- Channel Input -->
    <div class="channel-input-display">
        <div class="channel-input-container">
            <div class="channel-input-group">
                <label for="channelInput">Twitch Channel</label>
                <input 
                    type="text" 
                    id="channelInput" 
                    class="channel-input" 
                    placeholder="Enter channel name (e.g., kamet0)"
                    value=""
                >
            </div>
            <button id="connectBtn" class="connect-btn">
                <span id="connectBtnText">Connect</span>
            </button>
            <div class="connection-status">
                <span id="connectionStatus" class="status-disconnected"></span>
                <span id="connectionText">Not Connected</span>
            </div>
        </div>
    </div>

    <!-- Session Info -->
    <div class="session-info-display">
        <div class="session-info">
            <span class="session-id">Session: <span id="sessionId">Loading...</span></span>
            <span class="session-status">Status: <span id="sessionStatus" class="status-indicator status-disconnected"></span><span id="statusText">Not Connected</span></span>
            <span class="session-username">Channel: <span id="channelName">No Channel</span></span>
            <span class="session-topic">Topic: <span id="streamTopic">No Stream</span></span>
            <span class="total-sessions">Uptime: <span id="uptime">00:00:00</span></span>
            <span class="last-update">Last Update: <span id="lastUpdate">--:--:--</span></span>
        </div>
    </div>

    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="language-btn active" onclick="setLanguage('en')"> English</button>
        <button class="language-btn" onclick="setLanguage('fr')"> Franais</button>
        <button class="language-btn" onclick="setLanguage('es')"> Espaol</button>
        <button class="language-btn" onclick="setLanguage('de')"> Deutsch</button>
    </div>

    <!-- Main Dashboard Container - Single Layout with Phase Control -->
    <div id="dashboard-container" class="phase-zero_viewers">
        
        <!-- AI Prompt Area with ABT Coach - Single Instance (Above Gauge) -->
        <div class="ai-prompt-area-enhanced ai-prompt-card" id="aiPromptAreaEnhanced">
            <!-- ABT Coach Timer -->
            <div class="abt-timer-container" id="abtTimerContainer" style="display: none;">
                <div class="abt-timer-circle">
                    <div class="abt-timer-inner" id="abtTimerDisplay">30</div>
                </div>
                <div class="abt-timer-text">Next prompt in</div>
                <button class="abt-mute-toggle" id="abtMuteToggle"> Mute</button>
            </div>
            
            <div class="ai-prompt-header">
                <div class="ai-prompt-title"> Your AI Co-Pilot</div>
                <div class="ai-prompt-phase" id="aiPromptPhase">Zero Viewers</div>
            </div>
            <div class="ai-prompt-content">
                <div class="ai-prompt-message" id="aiPromptMessage">Keep talking! Your audience will find you.</div>
                <div class="ai-prompt-priority" id="aiPromptPriority">Normal</div>
            </div>
        </div>

        <!-- Modern Circular Chat Score Gauge -->
        <div class="chat-score-gauge-enhanced" id="chatScoreGaugeEnhanced">
            <!-- Gauge Title -->
            <div class="gauge-title-section">
                <h3 class="gauge-title">Chat Score</h3>
                <p class="gauge-subtitle" id="gaugeSubtitle">Keep the conversation flowing!</p>
                </div>
                
            <!-- Circular Gauge -->
            <div class="circular-gauge-container">
                <div class="gauge-ring">
                    <div class="gauge-progress" id="gaugeProgress"></div>
                    <div class="gauge-center">
                        <div class="gauge-score" id="gaugeScoreEnhanced">0</div>
                    </div>
                    <div class="gauge-needle" id="gaugeNeedleEnhanced"></div>
                </div>
            </div>
            
            <!-- Gauge Levels -->
            <div class="gauge-levels-container">
                <div class="gauge-level" data-level="1">
                    <span class="level-dot"></span>
                    <span class="level-text">Low</span>
                </div>
                <div class="gauge-level" data-level="2">
                    <span class="level-dot"></span>
                    <span class="level-text">Med</span>
                </div>
                <div class="gauge-level" data-level="3">
                    <span class="level-dot"></span>
                    <span class="level-text">Good</span>
                </div>
                <div class="gauge-level" data-level="4">
                    <span class="level-dot"></span>
                    <span class="level-text">High</span>
                </div>
                <div class="gauge-level" data-level="5">
                    <span class="level-dot"></span>
                    <span class="level-text">Max</span>
                </div>
            </div>
            </div>
            
        <!-- First Viewer Catcher Alert -->
        <div class="first-viewer-alert" id="firstViewerAlert">
            <div class="first-viewer-content">
                <div class="first-viewer-title"> FIRST VIEWER!</div>
                <div class="first-viewer-message">Someone just joined your stream!</div>
                <div class="first-viewer-greeting" id="firstViewerGreeting">Welcome to the stream!</div>
                <div class="first-viewer-actions">
                    <button class="first-viewer-btn" onclick="copyGreeting()"> Copy Greeting</button>
                    <button class="first-viewer-btn" onclick="hideFirstViewerAlert()">Continue</button>
                </div>
            </div>
            <!-- Confetti -->
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
        </div>

        <!-- Persistence Engine - Milestones Section -->
        <div class="milestones-section" id="milestonesSection" style="display: none;">
            <div class="milestones-title"> Your Journey Milestones</div>
            <div class="milestones-grid" id="milestonesGrid">
                <!-- Milestones will be populated by JavaScript -->
            </div>
            <div class="stream-summary" id="streamSummary">
                <div class="summary-title"> Session Summary</div>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="totalStreamTime">0m</div>
                        <div class="summary-stat-label">Stream Time</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="uniqueViewers">0</div>
                        <div class="summary-stat-label">Unique Viewers</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="messagesSent">0</div>
                        <div class="summary-stat-label">Messages Sent</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="milestonesReached">0</div>
                        <div class="summary-stat-label">Milestones</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Metrics Grid - Single Instance -->
        <div class="main-metrics-grid">
            <!-- Key Metrics Row -->
            <div class="key-metrics-row">
                <div class="metric-card">
                    <div class="metric-title"> Current Viewers</div>
                    <div class="metric-value" id="currentViewers">0</div>
                    <div class="metric-subtitle">Live viewer count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title"> Peak Viewers</div>
                    <div class="metric-value" id="peakViewers">0</div>
                    <div class="metric-subtitle">Highest viewer count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title"> Messages/Min</div>
                    <div class="metric-value" id="messagesPerMinute">0</div>
                    <div class="metric-subtitle">Chat activity rate</div>
                </div>
            </div>

            <!-- Analytics Grid -->
            <div class="analytics-grid">
                <!-- Community Column -->
                <div class="community-column">
                    <div class="top-users">
                        <div class="metric-title"> Top Engaged Users</div>
                        <div class="user-list" id="topUsers">
                            <div class="user-item">
                                <div class="user-name">Loading...</div>
                                <div class="user-stats">
                                    <span>Messages: 0</span>
                                    <span>Bits: 0</span>
                                    <span>Subs: 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chat-activity">
                        <div class="metric-title"> Recent Chat Activity</div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message">
                                <span class="chat-username">System:</span>
                                <span class="chat-text">Waiting for chat messages...</span>
                                <span class="chat-timestamp">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Column -->
                <div class="metrics-column">
                    <div class="metric-card">
                        <div class="metric-title"> Stream Status</div>
                        <div class="metric-value" id="streamStatus">Offline</div>
                        <div class="metric-subtitle">Current stream status</div>
                        <div class="metric-trend">
                            <span class="status-indicator status-offline"></span>
                            <span id="streamStatusText">Not streaming</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title"> Total Subs</div>
                        <div class="metric-value" id="totalSubsMain">0</div>
                        <div class="metric-subtitle">Total subscriptions</div>
                        <div class="metric-trend">
                            <span class="trend-indicator" id="subsTrend">+0 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title"> Total Followers</div>
                        <div class="metric-value" id="totalFollowers">0</div>
                        <div class="metric-subtitle">Channel total followers</div>
                        <div class="metric-trend">
                            <span class="trend-indicator" id="followersTrend">+0 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title"> Stream Revenue</div>
                        <div class="metric-value" id="streamTotalRevenue">$0.00</div>
                        <div class="metric-subtitle">Total earned</div>
                        <div class="metric-trend">
                            <span id="revenueTrend" class="trend-stable"></span>
                            <span id="revenueTrendText">$0.00 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title"> Chat Sentiment</div>
                        <div class="metric-value" id="sentimentScore">0.0</div>
                        <div class="metric-subtitle">Overall chat mood</div>
                        <div class="metric-trend">
                            <span id="sentimentEmoji"></span>
                            <span id="sentimentText">Neutral</span>
                        </div>
                    </div>
                </div>

                <!-- Revenue Column -->
                <div class="revenue-column">
                    <div class="revenue-metrics">
                        <div class="metric-title"> Revenue Metrics</div>
                        <div class="revenue-grid">
                            <div class="metric-card">
                                <div class="metric-title"> Bits Earned</div>
                                <div class="metric-value" id="totalBits">0</div>
                                <div class="metric-subtitle">Total bits this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title"> Subscriptions</div>
                                <div class="metric-value" id="totalSubs">0</div>
                                <div class="metric-subtitle">Total subs this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title"> Raids Received</div>
                                <div class="metric-value" id="totalRaids">0</div>
                                <div class="metric-subtitle">Total raids this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title"> Revenue Rate</div>
                                <div class="metric-value" id="revenueRate">$0.00/hr</div>
                                <div class="metric-subtitle">Estimated hourly rate</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Grid (Legacy - will be moved to Tier 3) -->
    <div class="dashboard-grid" style="display: none;">
        <!-- Stream Status -->
        <div class="metric-card">
            <div class="metric-title"> Stream Status</div>
            <div class="metric-value" id="streamStatus">Offline</div>
            <div class="metric-subtitle">Current stream status</div>
            <div class="metric-trend">
                <span class="status-indicator status-offline"></span>
                <span id="streamStatusText">Not streaming</span>
            </div>
        </div>

        <!-- Current Viewers -->
        <div class="metric-card">
            <div class="metric-title"> Current Viewers</div>
            <div class="metric-value" id="currentViewers">0</div>
            <div class="metric-subtitle">Live viewer count</div>
            <div class="metric-trend">
                <span id="viewerTrend" class="trend-stable"></span>
                <span id="viewerChange">+0</span>
            </div>
        </div>

        <!-- Peak Viewers -->
        <div class="metric-card">
            <div class="metric-title"> Peak Viewers</div>
            <div class="metric-value" id="peakViewers">0</div>
            <div class="metric-subtitle">Highest viewer count</div>
            <div class="metric-trend">
                <span class="trend-up"></span>
                <span id="peakViewerTime">Today</span>
            </div>
        </div>

        <!-- Total Subs -->
        <div class="metric-card">
            <div class="metric-title"> Total Subs</div>
            <div class="metric-value" id="totalSubsMain">0</div>
            <div class="metric-subtitle">Total subscriptions</div>
            <div class="metric-trend">
                <span class="trend-indicator" id="subsTrend">+0 this session</span>
            </div>
        </div>

        <!-- Total Followers -->
        <div class="metric-card">
            <div class="metric-title"> Total Followers</div>
            <div class="metric-value" id="totalFollowers">0</div>
            <div class="metric-subtitle">Channel total followers</div>
            <div class="metric-trend">
                <span class="trend-indicator" id="followersTrend">+0 this session</span>
            </div>
        </div>

        <!-- Stream Total Revenue -->
        <div class="metric-card">
            <div class="metric-title"> Stream Revenue</div>
            <div class="metric-value" id="streamTotalRevenue">$0.00</div>
            <div class="metric-subtitle">Total earned</div>
            <div class="metric-trend">
                <span id="revenueTrend" class="trend-stable"></span>
                <span id="revenueTrendText">$0.00 this session</span>
            </div>
        </div>

        <!-- Twitch Specific Metrics -->
        <div class="twitch-metrics">
            <div class="twitch-metric">
                <div class="twitch-metric-icon"></div>
                <div class="twitch-metric-value" id="newFollowers">0</div>
                <div class="twitch-metric-label">New Followers</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon"></div>
                <div class="twitch-metric-value" id="newSubs">0</div>
                <div class="twitch-metric-label">New Subs</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon"></div>
                <div class="twitch-metric-value" id="bitsEarned">0</div>
                <div class="twitch-metric-label">Bits Earned</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon"></div>
                <div class="twitch-metric-value" id="raidsReceived">0</div>
                <div class="twitch-metric-label">Raids Received</div>
            </div>
        </div>

        <!-- Enhanced Live Chat Score Gauge for Zero to One -->
        <div class="chat-score-gauge chat-score-card">
            <div class="metric-title"> Live Chat Score</div>
            <div class="gauge-container">
                <div class="gauge-circle chat-score-gauge-enhanced">
                    <div class="gauge-inner">
                        <div class="gauge-score" id="chatScore">0</div>
                    </div>
                    <div class="gauge-needle" id="gaugeNeedle"></div>
                    <div class="gauge-center"></div>
                </div>
            </div>
            <div class="gauge-levels">
                <div class="gauge-level" id="level1">
                    <div class="gauge-level-dot"></div>
                    <span> Quiet</span>
                </div>
                <div class="gauge-level" id="level2">
                    <div class="gauge-level-dot"></div>
                    <span> Low</span>
                </div>
                <div class="gauge-level" id="level3">
                    <div class="gauge-level-dot"></div>
                    <span> Moderate</span>
                </div>
                <div class="gauge-level" id="level4">
                    <div class="gauge-level-dot"></div>
                    <span> High</span>
                </div>
                <div class="gauge-level" id="level5">
                    <div class="gauge-level-dot"></div>
                    <span> Fire</span>
                </div>
            </div>
        </div>

        <!-- Enhanced AI Prompt Area for Zero to One -->
        <div class="ai-prompt-area-enhanced ai-prompt-card" id="aiPromptAreaEnhanced">
            <div class="ai-prompt-header">
                <h3> AI Co-Pilot</h3>
                <div class="ai-prompt-phase" id="aiPromptPhase">Zero Viewers</div>
            </div>
            <div class="ai-prompt-content" id="aiPromptContent">
                <div class="ai-prompt-message" id="aiPromptMessage">
                    Keep talking! Even with no visible chat, you never know who might be lurking. Share your thoughts, ask questions, or talk about what you're passionate about!
                </div>
                <div class="ai-prompt-priority" id="aiPromptPriority">high</div>
            </div>
        </div>

        <!-- Stream Info -->
        <div class="metric-card">
            <div class="metric-title"> Chat score</div>
            <div class="metric-subtitle">Title: <span id="streamTitle">No stream</span></div>
            <div class="metric-subtitle">Game: <span id="gameCategory">Not set</span></div>
            <div class="metric-subtitle">Language: <span id="streamLanguage">en</span></div>
            <div class="metric-subtitle">Started: <span id="streamStartTime">Not started</span></div>
        </div>

        <!-- Sentiment Analysis -->
        <div class="metric-card">
            <div class="metric-title"> Chat Sentiment</div>
            <div class="metric-value" id="sentimentScore">0.0</div>
            <div class="metric-subtitle">Overall chat mood</div>
            <div class="metric-trend">
                <span id="sentimentEmoji"></span>
                <span id="sentimentText">Neutral</span>
            </div>
        </div>

        <!-- Chat Activity -->
        <div class="chat-activity">
            <div class="metric-title"> Recent Chat Activity</div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message">
                    <span class="chat-username">System:</span>
                    <span class="chat-text">Waiting for chat messages...</span>
                    <span class="chat-timestamp">--:--</span>
                </div>
            </div>
        </div>

        <!-- Top Engaged Users -->
        <div class="top-users">
            <div class="metric-title"> Top Engaged Users</div>
            <div class="user-list" id="topUsers">
                <div class="user-item">
                    <div class="user-name">Loading...</div>
                    <div class="user-stats">
                        <span>Messages: 0</span>
                        <span>Bits: 0</span>
                        <span>Subs: 0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Metrics -->
        <div class="revenue-metrics">
            <div class="metric-title"> Revenue Metrics</div>
            <div class="revenue-grid">
                <div class="metric-card">
                    <div class="metric-title"> Bits Earned</div>
                    <div class="metric-value" id="totalBits">0</div>
                    <div class="metric-subtitle">Total bits this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title"> Subscriptions</div>
                    <div class="metric-value" id="totalSubs">0</div>
                    <div class="metric-subtitle">Total subs this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title"> Raids Received</div>
                    <div class="metric-value" id="totalRaids">0</div>
                    <div class="metric-subtitle">Total raids this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                    </div>
                </div>
                
                   <div class="metric-card">
                       <div class="metric-title"> Revenue Rate</div>
                       <div class="metric-value" id="revenueRate">$0.00/hr</div>
                       <div class="metric-subtitle">Estimated hourly rate</div>
                       <div class="metric-trend">
                           <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                       </div>
                   </div>
               </div>
               
               <!-- Revenue Breakdown -->
               <div class="revenue-breakdown">
                   <div class="breakdown-title"> Revenue Breakdown</div>
                   <div class="breakdown-grid">
                       <div class="breakdown-item">
                           <span class="breakdown-label">Bits Revenue:</span>
                           <span class="breakdown-value" id="bitsRevenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 1 Subs:</span>
                           <span class="breakdown-value" id="tier1Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 2 Subs:</span>
                           <span class="breakdown-value" id="tier2Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 3 Subs:</span>
                           <span class="breakdown-value" id="tier3Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item total">
                           <span class="breakdown-label">Total Revenue:</span>
                           <span class="breakdown-value" id="totalRevenue">$0.00</span>
                       </div>
                   </div>
            </div>
        </div>

        <!-- AI Prompts -->
        <div class="ai-prompts">
            <div class="metric-title"> AI-Generated Prompts</div>
            <div id="aiPrompts">
                <div class="prompt-item">
                    <div class="prompt-type">System</div>
                    <div class="prompt-message">Waiting for AI prompts...</div>
                    <div class="prompt-timestamp">--:--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tier 3: Strategic View Panel -->
    <div class="strategic-view-panel" id="strategicPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="metric-title" style="font-size: 1.5rem; margin: 0;">
                 Strategic Analytics Dashboard
            </div>
            <button onclick="toggleStrategicView()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;">
                 Close
            </button>
        </div>
        
        <!-- Revenue Metrics -->
        <div class="revenue-metrics">
            <div class="metric-title" style="font-size: 1.2rem; margin-bottom: 15px;"> Revenue Metrics</div>
            <div class="revenue-grid">
                <div class="metric-card">
                    <div class="metric-title"> Bits Earned</div>
                    <div class="metric-value" id="totalBits">0</div>
                    <div class="metric-subtitle">Total bits this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title"> Subscriptions</div>
                    <div class="metric-value" id="totalSubs">0</div>
                    <div class="metric-subtitle">Total subs this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title"> Raids Received</div>
                    <div class="metric-value" id="totalRaids">0</div>
                    <div class="metric-subtitle">Total raids this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title"> Revenue Rate</div>
                    <div class="metric-value" id="revenueRate">$0.00/hr</div>
                    <div class="metric-subtitle">Estimated hourly rate</div>
                    <div class="metric-trend">
                        <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                    </div>
                </div>
            </div>
            
            <!-- Revenue Breakdown -->
            <div class="revenue-breakdown">
                <div class="breakdown-title"> Revenue Breakdown</div>
                <div class="breakdown-grid">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Bits Revenue:</span>
                        <span class="breakdown-value" id="bitsRevenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 1 Subs:</span>
                        <span class="breakdown-value" id="tier1Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 2 Subs:</span>
                        <span class="breakdown-value" id="tier2Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 3 Subs:</span>
                        <span class="breakdown-value" id="tier3Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item total">
                        <span class="breakdown-label">Total Revenue:</span>
                        <span class="breakdown-value" id="totalRevenue">$0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Chat Score Gauge (Full Version) -->
        <div class="chat-score-gauge">
            <div class="metric-title"> Live Chat Score</div>
            <div class="gauge-container">
                <div class="gauge-circle">
                    <div class="gauge-inner">
                        <div class="gauge-score" id="chatScoreStrategic">0</div>
                    </div>
                    <div class="gauge-needle" id="gaugeNeedleStrategic"></div>
                    <div class="gauge-center"></div>
                </div>
            </div>
            <div class="gauge-levels">
                <div class="gauge-level" id="level1">
                    <div class="gauge-level-dot"></div>
                    <span> Quiet</span>
                </div>
                <div class="gauge-level" id="level2">
                    <div class="gauge-level-dot"></div>
                    <span> Low</span>
                </div>
                <div class="gauge-level" id="level3">
                    <div class="gauge-level-dot"></div>
                    <span> Moderate</span>
                </div>
                <div class="gauge-level" id="level4">
                    <div class="gauge-level-dot"></div>
                    <span> High</span>
                </div>
                <div class="gauge-level" id="level5">
                    <div class="gauge-level-dot"></div>
                    <span> Fire</span>
                </div>
            </div>
        </div>

        <!-- Stream Info -->
        <div class="metric-card">
            <div class="metric-title"> Stream Information</div>
            <div class="metric-subtitle">Title: <span id="streamTitle">No stream</span></div>
            <div class="metric-subtitle">Game: <span id="gameCategory">Not set</span></div>
            <div class="metric-subtitle">Language: <span id="streamLanguage">en</span></div>
            <div class="metric-subtitle">Started: <span id="streamStartTime">Not started</span></div>
        </div>

        <!-- Additional Strategic Metrics -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div class="metric-card">
                <div class="metric-title"> Peak Viewers</div>
                <div class="metric-value" id="peakViewersStrategic">0</div>
                <div class="metric-subtitle">Highest viewer count</div>
                <div class="metric-trend">
                    <span class="trend-up"></span>
                    <span id="peakViewerTimeStrategic">Today</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title"> Stream Duration</div>
                <div class="metric-value" id="streamDuration">00:00:00</div>
                <div class="metric-subtitle">Current session length</div>
                <div class="metric-trend">
                    <span class="trend-stable"></span>
                    <span id="streamDurationText">Live now</span>
                </div>
            </div>
        </div>

        <!-- Strategic Analytics Grid -->
        <div class="strategic-metrics-grid">
            <!-- Health Score -->
            <div class="metric-card">
                <div class="metric-title"> Stream Health Score</div>
                <div class="metric-value" id="healthScore">0</div>
                <div class="metric-subtitle">Overall stream performance</div>
                <div class="metric-trend">
                    <span id="healthScoreText">Calculating...</span>
                </div>
            </div>

            <!-- Predicted Retention -->
            <div class="metric-card">
                <div class="metric-title"> Predicted Retention</div>
                <div class="metric-value" id="predictedRetention">0%</div>
                <div class="metric-subtitle">Expected viewer retention</div>
                <div class="metric-trend">
                    <span id="retentionRec">Calculating...</span>
                </div>
            </div>

            <!-- Projected Revenue -->
            <div class="metric-card">
                <div class="metric-title"> Projected Revenue</div>
                <div class="metric-value" id="projectedRevenue">$0.00</div>
                <div class="metric-subtitle">Monthly projection</div>
                <div class="metric-trend">
                    <span id="revenueTip">Calculating...</span>
                </div>
            </div>

            <!-- Schedule Suggestion -->
            <div class="metric-card">
                <div class="metric-title"> Optimal Schedule</div>
                <div class="metric-value" id="scheduleSuggestion">--:--</div>
                <div class="metric-subtitle">Best streaming time</div>
                <div class="metric-trend">
                    <span id="scheduleReason">Calculating...</span>
                </div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="metric-card" style="margin: 20px 0;">
            <div class="metric-title"> AI Recommendations</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                <div class="recommendation-card">
                    <div class="recommendation-title"> Viewer Growth</div>
                    <div id="viewerRec" class="recommendation-text">Calculating recommendations...</div>
                </div>
                <div class="recommendation-card">
                    <div class="recommendation-title"> Growth Strategy</div>
                    <div id="growthRec" class="recommendation-text">Calculating recommendations...</div>
                </div>
            </div>
        </div>

        <!-- AI Prompts History -->
        <div class="ai-prompts">
            <div class="metric-title"> AI Prompts History</div>
            <div id="aiPromptsHistory">
                <div class="prompt-item">
                    <div class="prompt-type">System</div>
                    <div class="prompt-message">Waiting for AI prompts...</div>
                    <div class="prompt-timestamp">--:--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Strategic View Toggle Button -->
    <button class="strategic-toggle" id="strategicToggle" onclick="toggleStrategicView()">
         Strategic View
    </button>


    <script>
        // Global variables
        let ws;
        let currentLanguage = 'en';
        let lastViewerCount = 0;
        let sessionStartTime = Date.now();
        let currentSessionId = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        let chatScore = 0;
        let lastChatScore = 0;
        
        // Zero to One Phase System
        let currentPhase = 'zero_viewers';
        let phaseTransitionTime = null;
        let firstViewerAlertShown = false;
        let dashboardContainer = null;

        // Zero to One Features - Global Variables
        let abtTimer = null;
        let abtInterval = null;
        let abtMuted = false;
        let uniqueViewers = new Set();
        let streamTime = 0;
        let messagesSent = 0;
        let milestonesReached = 0;
        let lastMessageTime = 0;

        // ABT Coach - Prompt Templates
        const abtPrompts = [
            "Share a story about your first time playing this game!",
            "What's your favorite part about streaming so far?",
            "Tell us about your setup - what gear are you using?",
            "What's the funniest thing that happened to you today?",
            "Describe your dream gaming setup!",
            "What's your go-to snack while streaming?",
            "Share a tip for new streamers!",
            "What's the most challenging game you've ever played?",
            "Tell us about your favorite streamer and why you like them!",
            "What's your biggest gaming achievement?",
            "Describe your ideal viewer community!",
            "What's the weirdest comment you've ever gotten?",
            "Share your streaming goals for this month!",
            "What's your favorite type of content to watch?",
            "Tell us about your worst gaming fail!"
        ];

        // Milestones Configuration
        const milestones = [
            { id: 'first_30min', name: 'First 30 Minutes', icon: '', threshold: 30, type: 'time', description: 'Stream for 30 minutes straight' },
            { id: 'first_hour', name: 'First Hour', icon: '', threshold: 60, type: 'time', description: 'Complete your first hour of streaming' },
            { id: 'first_viewer', name: 'First Viewer', icon: '', threshold: 1, type: 'viewers', description: 'Get your first viewer' },
            { id: 'first_5_viewers', name: 'First 5 Viewers', icon: '', threshold: 5, type: 'viewers', description: 'Reach 5 concurrent viewers' },
            { id: 'first_message', name: 'First Chat Message', icon: '', threshold: 1, type: 'messages', description: 'Receive your first chat message' },
            { id: 'stream_streak_3', name: '3-Day Streak', icon: '', threshold: 3, type: 'streak', description: 'Stream for 3 consecutive days' },
            { id: 'stream_streak_7', name: '1-Week Streak', icon: '', threshold: 7, type: 'streak', description: 'Stream for 7 consecutive days' },
            { id: 'first_100_messages', name: '100 Messages', icon: '', threshold: 100, type: 'messages', description: 'Send 100 messages total' }
        ];

        // Language translations
        const translations = {
            en: {
                streamStatus: 'Stream Status',
                currentViewers: 'Current Viewers',
                peakViewers: 'Peak Viewers',
                totalSubs: 'Total Subs',
                totalFollowers: 'Total Followers',
                newFollowers: 'New Followers',
                streamRevenue: 'Stream Revenue',
                newSubs: 'New Subs',
                bitsEarned: 'Bits Earned',
                raidsReceived: 'Raids Received',
                streamInfo: 'Chat score',
                chatSentiment: 'Chat Sentiment',
                recentChat: 'Recent Chat Activity',
                topUsers: 'Top Engaged Users',
                aiPrompts: 'AI-Generated Prompts',
                liveChatScore: 'Live Chat Score',
                chatActivity: 'Chat Activity',
                offline: 'Offline',
                online: 'Online',
                notStreaming: 'Not streaming',
                streaming: 'Streaming',
                stable: 'Stable',
                growing: 'Growing',
                declining: 'Declining',
                positive: 'Positive',
                negative: 'Negative',
                neutral: 'Neutral'
            },
            fr: {
                streamStatus: 'Statut du Stream',
                currentViewers: 'Spectateurs Actuels',
                peakViewers: 'Pic de Spectateurs',
                totalSubs: 'Total Abonnements',
                totalFollowers: 'Total Followers',
                newFollowers: 'Nouveaux Followers',
                streamRevenue: 'Revenus du Stream',
                newSubs: 'Nouveaux Subs',
                bitsEarned: 'Bits Gagns',
                raidsReceived: 'Raids Reus',
                streamInfo: 'Informations du Stream',
                chatSentiment: 'Sentiment du Chat',
                recentChat: 'Activit Rcente du Chat',
                topUsers: 'Utilisateurs les Plus Engags',
                aiPrompts: 'Prompts Gnrs par IA',
                liveChatScore: 'Score de Chat en Direct',
                chatActivity: 'Activit du Chat',
                offline: 'Hors ligne',
                online: 'En ligne',
                notStreaming: 'Pas de stream',
                streaming: 'En stream',
                stable: 'Stable',
                growing: 'Croissant',
                declining: 'Dclinant',
                positive: 'Positif',
                negative: 'Ngatif',
                neutral: 'Neutre'
            },
            es: {
                streamStatus: 'Estado del Stream',
                currentViewers: 'Espectadores Actuales',
                peakViewers: 'Pico de Espectadores',
                totalSubs: 'Total Suscripciones',
                totalFollowers: 'Total Seguidores',
                newFollowers: 'Nuevos Seguidores',
                streamRevenue: 'Ingresos del Stream',
                newSubs: 'Nuevos Subs',
                bitsEarned: 'Bits Ganados',
                raidsReceived: 'Raids Recibidos',
                streamInfo: 'Informacin del Stream',
                chatSentiment: 'Sentimiento del Chat',
                recentChat: 'Actividad Reciente del Chat',
                topUsers: 'Usuarios Ms Comprometidos',
                aiPrompts: 'Prompts Generados por IA',
                liveChatScore: 'Puntuacin de Chat en Vivo',
                chatActivity: 'Actividad del Chat',
                offline: 'Desconectado',
                online: 'En lnea',
                notStreaming: 'No transmitiendo',
                streaming: 'Transmitiendo',
                stable: 'Estable',
                growing: 'Creciente',
                declining: 'Declinando',
                positive: 'Positivo',
                negative: 'Negativo',
                neutral: 'Neutral'
            },
            de: {
                streamStatus: 'Stream-Status',
                currentViewers: 'Aktuelle Zuschauer',
                peakViewers: 'Hchste Zuschauerzahl',
                totalSubs: 'Gesamte Abonnements',
                totalFollowers: 'Gesamte Follower',
                newFollowers: 'Neue Follower',
                streamRevenue: 'Stream-Einnahmen',
                newSubs: 'Neue Subs',
                bitsEarned: 'Bits Verdient',
                raidsReceived: 'Raids Erhalten',
                streamInfo: 'Stream-Informationen',
                chatSentiment: 'Chat-Stimmung',
                recentChat: 'Aktuelle Chat-Aktivitt',
                topUsers: 'Top Engagierte Benutzer',
                aiPrompts: 'KI-Generierte Prompts',
                liveChatScore: 'Live-Chat-Bewertung',
                chatActivity: 'Chat-Aktivitt',
                offline: 'Offline',
                online: 'Online',
                notStreaming: 'Nicht am Streamen',
                streaming: 'Am Streamen',
                stable: 'Stabil',
                growing: 'Wachsend',
                declining: 'Abnehmend',
                positive: 'Positiv',
                negative: 'Negativ',
                neutral: 'Neutral'
            }
        };

        // Zero to One Phase System Functions
        function updatePhase(phase) {
            if (currentPhase === phase) return;
            
            console.log(` [PHASE] Transitioning from ${currentPhase} to ${phase}`);
            
            const previousPhase = currentPhase;
            currentPhase = phase;
            phaseTransitionTime = Date.now();
            
            // Get dashboard container
            if (!dashboardContainer) {
                dashboardContainer = document.getElementById('dashboard-container');
            }
            
            if (dashboardContainer) {
                // Update main container class for phase-based styling
                dashboardContainer.className = `phase-${phase}`;
            }
            
            // Zero to One Features Integration
            switch (phase) {
                case 'zero_viewers':
                    startABTCoach();
                    document.getElementById('milestonesSection').style.display = 'block';
                    break;
                case 'first_viewer':
                    stopABTCoach();
                    if (!firstViewerAlertShown) {
                showFirstViewerAlert();
                    }
                    break;
                case 'building_audience':
                    stopABTCoach();
                hideFirstViewerAlert();
                    document.getElementById('milestonesSection').style.display = 'block';
                    break;
                default:
                    stopABTCoach();
            }
            
            // Update AI prompt area and gauge subtitle
            updateAIPromptArea(phase);
            updateGaugeSubtitle(phase);
            
            console.log(` [PHASE] Successfully transitioned to ${phase}`);
        }
        
        // Update gauge subtitle based on phase
        function updateGaugeSubtitle(phase) {
            const gaugeSubtitle = document.getElementById('gaugeSubtitle');
            if (gaugeSubtitle) {
                switch(phase) {
                    case 'zero_viewers':
                        gaugeSubtitle.textContent = 'Keep Talking!';
                        break;
                    case 'first_viewer':
                        gaugeSubtitle.textContent = 'First Viewer!';
                        break;
                    case 'building_audience':
                        gaugeSubtitle.textContent = 'Building Audience';
                        break;
                    default:
                        gaugeSubtitle.textContent = 'Chat Score';
                }
            }
        }
        
        function showFirstViewerAlert() {
            const alert = document.getElementById('firstViewerAlert');
            const message = document.getElementById('firstViewerMessage');
            
            if (alert && message) {
                message.innerHTML = `
                     Someone just joined your stream!<br>
                    This is the beginning of your community!<br>
                    <small>Phase: ${currentPhase}</small>
                `;
                alert.classList.add('show');
                firstViewerAlertShown = true;
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    hideFirstViewerAlert();
                }, 5000);
            }
        }
        
        function hideFirstViewerAlert() {
            const alert = document.getElementById('firstViewerAlert');
            if (alert) {
                alert.classList.remove('show');
            }
        }
        
        function closeFirstViewerAlert() {
            hideFirstViewerAlert();
        }
        
        function updateAIPromptArea(phase) {
            const phaseElement = document.getElementById('aiPromptPhase');
            const messageElement = document.getElementById('aiPromptMessage');
            const priorityElement = document.getElementById('aiPromptPriority');
            const areaElement = document.getElementById('aiPromptAreaEnhanced');
            
            if (!phaseElement || !messageElement || !priorityElement || !areaElement) return;
            
            // Update phase indicator
            phaseElement.textContent = phase.replace('_', ' ').toUpperCase();
            
            // Update message and priority based on phase
            let message, priority, className;
            
            switch (phase) {
                case 'zero_viewers':
                    message = "Keep talking! Even with no visible chat, you never know who might be lurking. Share your thoughts, ask questions, or talk about what you're passionate about!";
                    priority = "high";
                    className = "high-priority";
                    break;
                case 'first_viewer':
                    message = " FIRST VIEWER DETECTED! Welcome them warmly and make them feel special. This is the start of your community!";
                    priority = "urgent";
                    className = "urgent";
                    break;
                case 'building_audience':
                    message = "Great! You have viewers. Keep the energy up with engaging content, ask questions, and build your community!";
                    priority = "medium";
                    className = "";
                    break;
                default:
                    message = "AI Co-Pilot is ready to help!";
                    priority = "medium";
                    className = "";
            }
            
            messageElement.textContent = message;
            priorityElement.textContent = priority;
            
            // Update styling
            areaElement.className = `ai-prompt-area-enhanced ai-prompt-card ${className}`;
        }
        
        function updatePhaseFromData(data) {
            console.log(' [PHASE] Checking phase update - Current:', currentPhase, 'Data:', data.streamPhase);
            
            // Check for first viewer detection
            if (data.currentViewerCount > lastViewerCount && data.currentViewerCount >= 1 && data.currentViewerCount <= 5) {
                const viewerName = data.newViewerName || 'New Viewer';
                uniqueViewers.add(viewerName);
                showFirstViewerAlert(viewerName);
            }
            
            // Update last viewer count
            lastViewerCount = data.currentViewerCount || 0;
            
            // If no streamPhase in data, determine it from viewer count
            let phaseToUse = data.streamPhase;
            if (!phaseToUse) {
                const viewerCount = data.currentViewerCount || 0;
                if (viewerCount === 0) {
                    phaseToUse = 'zero_viewers';
                } else if (viewerCount === 1) {
                    phaseToUse = 'first_viewer';
                } else {
                    phaseToUse = 'building_audience';
                }
                console.log(' [PHASE] No streamPhase in data, determined from viewer count:', phaseToUse);
            }
            
            if (phaseToUse && phaseToUse !== currentPhase) {
                console.log(' [PHASE] Phase change detected, updating...');
                updatePhase(phaseToUse);
            } else {
                console.log(' [PHASE] No phase change needed');
            }
        }
        
        // Test function to manually trigger phase changes (for debugging)
        function testPhaseChange(phase) {
            console.log(' [TEST] Manually triggering phase change to:', phase);
            updatePhase(phase);
        }
        
        // Make test function available globally for debugging
        window.testPhaseChange = testPhaseChange;
        
        function updateEnhancedAIPrompt(data) {
            const messageElement = document.getElementById('aiPromptMessage');
            const priorityElement = document.getElementById('aiPromptPriority');
            const areaElement = document.getElementById('aiPromptAreaEnhanced');
            
            if (!messageElement || !priorityElement || !areaElement) return;
            
            // Get the latest prompt from prompt history
            if (data.promptHistory && data.promptHistory.length > 0) {
                const latestPrompt = data.promptHistory[data.promptHistory.length - 1];
                
                if (latestPrompt && latestPrompt.prompt) {
                    messageElement.textContent = latestPrompt.prompt.message || messageElement.textContent;
                    priorityElement.textContent = latestPrompt.prompt.priority || 'medium';
                    
                    // Update styling based on priority
                    let className = 'ai-prompt-area-enhanced ai-prompt-card';
                    if (latestPrompt.prompt.priority === 'urgent') {
                        className += ' urgent';
                    } else if (latestPrompt.prompt.priority === 'high') {
                        className += ' high-priority';
                    }
                    
                    areaElement.className = className;
                }
            }
        }

        // Initialize WebSocket connection
        function initWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            let wsUrl = `${protocol}//${window.location.host}`;
            
            // Add sessionId to WebSocket URL if available
            if (currentSessionId) {
                wsUrl += `?sessionId=${currentSessionId}`;
            }
            
            console.log(' [WEBSOCKET] Connecting to:', wsUrl);
            ws = new WebSocket(wsUrl);

            ws.onopen = function() {
                console.log('WebSocket connected');
                // Only update status if we're actually connected to a channel
                if (currentChannel) {
                    updateConnectionStatus('connected', `Connected to ${currentChannel}`);
                } else {
                    updateConnectionStatus('disconnected', 'Not Connected');
                }
                reconnectAttempts = 0;
            };

            ws.onmessage = function(event) {
                try {
                    console.log(' [WEBSOCKET] Received message:', event.data);
                    const data = JSON.parse(event.data);
                    console.log(' [WEBSOCKET] Parsed data:', data);
                    updateDashboard(data);
                } catch (error) {
                    console.error(' [WEBSOCKET] Error parsing message:', error);
                    console.error('Raw message:', event.data);
                }
            };

            ws.onclose = function() {
                console.log('WebSocket disconnected');
                updateConnectionStatus('disconnected', 'Disconnected');
                
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    console.log(`Attempting to reconnect... (${reconnectAttempts}/${maxReconnectAttempts})`);
                    setTimeout(initWebSocket, 2000); // Faster reconnection
                } else {
                    console.error('Max reconnection attempts reached');
                    updateConnectionStatus('failed');
                }
            };

            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateConnectionStatus('error');
            };
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('statusText');
            const indicatorElement = document.getElementById('sessionStatus');
            
            switch(status) {
                case 'connected':
                    statusElement.textContent = 'Connected';
                    indicatorElement.className = 'status-indicator status-online';
                    break;
                case 'disconnected':
                    statusElement.textContent = 'Disconnected';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
                case 'connecting':
                    statusElement.textContent = 'Connecting...';
                    indicatorElement.className = 'status-indicator status-connecting';
                    break;
                case 'error':
                    statusElement.textContent = 'Error';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
                case 'failed':
                    statusElement.textContent = 'Connection Failed';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
            }
        }

        // Toggle strategic view panel
        function toggleStrategicView() {
            const panel = document.getElementById('strategicPanel');
            const button = document.getElementById('strategicToggle');
            
            console.log(' Toggling strategic view panel...');
            console.log('Panel element:', panel);
            console.log('Button element:', button);
            
            if (panel && button) {
                if (panel.classList.contains('visible')) {
                    panel.classList.remove('visible');
                    panel.style.display = 'none';
                    button.textContent = ' Strategic View';
                    console.log(' Strategic panel hidden');
                } else {
                    panel.classList.add('visible');
                    panel.style.display = 'block';
                    button.textContent = ' Hide Strategic';
                    console.log(' Strategic panel shown');
                }
            } else {
                console.error(' Could not find strategic panel or button elements');
            }
        }


        // Update dashboard with new data
        function updateDashboard(data) {
            console.log(' [DASHBOARD] Updating dashboard with data:', data);
            console.log(' [DASHBOARD] Stream Phase:', data.streamPhase, 'Chat Score:', data.chatScore);
            
            // Update phase system first
            updatePhaseFromData(data);
            
            // Update last update timestamp
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            
            // Update session info
            document.getElementById('sessionId').textContent = data.sessionId ? new Date(data.sessionId).toLocaleTimeString() : 'N/A';
            document.getElementById('channelName').textContent = data.channelName || 'No Channel';
            document.getElementById('streamTopic').textContent = data.streamTitle || 'No Stream';
            
            // Update uptime
            if (data.streamStartTime) {
                const uptime = Date.now() - data.streamStartTime;
                document.getElementById('uptime').textContent = formatUptime(uptime);
            }

            // Update stream status
            const isLive = data.isLive || false;
            document.getElementById('streamStatus').textContent = isLive ? 'Online' : 'Offline';
            document.getElementById('streamStatusText').textContent = isLive ? 'Streaming' : 'Not streaming';
            
            const statusIndicator = document.querySelector('.metric-card .status-indicator');
            if (statusIndicator) {
                statusIndicator.className = `status-indicator ${isLive ? 'status-online' : 'status-offline'}`;
            }
            
            // Update session status based on connection and stream status
            const sessionStatus = document.getElementById('sessionStatus');
            const statusText = document.getElementById('statusText');
            if (data.channelName && data.channelName !== 'No Channel') {
                if (isLive) {
                    sessionStatus.className = 'status-indicator status-connected';
                    statusText.textContent = 'Live & Connected';
                } else {
                    sessionStatus.className = 'status-indicator status-connecting';
                    statusText.textContent = 'Connected (Offline)';
                }
            } else {
                sessionStatus.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Not Connected';
            }

            // Update viewer metrics
            const currentViewers = data.currentViewerCount || 0;
            const peakViewers = data.peakViewerCount || 0;
            const totalSubs = data.totalSubs || 0;
            const sessionSubs = data.sessionSubsGained || 0;
            
            updateMetricValue('currentViewers', formatNumber(currentViewers));
            updateMetricValue('peakViewers', formatNumber(peakViewers));
            updateMetricValue('totalSubsMain', formatNumber(totalSubs));
            
            // Update subs trend
            document.getElementById('subsTrend').textContent = `+${formatNumber(sessionSubs)} this session`;

            // Update viewer trend
            if (lastViewerCount > 0) {
                const change = currentViewers - lastViewerCount;
                const trendElement = document.getElementById('viewerTrend');
                const changeElement = document.getElementById('viewerChange');
                
                if (change > 0) {
                    trendElement.className = 'trend-up';
                    changeElement.textContent = `+${change}`;
                } else if (change < 0) {
                    trendElement.className = 'trend-down';
                    changeElement.textContent = change.toString();
                } else {
                    trendElement.className = 'trend-stable';
                    changeElement.textContent = '0';
                }
            }
            lastViewerCount = currentViewers;

            // Update followers metrics
            const totalFollowers = data.totalFollowers || 0;
            const sessionFollowers = data.sessionFollowersGained || 0;
            
            // Display total followers (from Twitch API)
            updateMetricValue('totalFollowers', formatNumber(totalFollowers));
            document.getElementById('followersTrend').textContent = `+${formatNumber(sessionFollowers)} this session`;
            
            // Update stream total revenue
            let streamTotalRevenue = 0;
            if (data.revenue && data.revenue.total) {
                streamTotalRevenue = data.revenue.total;
            } else {
                // Fallback calculation
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                streamTotalRevenue = bitsValue + subsValue;
            }
            document.getElementById('streamTotalRevenue').textContent = `$${streamTotalRevenue.toFixed(2)}`;
            
            // Update revenue trend (session revenue)
            let sessionRevenue = 0;
            if (data.revenue && data.revenue.breakdown) {
                const sessionBits = (data.sessionBitsEarned || 0) * 0.01;
                const sessionTier1 = (data.sessionTier1Subs || 0) * 2.50;
                const sessionTier2 = (data.sessionTier2Subs || 0) * 5.00;
                const sessionTier3 = (data.sessionTier3Subs || 0) * 12.50;
                sessionRevenue = sessionBits + sessionTier1 + sessionTier2 + sessionTier3;
            } else {
                // Fallback calculation
                const sessionBits = (data.sessionBitsEarned || 0) * 0.01;
                const sessionSubs = (data.sessionSubsGained || 0) * 2.50;
                sessionRevenue = sessionBits + sessionSubs;
            }
            document.getElementById('revenueTrendText').textContent = `$${sessionRevenue.toFixed(2)} this session`;

            // Update Twitch specific metrics
            updateMetricValue('newFollowers', data.sessionFollowersGained || 0);
            updateMetricValue('newSubs', data.sessionSubsGained || 0);
            updateMetricValue('bitsEarned', data.sessionBitsEarned || 0);
            updateMetricValue('raidsReceived', data.sessionRaidsReceived || 0);

            // Update stream information
            document.getElementById('streamTitle').textContent = data.streamTitle || 'No stream';
            document.getElementById('gameCategory').textContent = data.gameCategory || 'Not set';
            document.getElementById('streamLanguage').textContent = data.streamLanguage || 'en';
            
            if (data.streamStartTime) {
                const startTime = new Date(data.streamStartTime);
                document.getElementById('streamStartTime').textContent = startTime.toLocaleTimeString();
            }

            // Update sentiment
            const sentiment = data.rollingSentimentScore || 0;
            document.getElementById('sentimentScore').textContent = sentiment.toFixed(1);
            
            const sentimentEmoji = document.getElementById('sentimentEmoji');
            const sentimentText = document.getElementById('sentimentText');
            
            if (sentiment > 0.5) {
                sentimentEmoji.textContent = '';
                sentimentText.textContent = 'Positive';
            } else if (sentiment < -0.5) {
                sentimentEmoji.textContent = '';
                sentimentText.textContent = 'Negative';
            } else {
                sentimentEmoji.textContent = '';
                sentimentText.textContent = 'Neutral';
            }

            // Update chat messages
            if (data.recentMessages && data.recentMessages.length > 0) {
                updateChatMessages(data.recentMessages);
            }

            // Update top users
            if (data.topEngagedUsers && data.topEngagedUsers.length > 0) {
                updateTopUsers(data.topEngagedUsers);
            }

            // Update AI prompts
            if (data.promptHistory && data.promptHistory.length > 0) {
                updateAIPrompts(data.promptHistory);
            }

            // Update enhanced AI prompt area with latest prompt
            updateEnhancedAIPrompt(data);

            // Update chat score gauge - use backend calculated score
            const newChatScore = data.chatScore || calculateChatScore(data);
            updateChatScoreGauge(newChatScore);
            
            // Update revenue metrics
            updateMetricValue('totalBits', formatNumber(data.totalBits || 0));
            updateMetricValue('sessionBits', formatNumber(data.sessionBitsEarned || 0));
            updateMetricValue('totalSubs', formatNumber(data.totalSubs || 0));
            updateMetricValue('sessionSubs', formatNumber(data.sessionSubsGained || 0));
            updateMetricValue('totalRaids', formatNumber(data.totalRaids || 0));
            updateMetricValue('sessionRaids', formatNumber(data.sessionRaidsReceived || 0));
            updateMetricValue('bitsPerMinute', (data.bitsPerMinute || 0).toFixed(1));
            
            // Use accurate revenue calculation from backend
            let totalRevenue = 0;
            let hourlyRate = 0;
            
            if (data.revenue) {
                // Use backend-calculated accurate revenue
                totalRevenue = data.revenue.total;
                
                // Calculate hourly rate if we have stream duration
                if (data.streamStartTime) {
                    const streamDurationHours = (Date.now() - data.streamStartTime) / (1000 * 60 * 60);
                    if (streamDurationHours > 0) {
                        hourlyRate = totalRevenue / streamDurationHours;
                    }
                }
            } else {
                // Fallback to frontend calculation (accurate Twitch rates)
                // Bits: 1 bit = $0.01 USD (streamer receives full value)
                // Subs: Average of Tier 1 ($2.50), Tier 2 ($5.00), Tier 3 ($12.50) = ~$2.50 per sub
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                totalRevenue = bitsValue + subsValue;
                
                if (data.streamStartTime) {
                    const streamDurationHours = (Date.now() - data.streamStartTime) / (1000 * 60 * 60);
                    if (streamDurationHours > 0) {
                        hourlyRate = totalRevenue / streamDurationHours;
                    }
                }
            }
            
            document.getElementById('revenueRate').textContent = `$${hourlyRate.toFixed(2)}/hr`;
            
            // Update revenue breakdown
            if (data.revenue && data.revenue.breakdown) {
                document.getElementById('bitsRevenue').textContent = `$${data.revenue.breakdown.bits.toFixed(2)}`;
                document.getElementById('tier1Revenue').textContent = `$${data.revenue.breakdown.tier1.toFixed(2)}`;
                document.getElementById('tier2Revenue').textContent = `$${data.revenue.breakdown.tier2.toFixed(2)}`;
                document.getElementById('tier3Revenue').textContent = `$${data.revenue.breakdown.tier3.toFixed(2)}`;
                document.getElementById('totalRevenue').textContent = `$${data.revenue.total.toFixed(2)}`;
            } else {
                // Fallback values
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                document.getElementById('bitsRevenue').textContent = `$${bitsValue.toFixed(2)}`;
                document.getElementById('tier1Revenue').textContent = '$0.00';
                document.getElementById('tier2Revenue').textContent = '$0.00';
                document.getElementById('tier3Revenue').textContent = '$0.00';
                document.getElementById('totalRevenue').textContent = `$${(bitsValue + subsValue).toFixed(2)}`;
            }

            // Update strategic view metrics
            updateMetricValue('peakViewersStrategic', formatNumber(peakViewers));
            if (data.streamStartTime) {
                const streamDuration = Date.now() - data.streamStartTime;
                document.getElementById('streamDuration').textContent = formatUptime(streamDuration);
                document.getElementById('streamDurationText').textContent = 'Live now';
            } else {
                document.getElementById('streamDuration').textContent = '00:00:00';
                document.getElementById('streamDurationText').textContent = 'Not live';
            }

            // Update new strategic metrics
            updateMetricValue('healthScore', Math.round(data.healthScore || 0));
            updateMetricValue('predictedRetention', `${Math.round(data.predictedRetention || 0)}%`);
            updateMetricValue('projectedRevenue', `$${(data.projectedRevenue || 0).toFixed(2)}`);
            updateMetricValue('scheduleSuggestion', data.scheduleSuggestion || '--:--');
            
            // Update recommendation texts with color coding
            const healthScore = data.healthScore || 0;
            const healthScoreElement = document.getElementById('healthScoreText');
            if (healthScore >= 70) {
                healthScoreElement.textContent = 'Excellent';
                healthScoreElement.className = 'health-score-excellent';
            } else if (healthScore >= 50) {
                healthScoreElement.textContent = 'Good';
                healthScoreElement.className = 'health-score-good';
            } else {
                healthScoreElement.textContent = 'Needs improvement';
                healthScoreElement.className = 'health-score-poor';
            }
            
            document.getElementById('retentionRec').textContent = data.retentionRec || 'Calculating...';
            document.getElementById('revenueTip').textContent = data.revenueTip || 'Calculating...';
            document.getElementById('scheduleReason').textContent = data.scheduleReason || 'Calculating...';
            document.getElementById('viewerRec').textContent = data.viewerRec || 'Calculating recommendations...';
            document.getElementById('growthRec').textContent = data.growthRec || 'Calculating recommendations...';
        }

        // Update chat messages
        function updateChatMessages(messages) {
            const chatContainer = document.getElementById('chatMessages');
            chatContainer.innerHTML = '';
            
            messages.slice(-10).forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                
                const timestamp = new Date(msg.timestamp || Date.now());
                messageDiv.innerHTML = `
                    <span class="chat-username">${msg.username}:</span>
                    <span class="chat-text">${msg.message}</span>
                    <span class="chat-timestamp">${timestamp.toLocaleTimeString()}</span>
                `;
                
                chatContainer.appendChild(messageDiv);
            });
        }

        // Update top users
        function updateTopUsers(users) {
            const usersContainer = document.getElementById('topUsers');
            usersContainer.innerHTML = '';
            
            users.slice(0, 10).forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div class="user-name">${user.username}</div>
                    <div class="user-stats">
                        <span>Messages: ${user.messages || 0}</span>
                        <span>Bits: ${user.bits || 0}</span>
                        <span>Subs: ${user.subs || 0}</span>
                    </div>
                `;
                usersContainer.appendChild(userDiv);
            });
        }

        // Update AI prompts
        function updateAIPrompts(prompts) {
            const promptsContainer = document.getElementById('aiPrompts');
            const historyContainer = document.getElementById('aiPromptsHistory');
            
            // Update main AI prompts (Tier 2)
            if (promptsContainer) {
                promptsContainer.innerHTML = '';
            prompts.slice(-5).forEach(prompt => {
                const promptDiv = document.createElement('div');
                promptDiv.className = 'prompt-item';
                
                const timestamp = new Date(prompt.timestamp || Date.now());
                    const message = prompt.prompt?.message || 'No message';
                    
                promptDiv.innerHTML = `
                        <div class="prompt-type">${prompt.prompt?.type || 'AI Assistant'}</div>
                        <div class="prompt-message">${message}</div>
                    <div class="prompt-timestamp">${timestamp.toLocaleTimeString()}</div>
                `;
                promptsContainer.appendChild(promptDiv);
            });
            }
            
            // Update AI prompts history (Tier 3)
            if (historyContainer) {
                historyContainer.innerHTML = '';
                prompts.slice(-10).forEach(prompt => {
                    const promptDiv = document.createElement('div');
                    promptDiv.className = 'prompt-item';
                    
                    const timestamp = new Date(prompt.timestamp || Date.now());
                    const message = prompt.prompt?.message || 'No message';
                    
                    promptDiv.innerHTML = `
                        <div class="prompt-type">${prompt.prompt?.type || 'AI Assistant'}</div>
                        <div class="prompt-message">${message}</div>
                        <div class="prompt-timestamp">${timestamp.toLocaleTimeString()}</div>
                    `;
                    historyContainer.appendChild(promptDiv);
                });
            }
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Send language preference to server
            fetch('/api/set-language', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ language: lang })
            }).catch(error => {
                console.error('Error setting language:', error);
            });
            
            // Update text content
            updateLanguage();
        }

        // Update language
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update metric titles
            document.querySelectorAll('.metric-title').forEach((title, index) => {
            const titles = [
                t.streamStatus, t.currentViewers, t.peakViewers, t.totalSubs,
                t.newFollowers, t.streamRevenue, t.streamInfo, t.chatSentiment
            ];
                if (titles[index]) {
                    title.textContent = titles[index];
                }
            });
        }

        // Format number with commas
        function formatNumber(num, decimals = 0) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        // Format uptime
        function formatUptime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            return `${hours.toString().padStart(2, '0')}:${(minutes % 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
        }

        // Update metric value with animation
        function updateMetricValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue) {
                element.textContent = newValue;
                element.classList.add('updated');
                setTimeout(() => {
                    element.classList.remove('updated');
                }, 500);
            }
        }

        // Calculate chat score based on activity
        function calculateChatScore(data) {
            const totalMessages = data.totalMessages || 0;
            const viewerCount = data.currentViewerCount || 0;
            const sentiment = data.rollingSentimentScore || 0;
            const streamDuration = data.streamStartTime ? (Date.now() - data.streamStartTime) / (1000 * 60) : 1; // minutes
            
            // Calculate messages per minute for scoring
            const messagesPerMinute = streamDuration > 0 ? totalMessages / streamDuration : 0;
            
            // Base score from message rate (0-50 points)
            let score = Math.min(messagesPerMinute * 2, 50);
            
            // Viewer engagement bonus (0-30 points)
            const engagementRate = viewerCount > 0 ? (messagesPerMinute / viewerCount) * 1000 : 0;
            score += Math.min(engagementRate * 3, 30);
            
            // Sentiment bonus (0-20 points)
            const sentimentBonus = Math.max(0, sentiment + 1) * 10;
            score += Math.min(sentimentBonus, 20);
            
            // Ensure score is between 0 and 100
            return Math.max(0, Math.min(100, Math.round(score)));
        }

        // Update chat score gauge
        function updateChatScoreGauge(score) {
            console.log(' Updating modern chat score gauge with score:', score);
            
            // Update single gauge instance
            const scoreElement = document.getElementById('gaugeScoreEnhanced');
            const needleElement = document.getElementById('gaugeNeedleEnhanced');
            const progressElement = document.getElementById('gaugeProgress');
            
            // Update score with animation
            if (score !== lastChatScore) {
                if (scoreElement) {
                    // Add smooth number transition
                    scoreElement.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                    scoreElement.textContent = score;
                    scoreElement.classList.add('updated');
                    
                    // Remove animation class after completion
                    setTimeout(() => {
                        scoreElement.classList.remove('updated');
                    }, 600);
                }
                
                lastChatScore = score;
            }
            
            // Update progress arc (0-100 maps to 0-360 degrees)
            if (progressElement) {
                const progressAngle = (score / 100) * 360;
                progressElement.style.background = `conic-gradient(
                    from -90deg,
                    #ff4757 0deg,
                    #ff6b35 ${progressAngle * 0.2}deg,
                    #feca57 ${progressAngle * 0.4}deg,
                    #48dbfb ${progressAngle * 0.6}deg,
                    #0abde3 ${progressAngle * 0.8}deg,
                    #3742fa ${progressAngle}deg,
                    transparent ${progressAngle}deg,
                    transparent 360deg
                )`;
            }
            
            // Calculate needle rotation (-90deg to 90deg for half circle)
            const rotation = (score / 100) * 180 - 90;
            
            // Update gauge needle with smooth animation
            if (needleElement) {
                needleElement.style.transition = 'transform 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                needleElement.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
                console.log(' Modern needle rotated to:', rotation + 'deg');
            } else {
                console.error(' Modern needle element not found!');
            }
            
            // Update gauge levels with modern styling
            updateGaugeLevels(score);
            
            // Update legacy gauges (if they exist)
            const legacyScoreElement = document.getElementById('chatScore');
            const legacyNeedleElement = document.getElementById('gaugeNeedle');
            const scoreElementStrategic = document.getElementById('chatScoreStrategic');
            const needleElementStrategic = document.getElementById('gaugeNeedleStrategic');
            
            if (legacyScoreElement) {
                legacyScoreElement.textContent = score;
                legacyScoreElement.classList.add('updated');
                setTimeout(() => {
                    legacyScoreElement.classList.remove('updated');
                }, 600);
            }
            
            if (legacyNeedleElement) {
                legacyNeedleElement.style.transform = `rotate(${rotation}deg)`;
            }
            
            if (scoreElementStrategic) {
                scoreElementStrategic.textContent = score;
                scoreElementStrategic.classList.add('updated');
                setTimeout(() => {
                    scoreElementStrategic.classList.remove('updated');
                }, 600);
            }
            
            if (needleElementStrategic) {
                needleElementStrategic.style.transform = `rotate(${rotation}deg)`;
            }
            
            // Update level indicators
            let level = 1;
            
            if (score >= 80) {
                level = 5;
            } else if (score >= 60) {
                level = 4;
            } else if (score >= 40) {
                level = 3;
            } else if (score >= 20) {
                level = 2;
            } else {
                level = 1;
            }
            
            console.log(' Setting active level to:', level);
            
            // Update level indicators - only highlight the current level
            for (let i = 1; i <= 5; i++) {
                const levelElement = document.getElementById(`level${i}`);
                if (levelElement) {
                    if (i === level) {
                        levelElement.classList.add('active');
                        console.log(` Level ${i} set to active`);
                    } else {
                        levelElement.classList.remove('active');
                        console.log(` Level ${i} set to inactive`);
                    }
                } else {
                    console.log(` Level element ${i} not found`);
                }
            }
        }

        // Test function for gauge (for debugging)
        function testGauge() {
            console.log(' Testing gauge with different scores...');
            updateChatScoreGauge(25); // Should be level 2
            setTimeout(() => updateChatScoreGauge(45), 2000); // Should be level 3
            setTimeout(() => updateChatScoreGauge(65), 4000); // Should be level 4
            setTimeout(() => updateChatScoreGauge(85), 6000); // Should be level 5
        }
        
        // Update gauge levels with modern styling
        function updateGaugeLevels(score) {
            const levels = document.querySelectorAll('.gauge-level');
            const levelThresholds = [0, 20, 40, 60, 80, 100];
            
            levels.forEach((level, index) => {
                const levelValue = levelThresholds[index + 1];
                const isActive = score >= levelThresholds[index] && score < levelValue;
                
                if (isActive) {
                    level.classList.add('active');
                } else {
                    level.classList.remove('active');
                }
            });
        }

        // ===== ZERO TO ONE FEATURES =====

        // ABT Coach Functions
        function startABTCoach() {
            console.log(' Starting ABT Coach for zero viewers');
            const timerContainer = document.getElementById('abtTimerContainer');
            const timerDisplay = document.getElementById('abtTimerDisplay');
            const muteToggle = document.getElementById('abtMuteToggle');
            
            if (timerContainer) {
                timerContainer.style.display = 'flex';
            }
            
            if (muteToggle) {
                muteToggle.addEventListener('click', toggleABTMute);
            }
            
            // Start 30-second timer
            abtTimer = 30;
            if (timerDisplay) {
                timerDisplay.textContent = abtTimer;
            }
            
            abtInterval = setInterval(() => {
                abtTimer--;
                if (timerDisplay) {
                    timerDisplay.textContent = abtTimer;
                }
                
                if (abtTimer <= 0) {
                    triggerABTPrompt();
                    abtTimer = 30; // Reset timer
                }
            }, 1000);
        }

        function stopABTCoach() {
            console.log(' Stopping ABT Coach');
            const timerContainer = document.getElementById('abtTimerContainer');
            
            if (abtInterval) {
                clearInterval(abtInterval);
                abtInterval = null;
            }
            
            if (timerContainer) {
                timerContainer.style.display = 'none';
            }
        }

        function toggleABTMute() {
            abtMuted = !abtMuted;
            const muteToggle = document.getElementById('abtMuteToggle');
            
            if (muteToggle) {
                if (abtMuted) {
                    muteToggle.textContent = ' Muted';
                    muteToggle.classList.add('muted');
                } else {
                    muteToggle.textContent = ' Mute';
                    muteToggle.classList.remove('muted');
                }
            }
        }

        function triggerABTPrompt() {
            if (abtMuted) return;
            
            const randomPrompt = abtPrompts[Math.floor(Math.random() * abtPrompts.length)];
            console.log(' ABT Prompt triggered:', randomPrompt);
            
            updateAIPromptArea('zero_viewers', {
                message: randomPrompt,
                priority: 'high'
            });
        }

        // First Viewer Catcher Functions
        function showFirstViewerAlert(viewerName = 'New Viewer') {
            console.log(' First viewer detected:', viewerName);
            const alert = document.getElementById('firstViewerAlert');
            const greeting = document.getElementById('firstViewerGreeting');
            
            if (alert && greeting) {
                // Generate personalized greeting
                const greetings = [
                    `Welcome ${viewerName}! Thanks for joining!`,
                    `Hey ${viewerName}! You're my first viewer today!`,
                    `Welcome to the stream, ${viewerName}! Glad you're here!`,
                    `${viewerName}, you just made my day! Welcome!`,
                    `First viewer alert! Welcome ${viewerName}!`
                ];
                
                const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
                greeting.textContent = randomGreeting;
                
                alert.classList.add('show');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    hideFirstViewerAlert();
                }, 5000);
            }
        }

        function hideFirstViewerAlert() {
            const alert = document.getElementById('firstViewerAlert');
            if (alert) {
                alert.classList.remove('show');
            }
        }

        function copyGreeting() {
            const greeting = document.getElementById('firstViewerGreeting');
            if (greeting) {
                navigator.clipboard.writeText(greeting.textContent).then(() => {
                    console.log(' Greeting copied to clipboard');
                });
            }
        }

        // Persistence Engine Functions
        function initializeMilestones() {
            const milestonesGrid = document.getElementById('milestonesGrid');
            if (!milestonesGrid) return;
            
            milestonesGrid.innerHTML = '';
            
            milestones.forEach(milestone => {
                const milestoneCard = document.createElement('div');
                milestoneCard.className = 'milestone-card';
                milestoneCard.id = `milestone-${milestone.id}`;
                
                const isCompleted = localStorage.getItem(`milestone_${milestone.id}`) === 'true';
                if (isCompleted) {
                    milestoneCard.classList.add('completed');
                }
                
                const progress = getMilestoneProgress(milestone);
                const progressPercent = Math.min((progress / milestone.threshold) * 100, 100);
                
                milestoneCard.innerHTML = `
                    <div class="milestone-header">
                        <span class="milestone-icon">${milestone.icon}</span>
                        <span class="milestone-name">${milestone.name}</span>
                    </div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-bar">
                            <div class="milestone-progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="milestone-progress-text">${progress}/${milestone.threshold}</div>
                    </div>
                    <div class="milestone-description">${milestone.description}</div>
                    ${isCompleted ? '<div class="milestone-badge">COMPLETED</div>' : ''}
                `;
                
                milestonesGrid.appendChild(milestoneCard);
            });
        }

        function getMilestoneProgress(milestone) {
            switch (milestone.type) {
                case 'time':
                    return Math.floor(streamTime / 60); // Convert to minutes
                case 'viewers':
                    return uniqueViewers.size;
                case 'messages':
                    return messagesSent;
                case 'streak':
                    return getStreamingStreak();
                default:
                    return 0;
            }
        }

        function getStreamingStreak() {
            // This would typically be stored in localStorage or backend
            return parseInt(localStorage.getItem('streaming_streak') || '0');
        }

        function checkMilestones() {
            milestones.forEach(milestone => {
                const isCompleted = localStorage.getItem(`milestone_${milestone.id}`) === 'true';
                if (!isCompleted) {
                    const progress = getMilestoneProgress(milestone);
                    if (progress >= milestone.threshold) {
                        completeMilestone(milestone);
                    }
                }
            });
        }

        function completeMilestone(milestone) {
            console.log(' Milestone completed:', milestone.name);
            localStorage.setItem(`milestone_${milestone.id}`, 'true');
            milestonesReached++;
            
            // Update UI
            const milestoneCard = document.getElementById(`milestone-${milestone.id}`);
            if (milestoneCard) {
                milestoneCard.classList.add('completed');
                milestoneCard.innerHTML += '<div class="milestone-badge">COMPLETED</div>';
            }
            
            // Show celebration
            showMilestoneCelebration(milestone);
            
            // Update summary
            updateStreamSummary();
        }

        function showMilestoneCelebration(milestone) {
            // Create temporary celebration element
            const celebration = document.createElement('div');
            celebration.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #4ecdc4, #9146ff);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                text-align: center;
                z-index: 10000;
                font-size: 1.2rem;
                font-weight: 700;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;
            celebration.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${milestone.icon}</div>
                <div>Milestone Unlocked!</div>
                <div style="font-size: 1.5rem; margin-top: 0.5rem;">${milestone.name}</div>
            `;
            
            document.body.appendChild(celebration);
            
            // Remove after 3 seconds
            setTimeout(() => {
                document.body.removeChild(celebration);
            }, 3000);
        }

        function updateStreamSummary() {
            document.getElementById('totalStreamTime').textContent = Math.floor(streamTime / 60) + 'm';
            document.getElementById('uniqueViewers').textContent = uniqueViewers.size;
            document.getElementById('messagesSent').textContent = messagesSent;
            document.getElementById('milestonesReached').textContent = milestonesReached;
        }

        // Stream time tracking
        function startStreamTimeTracking() {
            setInterval(() => {
                streamTime++;
                checkMilestones();
                updateStreamSummary();
            }, 1000);
        }

        // Quick test function for immediate gauge testing
        function testGaugeNow(score = 85) {
            console.log(' Testing BULLETPROOF gauge immediately with score:', score);
            
            // Debug gauge visibility with inline styles
            const gaugeContainer = document.querySelector('.chat-score-gauge-enhanced');
            const gaugeScore = document.getElementById('gaugeScoreEnhanced');
            const gaugeNeedle = document.getElementById('gaugeNeedleEnhanced');
            
            console.log(' BULLETPROOF Gauge Debug Info:');
            console.log('- Gauge Container:', gaugeContainer);
            console.log('- Gauge Score Element:', gaugeScore);
            console.log('- Gauge Needle Element:', gaugeNeedle);
            
            if (gaugeContainer) {
                console.log('- Container computed style:', window.getComputedStyle(gaugeContainer));
                console.log('- Container display:', window.getComputedStyle(gaugeContainer).display);
                console.log('- Container visibility:', window.getComputedStyle(gaugeContainer).visibility);
            }
            
            if (gaugeScore) {
                console.log('- Score element found:', gaugeScore);
                console.log('- Score text:', gaugeScore.textContent);
                console.log('- Score computed style:', window.getComputedStyle(gaugeScore));
            }
            
            if (gaugeNeedle) {
                console.log('- Needle element found:', gaugeNeedle);
                console.log('- Needle computed style:', window.getComputedStyle(gaugeNeedle));
            }
            
            updateChatScoreGauge(score);
        }

        // Force gauge to show on desktop
        function forceGaugeDisplay() {
            console.log(' Forcing gauge display...');
            const container = document.querySelector('.circular-gauge-container');
            const ring = document.querySelector('.gauge-ring');
            const center = document.querySelector('.gauge-center');
            const score = document.getElementById('gaugeScoreEnhanced');
            const needle = document.getElementById('gaugeNeedleEnhanced');
            
            if (container) {
                container.style.display = 'block';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                container.style.width = '250px';
                container.style.height = '250px';
            }
            
            if (ring) {
                ring.style.display = 'flex';
                ring.style.visibility = 'visible';
                ring.style.opacity = '1';
                ring.style.width = '250px';
                ring.style.height = '250px';
                ring.style.borderRadius = '50%';
                ring.style.background = 'conic-gradient(from -90deg, #ff4444 0deg, #ff8800 30deg, #ffdd00 60deg, #88ff88 90deg, #00ddff 120deg, #8844ff 150deg, #ff44ff 180deg, #ff4444 270deg, #ff4444 360deg)';
            }
            
            if (center) {
                center.style.display = 'flex';
                center.style.visibility = 'visible';
                center.style.opacity = '1';
            }
            
            if (score) {
                score.style.display = 'block';
                score.style.visibility = 'visible';
                score.style.opacity = '1';
            }
            
            if (needle) {
                needle.style.display = 'block';
                needle.style.visibility = 'visible';
                needle.style.opacity = '1';
            }
            
            console.log(' Gauge display forced');
        }

        // Make test functions globally available
        window.testGauge = testGauge;
        window.testGaugeNow = testGaugeNow;
        window.testGaugeVisibility = testGaugeVisibility;
        window.forceGaugeDisplay = forceGaugeDisplay;
        
        // Test gauge visibility function
        function testGaugeVisibility() {
            console.log(' Testing gauge visibility...');
            const gauge = document.getElementById('chatScoreGaugeEnhanced');
            const container = document.querySelector('.circular-gauge-container');
            const ring = document.querySelector('.gauge-ring');
            const center = document.querySelector('.gauge-center');
            const score = document.getElementById('gaugeScoreEnhanced');
            const needle = document.getElementById('gaugeNeedleEnhanced');
            
            console.log('Gauge elements found:');
            console.log('- Main gauge:', gauge);
            console.log('- Container:', container);
            console.log('- Ring:', ring);
            console.log('- Center:', center);
            console.log('- Score:', score);
            console.log('- Needle:', needle);
            
            if (gauge) {
                const styles = window.getComputedStyle(gauge);
                console.log('Gauge computed styles:');
                console.log('- Display:', styles.display);
                console.log('- Visibility:', styles.visibility);
                console.log('- Opacity:', styles.opacity);
                console.log('- Z-index:', styles.zIndex);
            }
            
            // Test with a score update
            if (score) {
                updateChatScoreGauge(75);
                console.log(' Gauge test completed - score updated to 75');
            }
        }

        // Channel connection functionality
        let isConnecting = false;
        let currentChannel = '';

        function updateConnectionStatus(status, text) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            const connectBtn = document.getElementById('connectBtn');
            const connectBtnText = document.getElementById('connectBtnText');
            
            statusElement.className = `status-${status}`;
            textElement.textContent = text;
            
            if (status === 'connecting') {
                connectBtn.disabled = true;
                connectBtnText.textContent = 'Connecting...';
            } else if (status === 'connected') {
                connectBtn.disabled = false;
                connectBtnText.textContent = 'Disconnect';
            } else {
                connectBtn.disabled = false;
                connectBtnText.textContent = 'Connect';
            }
        }

        async function connectToChannel() {
            const channelInput = document.getElementById('channelInput');
            const channel = channelInput.value.trim().toLowerCase();
            
            if (!channel) {
                alert('Please enter a Twitch channel name');
                return;
            }
            
            if (isConnecting) return;
            
            isConnecting = true;
            updateConnectionStatus('connecting', 'Connecting...');
            
            // Add timeout to prevent stuck "connecting" status
            const connectionTimeout = setTimeout(() => {
                if (isConnecting) {
                    isConnecting = false;
                    updateConnectionStatus('disconnected', 'Connection timeout');
                    alert('Connection timeout. Please try again.');
                }
            }, 15000); // 15 second timeout
            
            try {
                const response = await fetch('/api/connect-channel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ channel: channel })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    clearTimeout(connectionTimeout);
                    currentChannel = channel;
                    currentSessionId = result.sessionId; // Store the session ID
                    updateConnectionStatus('connected', `Connected to ${channel}`);
                    document.getElementById('channelName').textContent = channel;
                    
                    console.log(' [SESSION] Connected to session:', currentSessionId);
                    
                    // Reconnect WebSocket to get new data
                    if (ws) {
                        ws.close();
                    }
                    initWebSocket();
                } else {
                    clearTimeout(connectionTimeout);
                    updateConnectionStatus('disconnected', `Failed: ${result.error}`);
                    alert(`Failed to connect to channel: ${result.error}`);
                }
            } catch (error) {
                clearTimeout(connectionTimeout);
                console.error('Connection error:', error);
                updateConnectionStatus('disconnected', 'Connection failed');
                alert('Failed to connect to channel. Please try again.');
            } finally {
                isConnecting = false;
            }
        }

        async function disconnectFromChannel() {
            try {
                console.log(' [DISCONNECT] Attempting to disconnect - currentSessionId:', currentSessionId);
                
                const response = await fetch('/api/disconnect-channel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sessionId: currentSessionId })
                });
                
                if (response.ok) {
                    currentChannel = '';
                    currentSessionId = null; // Clear the session ID
                    updateConnectionStatus('disconnected', 'Not Connected');
                    document.getElementById('channelName').textContent = 'Not Connected';
                    
                    console.log(' [SESSION] Disconnected from session');
                    
                    // Close WebSocket
                    if (ws) {
                        ws.close();
                    }
                }
            } catch (error) {
                console.error('Disconnect error:', error);
            }
        }

        // Initialize phased UI system
        function initializePhasedUI() {
            console.log(' [PHASE] Initializing phased UI system...');
            
            // Get dashboard container
            dashboardContainer = document.getElementById('dashboard-container');
            
            if (dashboardContainer) {
                // Set initial phase
                dashboardContainer.className = 'phase-zero_viewers';
                
                // Initialize gauge subtitle
                updateGaugeSubtitle('zero_viewers');
                
                console.log(' [PHASE] Phased UI initialized - starting with zero_viewers phase');
            } else {
                console.error(' [PHASE] Dashboard container not found!');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Twitch Dashboard initialized');
            
            // Initialize phased UI system
            initializePhasedUI();
            
            // Initialize Zero to One features
            initializeMilestones();
            startStreamTimeTracking();
            
            // Force gauge display on desktop
            setTimeout(() => {
                forceGaugeDisplay();
            }, 1000);
            
            // Set default values
            document.getElementById('sessionId').textContent = 'Not Started';
            document.getElementById('channelName').textContent = 'No Channel';
            
            // Initialize strategic view panel
            const strategicPanel = document.getElementById('strategicPanel');
            const strategicToggle = document.getElementById('strategicToggle');
            
            if (strategicPanel && strategicToggle) {
                console.log(' Strategic view elements found and initialized');
                strategicPanel.style.display = 'none';
                strategicToggle.textContent = ' Strategic View';
            } else {
                console.error(' Strategic view elements not found');
            }
            
            // Channel input event listeners
            const channelInput = document.getElementById('channelInput');
            const connectBtn = document.getElementById('connectBtn');
            const connectBtnText = document.getElementById('connectBtnText');
            
            connectBtn.addEventListener('click', function() {
                if (currentChannel) {
                    disconnectFromChannel();
                } else {
                    connectToChannel();
                }
            });
            
            channelInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !currentChannel) {
                    connectToChannel();
                }
            });
            
            // Initialize connection status
            updateConnectionStatus('disconnected', 'Not Connected');
            
            // Set initial button state
            connectBtn.disabled = false;
            connectBtnText.textContent = 'Connect';
            document.getElementById('uptime').textContent = '00:00:00';
            
            // Test gauge on load
            setTimeout(() => {
                console.log(' Starting gauge test...');
                testGauge();
            }, 1000);
            
            initWebSocket();
            updateLanguage();
            
            // Update uptime every second
            setInterval(() => {
                const uptime = Date.now() - sessionStartTime;
                document.getElementById('uptime').textContent = formatUptime(uptime);
            }, 1000);
        });
    </script>
</body>
</html>