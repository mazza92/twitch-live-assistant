<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Live Dashboard</title>
    <style>
        :root {
            --animation-duration: 0.5s;
            --transition-duration: 0.3s;
            --shadow-intensity: 0.15;
            --twitch-purple: #9146ff;
            --twitch-dark: #0e0e10;
            --twitch-gray: #18181b;
            
            /* Zero to One Phase Colors */
            --phase-zero: #ff6b6b;
            --phase-first: #4ecdc4;
            --phase-building: #45b7d1;
            --phase-urgent: #ff9f43;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #9146ff 0%, #0e0e10 50%, #18181b 100%);
            color: white;
            overflow-x: hidden;
        }

        /* Zero to One Phase System - Single Layout with Phase Control */
        #dashboard-container {
            transition: all var(--transition-duration) ease-in-out;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }


        /* Live Viewers Metric */
        .live-viewers-metric {
            margin: 2rem auto 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.95), rgba(25, 25, 35, 0.95));
            border-radius: 20px;
            border: 2px solid rgba(0, 212, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .viewers-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .viewers-count {
            font-size: 3rem;
            font-weight: 900;
            color: #00d4ff;
            text-shadow: 0 4px 8px rgba(0, 212, 255, 0.3);
            margin: 0;
            line-height: 1;
        }

        .viewers-label {
            font-size: 1rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Clean Chat Score Gauge */
        .chat-score-gauge {
            margin: 2rem auto;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.95), rgba(25, 25, 35, 0.95));
            border-radius: 20px;
            border: 2px solid rgba(145, 70, 255, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
        }

        .gauge-title {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0 0 1.5rem 0;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .gauge-container {
            margin: 2rem 0;
        }

        .gauge-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.2), rgba(0, 212, 255, 0.2));
            border: 4px solid rgba(145, 70, 255, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 0 30px rgba(145, 70, 255, 0.3);
        }

        .gauge-score {
            font-size: 3rem;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            margin: 0;
            line-height: 1;
        }

        .gauge-status {
            font-size: 1rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .gauge-levels {
            display: flex !important;
            justify-content: space-around !important;
            margin-top: 2rem !important;
            gap: 0 !important;
            flex-wrap: nowrap !important;
            max-width: 100% !important;
            padding: 0 0.5rem !important;
        }

        .gauge-level {
            font-size: 0.7rem !important;
            font-weight: 600 !important;
            color: rgba(255, 255, 255, 0.6) !important;
            transition: all 0.3s ease !important;
            cursor: pointer !important;
            text-align: center !important;
            white-space: nowrap !important;
            padding: 0.4rem 0.1rem !important;
            position: relative !important;
            flex: 0 0 auto !important;
            min-width: 50px !important;
            max-width: 80px !important;
            margin: 0 !important;
        }

        .gauge-level:hover {
            color: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .gauge-level.active {
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.5);
        }

        .gauge-level.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: linear-gradient(90deg, #9146ff, #00d4ff);
            border-radius: 1px;
        }


        /* Main Metrics Grid - Single Instance */
        .main-metrics-grid {
            width: 100%;
            transition: all var(--transition-duration) ease-in-out;
            order: 3;
        }

        .key-metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
        }

        .analytics-grid .community-column,
        .analytics-grid .metrics-column,
        .analytics-grid .revenue-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* PHASE-BASED VISIBILITY CONTROL */

        /* ZERO VIEWERS PHASE - Minimalist Screen */
        .phase-zero_viewers {
            justify-content: center;
            text-align: center;
        }


        .phase-zero_viewers .ai-prompt-area-enhanced {
            transform: scale(1.1);
            margin-bottom: 5rem;
        }

        .phase-zero_viewers .ai-prompt-header {
            background: linear-gradient(135deg, var(--phase-zero) 0%, #ff8a80 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(255, 138, 128, 0.3);
        }

        .phase-zero_viewers .ai-prompt-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .phase-zero_viewers .ai-prompt-phase {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            display: inline-block;
        }

        .phase-zero_viewers .main-metrics-grid {
            display: none;
        }

        /* FIRST VIEWER PHASE - Celebration Screen */
        .phase-first_viewer {
            background: linear-gradient(135deg, var(--phase-first) 0%, #2c3e50 100%);
            border-radius: 20px;
            padding: 3rem;
        }



        .phase-first_viewer .ai-prompt-area-enhanced {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: urgentPulse 2s infinite;
        }

        .phase-first_viewer .main-metrics-grid {
            display: none;
        }

        /* BUILDING AUDIENCE PHASE - Full Dashboard */
        .phase-building_audience {
            align-items: flex-start;
            text-align: left;
        }



        .phase-building_audience .ai-prompt-area-enhanced {
            transform: scale(1);
            margin-bottom: 1rem;
        }

        .phase-building_audience .main-metrics-grid {
            display: block;
        }

        /* Desktop Spacing Enhancements */
        @media (min-width: 1200px) {
            .ai-prompt-area-enhanced {
                margin-bottom: 5rem;
            }
            
            .phase-zero_viewers .ai-prompt-area-enhanced {
                margin-bottom: 6rem;
            }
        }

        /* Large Desktop Optimization */
        @media (min-width: 1440px) {
            #dashboard-container {
                max-width: 1400px;
                margin: 0 auto;
            }
            
            .live-viewers-metric {
                padding: 3rem;
                margin: 3rem 0;
            }
            
            .viewers-count {
                font-size: 4rem;
            }
            
            .ai-prompt-area-enhanced {
                padding: 3rem;
                margin: 3rem 0;
            }
            
            .ai-prompt-title {
                font-size: 2rem;
            }
            
            .ai-prompt-message {
                font-size: 1.3rem;
            }
            
            .chat-score-gauge {
                padding: 3rem;
                margin: 3rem 0;
            }
            
            .gauge-circle {
                width: 200px;
                height: 200px;
            }
            
            .gauge-score {
                font-size: 3rem;
            }
            
            .gauge-levels {
                gap: 1rem;
                padding: 0 1rem;
            }
            
            .gauge-level {
                font-size: 0.8rem;
                padding: 0.6rem 0.3rem;
                min-width: 60px;
                max-width: 90px;
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .analytics-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Tablet Responsiveness */
        @media (max-width: 1024px) and (min-width: 769px) {
            #dashboard-container {
                padding: 1.5rem;
            }
            
            .live-viewers-metric {
                padding: 2rem;
                margin: 2rem 0;
            }
            
            .viewers-count {
                font-size: 3rem;
            }
            
            .ai-prompt-area-enhanced {
                padding: 2rem;
                margin: 2rem 0;
            }
            
            .ai-prompt-title {
                font-size: 1.6rem;
            }
            
            .chat-score-gauge {
                padding: 2rem;
                margin: 2rem 0;
            }
            
            .gauge-circle {
                width: 160px;
                height: 160px;
            }
            
            .gauge-score {
                font-size: 2.5rem;
            }
            
            .gauge-levels {
                gap: 0.6rem;
                padding: 0 0.5rem;
            }
            
            .gauge-level {
                font-size: 0.7rem;
                padding: 0.5rem 0.2rem;
                min-width: 50px;
                max-width: 75px;
            }
        }

        @media (max-width: 768px) {
            #dashboard-container {
                padding: 1rem;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .key-metrics-row {
                grid-template-columns: 1fr;
            }
            
            .ai-prompt-area-enhanced {
                margin-bottom: 3rem;
                padding: 1.5rem;
                transform: scale(1.01);
            }
            
            .ai-prompt-title {
                font-size: 1.4rem;
            }
            
            .ai-prompt-message {
                font-size: 1.1rem;
            }
            
            .live-viewers-metric {
                padding: 1.5rem;
                margin: 1.5rem 0;
            }
            
            .viewers-count {
                font-size: 2.5rem;
            }
            
            .chat-score-gauge {
                padding: 1.5rem;
                margin: 1.5rem 0;
            }
            
            .gauge-circle {
                width: 140px;
                height: 140px;
            }
            
            .gauge-score {
                font-size: 2.2rem;
            }
            
            .gauge-levels {
                gap: 0.4rem;
                padding: 0 0.3rem;
            }
            
            .gauge-level {
                font-size: 0.65rem;
                padding: 0.4rem 0.1rem;
                min-width: 45px;
                max-width: 70px;
            }
            
        }

        @media (max-width: 480px) {
            #dashboard-container {
                padding: 0.5rem;
            }
            
            .live-viewers-metric {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .viewers-count {
                font-size: 2rem;
            }
            
            .ai-prompt-area-enhanced {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .ai-prompt-title {
                font-size: 1.2rem;
            }
            
            .chat-score-gauge {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .gauge-circle {
                width: 120px;
                height: 120px;
            }
            
            .gauge-score {
                font-size: 1.8rem;
            }
            
            .gauge-levels {
                gap: 0.3rem;
                padding: 0 0.2rem;
            }
            
            .gauge-level {
                font-size: 0.6rem;
                padding: 0.3rem 0.05rem;
                min-width: 40px;
                max-width: 60px;
            }
            
            /* Mobile Overlay Adjustments */
        .first-viewer-alert {
                padding: 2rem 1rem;
            }
            
            .alert-content h2 {
                font-size: 1.8rem;
            }
            
            .alert-content p {
                font-size: 1rem;
            }
            
            .alert-buttons {
            flex-direction: column;
                gap: 1rem;
            }
            
            .alert-button {
                width: 100%;
                padding: 1rem;
            }
        }


        .first-viewer-content {
            text-align: center;
            animation: bounceIn 1s ease-out;
        }

        .first-viewer-title {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: pulse 2s infinite;
        }

        .first-viewer-message {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .first-viewer-close {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .first-viewer-close:hover {
            background: white;
            color: var(--phase-first);
        }

        @keyframes firstViewerCelebration {
            0% { opacity: 0; transform: scale(0.8); }
            20% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }


        /* Enhanced AI Prompt Area with ABT Coach - Streamer Focus */
        .ai-prompt-area-enhanced {
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.15) 0%, rgba(0, 0, 0, 0.4) 100%);
            border: 3px solid var(--twitch-purple);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 8px 32px rgba(145, 70, 255, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        .ai-prompt-area-enhanced:hover {
            transform: scale(1.03);
            box-shadow: 
                0 12px 40px rgba(145, 70, 255, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .ai-prompt-content {
            text-align: center;
        }

        .ai-prompt-message {
            font-size: 1.2rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 1rem;
            line-height: 1.5;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            animation: fadeInPrompt 0.5s ease-in-out;
            min-height: 60px;
            display: flex;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
        }
        
        @keyframes fadeInPrompt {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-prompt-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* API Configuration Styles */
        .api-config {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .api-config h4 {
            color: #ffffff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .config-item {
            margin-bottom: 1rem;
        }

        .config-item label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .config-item input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 0.9rem;
        }

        .config-item input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .api-config button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .api-config button:hover {
            background: var(--accent-hover);
        }

        .api-config-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.8);
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
        }

        .api-config-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        /* Intelligent Prompt Indicators */
        .ai-prompt-message.news {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .ai-prompt-message.facts {
            border-left-color: #FF9800;
            background: rgba(255, 152, 0, 0.1);
        }

        .ai-prompt-message.fallback {
            border-left-color: #9C27B0;
            background: rgba(156, 39, 176, 0.1);
        }

        /* AI Analysis Indicator */
        .ai-analysis-indicator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            animation: aiPulse 2s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .ai-prompt-priority {
            font-size: 0.9rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ai-prompt-category {
            font-size: 0.8rem;
            font-weight: 500;
            color: rgba(145, 70, 255, 0.9);
            background: rgba(145, 70, 255, 0.15);
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            display: inline-block;
            text-transform: capitalize;
            letter-spacing: 0.3px;
        }

        /* ABT Coach Timer */
        .abt-timer-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(145, 70, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(145, 70, 255, 0.2);
        }

        .abt-timer-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff4444 0deg,
                #ff8800 90deg,
                #88ff88 180deg,
                #00ddff 270deg,
                #ff4444 360deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: timerPulse 1s ease-in-out infinite, rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .abt-timer-inner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(10, 10, 20, 0.95), rgba(20, 20, 30, 0.95));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            color: #ffffff;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.8);
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .abt-timer-text {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }

        .abt-mute-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .abt-mute-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .abt-mute-toggle.muted {
            background: rgba(255, 68, 68, 0.2);
            border-color: rgba(255, 68, 68, 0.4);
            color: #ff6b6b;
        }

        /* First Viewer Catcher */
        .first-viewer-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.95), rgba(145, 70, 255, 0.95));
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: firstViewerCelebration 3s ease-in-out;
        }

        .first-viewer-alert.show {
            display: flex;
        }

        @keyframes firstViewerCelebration {
            0% { 
                opacity: 0; 
                transform: scale(0.8);
            }
            20% { 
                opacity: 1; 
                transform: scale(1.1);
            }
            80% { 
                opacity: 1; 
                transform: scale(1);
            }
            100% { 
                opacity: 0; 
                transform: scale(1);
            }
        }

        .first-viewer-content {
            text-align: center;
            color: white;
            z-index: 10001;
        }

        .first-viewer-title {
            font-size: 4.5rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            animation: titleBounce 1s ease-in-out infinite alternate;
        }

        .first-viewer-subtitle {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #ff6b6b;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: urgentPulse 1.5s infinite;
            text-shadow: 0 0 15px rgba(255, 107, 107, 0.6);
        }

        @keyframes titleBounce {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .first-viewer-message {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .first-viewer-greeting {
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .first-viewer-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .first-viewer-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .first-viewer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .auto-hide-countdown {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 1rem;
            text-align: center;
            font-style: italic;
        }

        #countdownNumber {
            font-weight: bold;
            color: #ff6b6b;
        }

        /* Confetti Animation */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            animation: confettiFall 3s linear infinite;
        }

        .confetti:nth-child(odd) {
            background: #4ecdc4;
            animation-delay: -0.5s;
        }

        .confetti:nth-child(even) {
            background: #45b7d1;
            animation-delay: -1s;
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* PERSISTENCE ENGINE - Milestone Notifications */
        .milestone-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10002;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.5s ease-in-out;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .milestone-notification.show {
            transform: translateX(0);
        }

        .milestone-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .milestone-icon {
            font-size: 2.5rem;
            animation: bounce 1s infinite;
        }

        .milestone-message {
            flex: 1;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            line-height: 1.4;
        }

        .milestone-close {
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .milestone-close:hover {
            opacity: 1;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Stream Summary Styling */
        .stream-summary {
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.95), rgba(25, 25, 35, 0.95));
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid rgba(78, 205, 196, 0.4);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .stream-summary h3 {
            color: #4ecdc4;
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .encouragement-message {
            background: rgba(78, 205, 196, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            color: white;
            font-size: 1.1rem;
            line-height: 1.6;
            text-align: center;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        /* Persistence Engine - Milestones */
        .milestones-section {
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.95), rgba(30, 30, 45, 0.95));
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(145, 70, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .milestones-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1.5rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.5);
        }

        .milestones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .milestone-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .milestone-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(145, 70, 255, 0.2);
        }

        .milestone-card.completed {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(145, 70, 255, 0.2));
            border-color: rgba(78, 205, 196, 0.4);
        }

        .milestone-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .milestone-icon {
            font-size: 1.5rem;
        }

        .milestone-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }

        .milestone-progress {
            margin-bottom: 1rem;
        }

        .milestone-progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .milestone-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .milestone-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .milestone-progress-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 0.5rem;
            text-align: center;
        }

        .milestone-description {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.4;
        }

        .milestone-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Stream Summary */
        .stream-summary {
            background: linear-gradient(135deg, rgba(145, 70, 255, 0.1), rgba(78, 205, 196, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid rgba(145, 70, 255, 0.2);
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 1rem;
            text-align: center;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .summary-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .summary-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 0.5rem;
        }

        .summary-stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .ai-prompt-area-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }

        .ai-prompt-area-enhanced.urgent {
            border-color: var(--phase-urgent);
            background: linear-gradient(135deg, rgba(255, 159, 67, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
            animation: urgentPulse 1s infinite;
        }

        .ai-prompt-area-enhanced.high-priority {
            border-color: var(--phase-first);
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2) 0%, rgba(0, 0, 0, 0.3) 100%);
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes urgentPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 159, 67, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 159, 67, 0.8); }
        }

        /* Phase-specific visibility */
        .phase-zero_viewers .metric-card:not(.chat-score-card):not(.ai-prompt-card),
        .phase-zero_viewers .revenue-metrics,
        .phase-zero_viewers .top-users,
        .phase-zero_viewers .chat-activity-log {
            display: none !important;
        }


        .phase-building_audience .metric-card,
        .phase-building_audience .revenue-metrics,
        .phase-building_audience .top-users,
        .phase-building_audience .chat-activity-log {
            display: block;
        }


        /* Header Styles */
        .header {
            background: rgba(14, 14, 16, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--twitch-purple);
            box-shadow: 0 4px 20px rgba(145, 70, 255, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(145, 70, 255, 0.8);
        }

        .header h1 .emoji {
            font-size: 2.8rem;
            margin-right: 15px;
            filter: drop-shadow(0 0 10px rgba(145, 70, 255, 0.6));
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        /* Channel Input Display */
        .channel-input-display {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .channel-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .channel-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 200px;
        }

        .channel-input-group label {
            font-size: 0.9rem;
            color: #ccc;
            font-weight: 500;
        }

        .channel-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(145, 70, 255, 0.3);
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .channel-input:focus {
            outline: none;
            border-color: var(--twitch-purple);
            box-shadow: 0 0 15px rgba(145, 70, 255, 0.4);
            background: rgba(255, 255, 255, 0.15);
        }

        .channel-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .connect-btn {
            background: linear-gradient(135deg, var(--twitch-purple), #7c3aed);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.3);
            min-width: 120px;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(145, 70, 255, 0.4);
            background: linear-gradient(135deg, #a855f7, var(--twitch-purple));
        }

        .connect-btn:active {
            transform: translateY(0);
        }

        .connect-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-connected { color: #4CAF50; }
        .status-connecting { color: #FFC107; }
        .status-disconnected { color: #f44336; }

        /* Session Info Display */
        .session-info-display {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .session-info {
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.95rem;
            justify-content: center;
        }

        .session-info span {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0;
            background: none;
            border: none;
        }

        .session-id { color: #4CAF50; font-weight: 600; }
        .session-status { color: #FFC107; font-weight: 600; }
        .session-username { color: #2196F3; font-weight: 600; }
        .session-topic { color: #FF9800; font-weight: 600; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .total-sessions { color: #9C27B0; font-weight: 600; }
        .last-update { color: #607D8B; font-weight: 600; font-size: 12px; }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 8px;
            margin: 20px;
            border: 2px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .language-btn {
            background: rgba(145, 70, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(145, 70, 255, 0.3);
        }

        .language-btn:hover {
            background: rgba(145, 70, 255, 0.4);
            transform: translateY(-2px);
        }

        .language-btn.active {
            background: var(--twitch-purple);
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.4);
        }

        /* Tier 2: Current State Panel */
        .current-state-panel {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .current-state-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .community-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .alerts-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Tier 3: Strategic View Panel */
        .strategic-view-panel {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden by default */
        }

        .strategic-view-panel.visible {
            display: block;
        }

        .strategic-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--twitch-purple), #7c3aed);
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(145, 70, 255, 0.3);
            z-index: 1000;
        }

        .strategic-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(145, 70, 255, 0.4);
        }

        /* Main Dashboard Grid (Legacy) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Metric Cards */
        .metric-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(145, 70, 255, 0.3);
            border-color: rgba(145, 70, 255, 0.6);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--twitch-purple), #ffffff);
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.3);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(145, 70, 255, 0.6);
            transition: all 0.3s ease;
        }

        .metric-value.updated {
            animation: valueUpdate 0.5s ease;
        }

        @keyframes valueUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .metric-subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .trend-up { color: #4CAF50; }
        .trend-down { color: #f44336; }
        .trend-stable { color: #FFC107; }

        /* Twitch Specific Metrics */
        .twitch-metrics {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .twitch-metric {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .twitch-metric:hover {
            background: rgba(145, 70, 255, 0.2);
            transform: scale(1.05);
        }

        .twitch-metric-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .twitch-metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(145, 70, 255, 0.5);
        }

        .twitch-metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Chat Activity */
        .chat-activity {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .chat-message {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-left: 3px solid var(--twitch-purple);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .chat-username {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-right: 10px;
        }

        .chat-text {
            color: #ffffff;
        }

        .chat-timestamp {
            font-size: 0.8rem;
            opacity: 0.6;
            float: right;
        }

        /* Top Users */
        .top-users {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .user-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .user-item {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .user-item:hover {
            background: rgba(145, 70, 255, 0.2);
            transform: translateY(-2px);
        }

        .user-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .user-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Revenue Metrics */
        .revenue-metrics {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 193, 7, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .revenue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        /* Revenue Breakdown */
        .revenue-breakdown {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 1px solid rgba(255, 193, 7, 0.2);
        }
        
        .breakdown-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFC107;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .breakdown-item.total {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            font-weight: 600;
        }
        
        .breakdown-label {
            color: #E0E0E0;
            font-size: 14px;
        }
        
        .breakdown-value {
            color: #4CAF50;
            font-weight: 600;
            font-size: 14px;
        }
        
        .breakdown-item.total .breakdown-value {
            color: #FFC107;
            font-size: 16px;
        }

        /* AI Prompts */
        .ai-prompts {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .prompt-item {
            background: rgba(145, 70, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid var(--twitch-purple);
        }

        .prompt-type {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-bottom: 5px;
        }

        .prompt-message {
            color: #ffffff;
            margin-bottom: 5px;
        }

        .prompt-timestamp {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 6px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }

        .status-online { 
            background: #4CAF50; 
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
            animation: pulse-green 2s infinite;
        }
        .status-offline { 
            background: #f44336; 
            box-shadow: 0 0 15px rgba(244, 67, 54, 0.6);
        }
        .status-connecting { 
            background: #FFC107; 
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.6);
            animation: pulse-yellow 1s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes pulse-yellow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .current-state-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .urgent-content {
                flex-direction: column;
                gap: 15px;
                height: auto;
                padding: 15px 0;
            }
            
            .ai-prompt-area {
                flex: 1;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
        }

        @media (max-width: 768px) {
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .metric-value {
                font-size: 2rem;
            }
            
            .strategic-toggle {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(145, 70, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--twitch-purple);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

































        /* Strategic Metrics Styling */
        .strategic-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .recommendation-card {
            background: rgba(145, 70, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(145, 70, 255, 0.3);
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            background: rgba(145, 70, 255, 0.15);
            transform: translateY(-2px);
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--twitch-purple);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-text {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .health-score-excellent {
            color: #4CAF50;
        }

        .health-score-good {
            color: #FFC107;
        }

        .health-score-poor {
            color: #f44336;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--twitch-purple);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7c3aed;
        }
    </style>
</head>
<body>


    <div class="header">
        <h1><span class="emoji">🎮</span>Twitch Live Dashboard</h1>
        <p>Real-time analytics and engagement tracking for your Twitch stream</p>
    </div>

    <!-- Channel Input -->
    <div class="channel-input-display">
        <div class="channel-input-container">
            <div class="channel-input-group">
                <label for="channelInput">Twitch Channel</label>
                <input 
                    type="text" 
                    id="channelInput" 
                    class="channel-input" 
                    placeholder="Enter channel name (e.g., kamet0)"
                    value=""
                >
            </div>
            <button id="connectBtn" class="connect-btn">
                <span id="connectBtnText">Connect</span>
            </button>
            <div class="connection-status">
                <span id="connectionStatus" class="status-disconnected">●</span>
                <span id="connectionText">Not Connected</span>
            </div>
        </div>
    </div>

    <!-- Session Info -->
    <div class="session-info-display">
        <div class="session-info">
            <span class="session-id">Session: <span id="sessionId">Loading...</span></span>
            <span class="session-status">Status: <span id="sessionStatus" class="status-indicator status-disconnected"></span><span id="statusText">Not Connected</span></span>
            <span class="session-username">Channel: <span id="channelName">No Channel</span></span>
            <span class="session-topic">Topic: <span id="streamTopic">No Stream</span></span>
            <span class="total-sessions">Uptime: <span id="uptime">00:00:00</span></span>
            <span class="last-update">Last Update: <span id="lastUpdate">--:--:--</span></span>
        </div>
    </div>

    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="language-btn active" onclick="setLanguage('en')">🇺🇸 English</button>
        <button class="language-btn" onclick="setLanguage('fr')">🇫🇷 Français</button>
        <button class="language-btn" onclick="setLanguage('es')">🇪🇸 Español</button>
        <button class="language-btn" onclick="setLanguage('de')">🇩🇪 Deutsch</button>
    </div>

    <!-- Main Dashboard Container - Single Layout with Phase Control -->
    <div id="dashboard-container" class="phase-zero_viewers">
        
        <!-- Live Viewers Count Metric -->
        <div class="live-viewers-metric" id="liveViewersMetric">
            <div class="viewers-icon">👥</div>
            <div class="viewers-count" id="viewersCount">0</div>
            <div class="viewers-label" data-translate="liveViewers">Live Viewers</div>
        </div>
        
        <!-- AI Prompt Area with ABT Coach - Right Below Live Viewers -->
        <div class="ai-prompt-area-enhanced ai-prompt-card" id="aiPromptAreaEnhanced">
            <!-- API Configuration (Hidden) -->
            <div class="api-config" id="apiConfig" style="display: none;">
                <h4>🔧 API Configuration</h4>
                <div class="config-item">
                    <label for="newsApiKey">News API Key:</label>
                    <input type="text" id="newsApiKey" placeholder="Enter your NewsAPI key (optional)" />
                </div>
                <div class="config-item">
                    <label for="factsApiUrl">Facts API URL:</label>
                    <input type="text" id="factsApiUrl" value="https://uselessfacts.jsph.pl/random.json?language=en" />
                </div>
                <button onclick="saveApiConfig()">Save Configuration</button>
            </div>
            
            <!-- ABT Coach Timer -->
            <div class="abt-timer-container" id="abtTimerContainer" style="display: none;">
                <div class="abt-timer-circle">
                    <div class="abt-timer-inner" id="abtTimerDisplay">30</div>
                </div>
                <div class="abt-timer-text">Next prompt in</div>
                <button class="abt-mute-toggle" id="abtMuteToggle">🔊 Mute</button>
                <button class="api-config-toggle" id="apiConfigToggle" onclick="toggleApiConfig()">⚙️</button>
            </div>
            
            <div class="ai-prompt-header">
                <div class="ai-prompt-title" data-translate="aiCoPilot">🤖 Your AI Co-Pilot</div>
                <div class="ai-prompt-phase" id="aiPromptPhase" data-translate="zeroViewers">Zero Viewers</div>
            </div>
            <div class="ai-prompt-content">
                <div class="ai-prompt-message" id="aiPromptMessage" data-translate="aiAnalyzing">🤖 AI is analyzing news and facts to generate your next prompt...</div>
                <div class="ai-prompt-meta">
                <div class="ai-prompt-priority" id="aiPromptPriority">Normal</div>
                    <div class="ai-prompt-category" id="aiPromptCategory" style="display: none;"></div>
                    <div class="ai-analysis-indicator" id="aiAnalysisIndicator" style="display: none;">
                        🤖 AI Analyzed
            </div>
        </div>
        </div>
                </div>
                
        <!-- Clean Chat Score Gauge -->
        <div class="chat-score-gauge" id="chatScoreGauge">
            <h3 class="gauge-title" data-translate="chatScore">Chat Score</h3>
            <div class="gauge-container">
                <div class="gauge-circle">
                    <div class="gauge-score" id="gaugeScore">0</div>
                    <div class="gauge-status" id="gaugeStatus">Starting</div>
                </div>
            </div>
            <div class="gauge-levels">
                <div class="gauge-level" data-level="0" data-translate="quiet" data-emoji="😴">😴 Quiet</div>
                <div class="gauge-level" data-level="1" data-translate="low" data-emoji="📊">📊 Low</div>
                <div class="gauge-level" data-level="2" data-translate="moderate" data-emoji="📈">📈 Moderate</div>
                <div class="gauge-level" data-level="3" data-translate="high" data-emoji="🔥">🔥 High</div>
                <div class="gauge-level" data-level="4" data-translate="fire" data-emoji="🚀">🚀 Fire</div>
            </div>
            </div>
            
        <!-- FLAGSHIP FEATURE: First Viewer Catcher Alert -->
        <div class="first-viewer-alert" id="firstViewerAlert">
            <div class="first-viewer-content">
                <div class="first-viewer-title" data-translate="firstViewerTitle">🎉 VIEWER ALERT! 🎉</div>
                <div class="first-viewer-subtitle">FLAGSHIP FEATURE - CONVERT ZERO TO ONE!</div>
                <div class="first-viewer-message" id="firstViewerMessage" data-translate="firstViewerMessage">Someone just joined your stream!</div>
                <div class="first-viewer-greeting" id="firstViewerGreeting" data-translate="welcomeToStream">Welcome to the stream!</div>
                <div class="first-viewer-actions">
                    <button class="first-viewer-btn" id="closeAlertBtn" data-translate="close">✕ Close</button>
                    <div class="auto-hide-countdown" id="autoHideCountdown" style="display: none;" data-translate="autoClosingIn">Auto-closing in <span id="countdownNumber">5</span>s</div>
                </div>
            </div>
            <!-- Enhanced Confetti -->
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            </div>
            
        <!-- Persistence Engine - Milestones Section -->
        <div class="milestones-section" id="milestonesSection" style="display: none;">
            <div class="milestones-title" data-translate="yourJourneyMilestones">🏆 Your Journey Milestones</div>
            <div class="milestones-grid" id="milestonesGrid">
                <!-- Milestones will be populated by JavaScript -->
            </div>
            <div class="stream-summary" id="streamSummary">
                <div class="summary-title" data-translate="sessionSummary">📊 Session Summary</div>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="totalStreamTime">0m</div>
                        <div class="summary-stat-label">Stream Time</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="uniqueViewers">0</div>
                        <div class="summary-stat-label" data-translate="uniqueViewers">Unique Viewers</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="messagesSent">0</div>
                        <div class="summary-stat-label" data-translate="messagesSent">Messages Sent</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-value" id="milestonesReached">0</div>
                        <div class="summary-stat-label" data-translate="milestones">Milestones</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Metrics Grid - Single Instance -->
        <div class="main-metrics-grid">
            <!-- Key Metrics Row -->
            <div class="key-metrics-row">
                <div class="metric-card">
                    <div class="metric-title">👥 Current Viewers</div>
                    <div class="metric-value" id="currentViewers">0</div>
                    <div class="metric-subtitle" data-translate="liveViewerCount">Live viewer count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">📈 Peak Viewers</div>
                    <div class="metric-value" id="peakViewers">0</div>
                    <div class="metric-subtitle" data-translate="highestViewerCount">Highest viewer count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">💬 Messages/Min</div>
                    <div class="metric-value" id="messagesPerMinute">0</div>
                    <div class="metric-subtitle">Chat activity rate</div>
                </div>
            </div>

            <!-- Analytics Grid -->
            <div class="analytics-grid">
                <!-- Community Column -->
                <div class="community-column">
                    <div class="top-users">
                        <div class="metric-title">🏆 Top Engaged Users</div>
                        <div class="user-list" id="topUsers">
                            <div class="user-item">
                                <div class="user-name">Loading...</div>
                                <div class="user-stats">
                                    <span>Messages: 0</span>
                                    <span>Bits: 0</span>
                                    <span>Subs: 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chat-activity">
                        <div class="metric-title">💬 Recent Chat Activity</div>
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message">
                                <span class="chat-username">System:</span>
                                <span class="chat-text">Waiting for chat messages...</span>
                                <span class="chat-timestamp">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Column -->
                <div class="metrics-column">
                    <div class="metric-card">
                        <div class="metric-title">📺 Stream Status</div>
                        <div class="metric-value" id="streamStatus">Offline</div>
                        <div class="metric-subtitle">Current stream status</div>
                        <div class="metric-trend">
                            <span class="status-indicator status-offline"></span>
                            <span id="streamStatusText">Not streaming</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title">🎉 Total Subs</div>
                        <div class="metric-value" id="totalSubsMain">0</div>
                        <div class="metric-subtitle">Total subscriptions</div>
                        <div class="metric-trend">
                            <span class="trend-indicator" id="subsTrend">+0 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title">👥 Total Followers</div>
                        <div class="metric-value" id="totalFollowers">0</div>
                        <div class="metric-subtitle">Channel total followers</div>
                        <div class="metric-trend">
                            <span class="trend-indicator" id="followersTrend">+0 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title">💰 Stream Revenue</div>
                        <div class="metric-value" id="streamTotalRevenue">$0.00</div>
                        <div class="metric-subtitle">Total earned</div>
                        <div class="metric-trend">
                            <span id="revenueTrend" class="trend-stable">→</span>
                            <span id="revenueTrendText">$0.00 this session</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title">😊 Chat Sentiment</div>
                        <div class="metric-value" id="sentimentScore">0.0</div>
                        <div class="metric-subtitle">Overall chat mood</div>
                        <div class="metric-trend">
                            <span id="sentimentEmoji">😐</span>
                            <span id="sentimentText">Neutral</span>
                        </div>
                    </div>
                </div>

                <!-- Revenue Column -->
                <div class="revenue-column">
                    <div class="revenue-metrics">
                        <div class="metric-title">💰 Revenue Metrics</div>
                        <div class="revenue-grid">
                            <div class="metric-card">
                                <div class="metric-title">💎 Bits Earned</div>
                                <div class="metric-value" id="totalBits">0</div>
                                <div class="metric-subtitle">Total bits this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title">🎉 Subscriptions</div>
                                <div class="metric-value" id="totalSubs">0</div>
                                <div class="metric-subtitle">Total subs this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title">⚔️ Raids Received</div>
                                <div class="metric-value" id="totalRaids">0</div>
                                <div class="metric-subtitle">Total raids this session</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                                </div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-title">📈 Revenue Rate</div>
                                <div class="metric-value" id="revenueRate">$0.00/hr</div>
                                <div class="metric-subtitle">Estimated hourly rate</div>
                                <div class="metric-trend">
                                    <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Grid (Legacy - will be moved to Tier 3) -->
    <div class="dashboard-grid" style="display: none;">
        <!-- Stream Status -->
        <div class="metric-card">
            <div class="metric-title">📺 Stream Status</div>
            <div class="metric-value" id="streamStatus">Offline</div>
            <div class="metric-subtitle">Current stream status</div>
            <div class="metric-trend">
                <span class="status-indicator status-offline"></span>
                <span id="streamStatusText">Not streaming</span>
            </div>
        </div>

        <!-- Current Viewers -->
        <div class="metric-card">
            <div class="metric-title">👥 Current Viewers</div>
            <div class="metric-value" id="currentViewers">0</div>
            <div class="metric-subtitle">Live viewer count</div>
            <div class="metric-trend">
                <span id="viewerTrend" class="trend-stable">→</span>
                <span id="viewerChange">+0</span>
            </div>
        </div>

        <!-- Peak Viewers -->
        <div class="metric-card">
            <div class="metric-title">📈 Peak Viewers</div>
            <div class="metric-value" id="peakViewers">0</div>
            <div class="metric-subtitle">Highest viewer count</div>
            <div class="metric-trend">
                <span class="trend-up">↗</span>
                <span id="peakViewerTime">Today</span>
            </div>
        </div>

        <!-- Total Subs -->
        <div class="metric-card">
            <div class="metric-title">🎉 Total Subs</div>
            <div class="metric-value" id="totalSubsMain">0</div>
            <div class="metric-subtitle">Total subscriptions</div>
            <div class="metric-trend">
                <span class="trend-indicator" id="subsTrend">+0 this session</span>
            </div>
        </div>

        <!-- Total Followers -->
        <div class="metric-card">
            <div class="metric-title">👥 Total Followers</div>
            <div class="metric-value" id="totalFollowers">0</div>
            <div class="metric-subtitle">Channel total followers</div>
            <div class="metric-trend">
                <span class="trend-indicator" id="followersTrend">+0 this session</span>
            </div>
        </div>

        <!-- Stream Total Revenue -->
        <div class="metric-card">
            <div class="metric-title">💰 Stream Revenue</div>
            <div class="metric-value" id="streamTotalRevenue">$0.00</div>
            <div class="metric-subtitle">Total earned</div>
            <div class="metric-trend">
                <span id="revenueTrend" class="trend-stable">→</span>
                <span id="revenueTrendText">$0.00 this session</span>
            </div>
        </div>

        <!-- Twitch Specific Metrics -->
        <div class="twitch-metrics">
            <div class="twitch-metric">
                <div class="twitch-metric-icon">👥</div>
                <div class="twitch-metric-value" id="newFollowers">0</div>
                <div class="twitch-metric-label">New Followers</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon">🎉</div>
                <div class="twitch-metric-value" id="newSubs">0</div>
                <div class="twitch-metric-label">New Subs</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon">💰</div>
                <div class="twitch-metric-value" id="bitsEarned">0</div>
                <div class="twitch-metric-label">Bits Earned</div>
            </div>
            <div class="twitch-metric">
                <div class="twitch-metric-icon">⚔️</div>
                <div class="twitch-metric-value" id="raidsReceived">0</div>
                <div class="twitch-metric-label">Raids Received</div>
            </div>
        </div>



        <!-- Stream Info -->
        <div class="metric-card">
            <div class="metric-title">📺 Chat score</div>
            <div class="metric-subtitle">Title: <span id="streamTitle">No stream</span></div>
            <div class="metric-subtitle">Game: <span id="gameCategory">Not set</span></div>
            <div class="metric-subtitle">Language: <span id="streamLanguage">en</span></div>
            <div class="metric-subtitle">Started: <span id="streamStartTime">Not started</span></div>
        </div>

        <!-- Sentiment Analysis -->
        <div class="metric-card">
            <div class="metric-title">😊 Chat Sentiment</div>
            <div class="metric-value" id="sentimentScore">0.0</div>
            <div class="metric-subtitle">Overall chat mood</div>
            <div class="metric-trend">
                <span id="sentimentEmoji">😐</span>
                <span id="sentimentText">Neutral</span>
            </div>
        </div>

        <!-- Chat Activity -->
        <div class="chat-activity">
            <div class="metric-title">💬 Recent Chat Activity</div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message">
                    <span class="chat-username">System:</span>
                    <span class="chat-text">Waiting for chat messages...</span>
                    <span class="chat-timestamp">--:--</span>
                </div>
            </div>
        </div>

        <!-- Top Engaged Users -->
        <div class="top-users">
            <div class="metric-title">🏆 Top Engaged Users</div>
            <div class="user-list" id="topUsers">
                <div class="user-item">
                    <div class="user-name">Loading...</div>
                    <div class="user-stats">
                        <span>Messages: 0</span>
                        <span>Bits: 0</span>
                        <span>Subs: 0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Metrics -->
        <div class="revenue-metrics">
            <div class="metric-title">💰 Revenue Metrics</div>
            <div class="revenue-grid">
                <div class="metric-card">
                    <div class="metric-title">💎 Bits Earned</div>
                    <div class="metric-value" id="totalBits">0</div>
                    <div class="metric-subtitle">Total bits this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">🎉 Subscriptions</div>
                    <div class="metric-value" id="totalSubs">0</div>
                    <div class="metric-subtitle">Total subs this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">⚔️ Raids Received</div>
                    <div class="metric-value" id="totalRaids">0</div>
                    <div class="metric-subtitle">Total raids this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                    </div>
                </div>
                
                   <div class="metric-card">
                       <div class="metric-title">📈 Revenue Rate</div>
                       <div class="metric-value" id="revenueRate">$0.00/hr</div>
                       <div class="metric-subtitle">Estimated hourly rate</div>
                       <div class="metric-trend">
                           <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                       </div>
                   </div>
               </div>
               
               <!-- Revenue Breakdown -->
               <div class="revenue-breakdown">
                   <div class="breakdown-title">💰 Revenue Breakdown</div>
                   <div class="breakdown-grid">
                       <div class="breakdown-item">
                           <span class="breakdown-label">Bits Revenue:</span>
                           <span class="breakdown-value" id="bitsRevenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 1 Subs:</span>
                           <span class="breakdown-value" id="tier1Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 2 Subs:</span>
                           <span class="breakdown-value" id="tier2Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item">
                           <span class="breakdown-label">Tier 3 Subs:</span>
                           <span class="breakdown-value" id="tier3Revenue">$0.00</span>
                       </div>
                       <div class="breakdown-item total">
                           <span class="breakdown-label">Total Revenue:</span>
                           <span class="breakdown-value" id="totalRevenue">$0.00</span>
                       </div>
                   </div>
            </div>
        </div>

        <!-- AI Prompts -->
        <div class="ai-prompts">
            <div class="metric-title">🤖 AI-Generated Prompts</div>
            <div id="aiPrompts">
                <div class="prompt-item">
                    <div class="prompt-type">System</div>
                    <div class="prompt-message">Waiting for AI prompts...</div>
                    <div class="prompt-timestamp">--:--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tier 3: Strategic View Panel -->
    <div class="strategic-view-panel" id="strategicPanel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="metric-title" style="font-size: 1.5rem; margin: 0;" data-translate="strategicAnalytics">
                📊 Strategic Analytics Dashboard
            </div>
            <button onclick="toggleStrategicView()" style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;" data-translate="close">
                ✕ Close
            </button>
        </div>
        
        <!-- Revenue Metrics -->
        <div class="revenue-metrics">
            <div class="metric-title" style="font-size: 1.2rem; margin-bottom: 15px;">💰 Revenue Metrics</div>
            <div class="revenue-grid">
                <div class="metric-card">
                    <div class="metric-title">💎 Bits Earned</div>
                    <div class="metric-value" id="totalBits">0</div>
                    <div class="metric-subtitle">Total bits this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionBits">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">🎉 Subscriptions</div>
                    <div class="metric-value" id="totalSubs">0</div>
                    <div class="metric-subtitle">Total subs this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionSubs">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">⚔️ Raids Received</div>
                    <div class="metric-value" id="totalRaids">0</div>
                    <div class="metric-subtitle">Total raids this session</div>
                    <div class="metric-trend">
                        <span class="trend-indicator">+<span id="sessionRaids">0</span> this session</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-title">📈 Revenue Rate</div>
                    <div class="metric-value" id="revenueRate">$0.00/hr</div>
                    <div class="metric-subtitle">Estimated hourly rate</div>
                    <div class="metric-trend">
                        <span class="trend-indicator"><span id="bitsPerMinute">0</span> bits/min</span>
                    </div>
                </div>
            </div>
            
            <!-- Revenue Breakdown -->
            <div class="revenue-breakdown">
                <div class="breakdown-title">💰 Revenue Breakdown</div>
                <div class="breakdown-grid">
                    <div class="breakdown-item">
                        <span class="breakdown-label">Bits Revenue:</span>
                        <span class="breakdown-value" id="bitsRevenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 1 Subs:</span>
                        <span class="breakdown-value" id="tier1Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 2 Subs:</span>
                        <span class="breakdown-value" id="tier2Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-label">Tier 3 Subs:</span>
                        <span class="breakdown-value" id="tier3Revenue">$0.00</span>
                    </div>
                    <div class="breakdown-item total">
                        <span class="breakdown-label">Total Revenue:</span>
                        <span class="breakdown-value" id="totalRevenue">$0.00</span>
                    </div>
                </div>
            </div>
        </div>


        <!-- Stream Info -->
        <div class="metric-card">
            <div class="metric-title">📺 Stream Information</div>
            <div class="metric-subtitle">Title: <span id="streamTitle">No stream</span></div>
            <div class="metric-subtitle">Game: <span id="gameCategory">Not set</span></div>
            <div class="metric-subtitle">Language: <span id="streamLanguage">en</span></div>
            <div class="metric-subtitle">Started: <span id="streamStartTime">Not started</span></div>
        </div>

        <!-- Additional Strategic Metrics -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div class="metric-card">
                <div class="metric-title">📈 Peak Viewers</div>
                <div class="metric-value" id="peakViewersStrategic">0</div>
                <div class="metric-subtitle">Highest viewer count</div>
                <div class="metric-trend">
                    <span class="trend-up">↗</span>
                    <span id="peakViewerTimeStrategic">Today</span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-title">⏱️ Stream Duration</div>
                <div class="metric-value" id="streamDuration">00:00:00</div>
                <div class="metric-subtitle">Current session length</div>
                <div class="metric-trend">
                    <span class="trend-stable">→</span>
                    <span id="streamDurationText">Live now</span>
                </div>
            </div>
        </div>

        <!-- Strategic Analytics Grid -->
        <div class="strategic-metrics-grid">
            <!-- Health Score -->
            <div class="metric-card">
                <div class="metric-title">💚 Stream Health Score</div>
                <div class="metric-value" id="healthScore">0</div>
                <div class="metric-subtitle">Overall stream performance</div>
                <div class="metric-trend">
                    <span id="healthScoreText">Calculating...</span>
                </div>
            </div>

            <!-- Predicted Retention -->
            <div class="metric-card">
                <div class="metric-title">📊 Predicted Retention</div>
                <div class="metric-value" id="predictedRetention">0%</div>
                <div class="metric-subtitle">Expected viewer retention</div>
                <div class="metric-trend">
                    <span id="retentionRec">Calculating...</span>
                </div>
            </div>

            <!-- Projected Revenue -->
            <div class="metric-card">
                <div class="metric-title">💰 Projected Revenue</div>
                <div class="metric-value" id="projectedRevenue">$0.00</div>
                <div class="metric-subtitle">Monthly projection</div>
                <div class="metric-trend">
                    <span id="revenueTip">Calculating...</span>
                </div>
            </div>

            <!-- Schedule Suggestion -->
            <div class="metric-card">
                <div class="metric-title">📅 Optimal Schedule</div>
                <div class="metric-value" id="scheduleSuggestion">--:--</div>
                <div class="metric-subtitle">Best streaming time</div>
                <div class="metric-trend">
                    <span id="scheduleReason">Calculating...</span>
                </div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="metric-card" style="margin: 20px 0;">
            <div class="metric-title">🤖 AI Recommendations</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                <div class="recommendation-card">
                    <div class="recommendation-title">👥 Viewer Growth</div>
                    <div id="viewerRec" class="recommendation-text">Calculating recommendations...</div>
                </div>
                <div class="recommendation-card">
                    <div class="recommendation-title">📈 Growth Strategy</div>
                    <div id="growthRec" class="recommendation-text">Calculating recommendations...</div>
                </div>
            </div>
        </div>

        <!-- AI Prompts History -->
        <div class="ai-prompts">
            <div class="metric-title">🤖 AI Prompts History</div>
            <div id="aiPromptsHistory">
                <div class="prompt-item">
                    <div class="prompt-type">System</div>
                    <div class="prompt-message">Waiting for AI prompts...</div>
                    <div class="prompt-timestamp">--:--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Strategic View Toggle Button -->
    <button class="strategic-toggle" id="strategicToggle" onclick="toggleStrategicView()" data-translate="strategicView">
        📊 Strategic View
    </button>


    <script>
        // Global variables
        let ws;
        let currentLanguage = 'en';
        let lastViewerCount = 0;
        let sessionStartTime = Date.now();
        let currentSessionId = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        let chatScore = 0;
        let lastChatScore = 0;
        
        // Zero to One Phase System
        let currentPhase = 'zero_viewers';
        let phaseTransitionTime = null;
        let firstViewerAlertShown = false;
        let dashboardContainer = null;

        // Zero to One Features - Global Variables
        let abtTimer = null;
        let abtInterval = null;
        let abtMuted = false;
        let uniqueViewers = new Set();
        let streamTime = 0;
        let lastPromptTime = 0;
        let promptCooldown = 30000; // 30 seconds minimum between prompts
        
        // AI Intelligence - External APIs
        let newsApiKey = 'db94af2f4bac408ab8084f22a7a2c9c6'; // Your NewsAPI key
        let factsApiUrl = 'https://uselessfacts.jsph.pl/random.json?language=en';
        let cachedNews = [];
        let cachedFacts = [];
        let lastNewsFetch = 0;
        let lastFactsFetch = 0;
        const CACHE_DURATION = 300000; // 5 minutes cache

        // PERSISTENCE ENGINE - Emotional Support & Validation
        let persistenceEngine = {
            // Milestone tracking
            milestones: {
                streamTime: {
                    30: false,    // 30 minutes
                    60: false,    // 1 hour
                    120: false,   // 2 hours
                    180: false    // 3 hours
                },
                viewers: {
                    1: false,     // First viewer
                    5: false,     // 5 viewers
                    10: false,    // 10 viewers
                    25: false     // 25 viewers
                },
                engagement: {
                    firstMessage: false,    // First chat message
                    firstFollow: false,     // First follow
                    firstSub: false,       // First subscription
                    firstRaid: false       // First raid
                }
            },
            
            // Session data for encouragement
            sessionData: {
                startTime: null,
                totalStreamTime: 0,
                peakViewers: 0,
                uniqueViewersToday: 0,
                totalMessages: 0,
                averageWatchTime: 0,
                engagementRate: 0,
                milestonesReached: 0
            },
            
            // Encouragement messages
            encouragementMessages: {
                timeBased: [
                    "You've been streaming for {time} straight—great job! Consistency is key!",
                    "Amazing! {time} of continuous streaming shows real dedication!",
                    "You're building a habit! {time} of streaming is impressive!",
                    "Keep going! {time} shows you're serious about this!"
                ],
                viewerBased: [
                    "You hit {count} total unique viewers today! That's real growth!",
                    "Fantastic! {count} unique viewers means people are finding you!",
                    "Great progress! {count} unique viewers shows your content resonates!",
                    "You're building a community! {count} unique viewers is awesome!"
                ],
                engagementBased: [
                    "Your average watch time was {time} minutes—that's excellent engagement!",
                    "Amazing! {time} minutes average watch time shows people love your content!",
                    "Outstanding! {time} minutes means viewers are really engaged!",
                    "Fantastic engagement! {time} minutes shows you're doing something right!"
                ],
                resilience: [
                    "Every streamer started with zero viewers. You're on the right path!",
                    "Focus on the process, not just the numbers. You're improving!",
                    "Consistency beats perfection. Keep showing up!",
                    "Your dedication will pay off. Every expert was once a beginner!",
                    "Small progress is still progress. You're building something great!"
                ]
            }
        };
        let messagesSent = 0;
        let milestonesReached = 0;
        let lastMessageTime = 0;

        // ABT Coach - Enhanced Prompt Templates for Zero Viewers
        const abtPrompts = {
            // Game Commentary & Strategy
            gameCommentary: [
                "Narrate your thoughts out loud. Explain why you're making this move.",
                "What's your strategy for this level/battle? Walk us through your thinking.",
                "This part is tricky - let me explain what I'm trying to do here.",
                "I love how the developers designed this section. Notice the details...",
                "If I were a new player, here's what I'd want to know about this game.",
                "This reminds me of [other game] - let me explain the similarities.",
                "I'm going to try a different approach this time. Watch this strategy...",
                "The music in this area is perfect for the atmosphere. Listen to that...",
                "I wonder what the developers were thinking when they created this mechanic.",
                "This is one of my favorite parts of the game because..."
            ],
            
            // Personal Stories & Experiences
            personalStories: [
                "What's the best movie you've seen recently? Tell the story.",
                "Share a funny story from your childhood that relates to gaming.",
                "What's the most embarrassing thing that happened to you while streaming?",
                "Tell us about your first gaming console and favorite childhood game.",
                "What's the weirdest dream you've had about this game?",
                "Share a story about meeting another streamer or gamer in real life.",
                "What's your most epic gaming fail that you can laugh about now?",
                "Tell us about a time when gaming helped you through a tough situation.",
                "What's the funniest thing your pet has done while you were streaming?",
                "Share a story about your first time playing this game - what surprised you?"
            ],
            
            // Conversation Starters
            conversationStarters: [
                "If you could have dinner with any game developer, who would it be and why?",
                "What's your guilty pleasure game that you don't usually admit to playing?",
                "If you could create your own game, what would it be about?",
                "What's the most overrated game that everyone loves but you don't?",
                "If you could live in any video game world, which one would you choose?",
                "What's your favorite gaming memory from the past year?",
                "If you could have any superpower from a video game, what would it be?",
                "What's the most underrated game that more people should know about?",
                "If you could ask the developers of this game one question, what would it be?",
                "What's your dream collaboration between two different game franchises?"
            ],
            
            // Streaming & Community
            streamingTips: [
                "New streamers often ask me about [topic] - here's my advice...",
                "The biggest mistake I made when I started streaming was...",
                "If I could go back and tell my past self one streaming tip, it would be...",
                "The most important thing I've learned about building a community is...",
                "Here's what I wish I knew about streaming equipment when I started...",
                "The best piece of advice another streamer ever gave me was...",
                "If you're thinking about starting to stream, here's what you should know...",
                "The most challenging part of streaming for me was learning to...",
                "Here's how I stay motivated when the chat is quiet...",
                "The thing that surprised me most about streaming was..."
            ],
            
            // Interactive & Engaging
            interactive: [
                "I'm curious - what's everyone's favorite part of this game so far?",
                "If you could change one thing about this game, what would it be?",
                "What's the most creative thing you've seen someone do in this game?",
                "I'm going to try something new - what do you think will happen?",
                "This is a great spot to take a screenshot. The lighting is perfect!",
                "I wonder what secrets are hidden in this area. Let me explore...",
                "If I were speedrunning this, here's the route I'd take...",
                "This achievement is tricky - let me show you the strategy...",
                "I'm going to play this section differently than usual. Watch this...",
                "What's the most satisfying sound effect in this game? I love this one..."
            ]
        };

        // Milestones Configuration
        const milestones = [
            { id: 'first_30min', nameKey: 'first30Minutes', icon: '⏰', threshold: 30, type: 'time', descriptionKey: 'streamFor30Minutes' },
            { id: 'first_hour', nameKey: 'firstHour', icon: '🕐', threshold: 60, type: 'time', descriptionKey: 'completeFirstHour' },
            { id: 'first_viewer', nameKey: 'firstViewer', icon: '👤', threshold: 1, type: 'viewers', descriptionKey: 'getFirstViewer' },
            { id: 'first_5_viewers', nameKey: 'first5Viewers', icon: '👥', threshold: 5, type: 'viewers', descriptionKey: 'reach5Viewers' },
            { id: 'first_message', nameKey: 'firstMessage', icon: '💬', threshold: 1, type: 'messages', descriptionKey: 'receiveFirstMessage' },
            { id: 'stream_streak_3', nameKey: 'streamStreak3', icon: '🔥', threshold: 3, type: 'streak', descriptionKey: 'stream3ConsecutiveDays' },
            { id: 'stream_streak_7', nameKey: 'streamStreak7', icon: '🌟', threshold: 7, type: 'streak', descriptionKey: 'stream7ConsecutiveDays' },
            { id: 'first_100_messages', nameKey: 'first100Messages', icon: '💯', threshold: 100, type: 'messages', descriptionKey: 'send100Messages' }
        ];

        // Language translations
        const translations = {
            en: {
                // Main Dashboard Elements
                liveViewers: 'Live Viewers',
                aiCoPilot: 'Your AI Co-Pilot',
                chatScore: 'Chat Score',
                zeroViewers: 'Zero Viewers',
                firstViewer: 'First Viewer!',
                buildingAudience: 'Building Audience',
                
                // ABT Coach
                nextPromptIn: 'Next prompt in',
                mute: 'Mute',
                unmute: 'Unmute',
                
                // Gauge Levels
                quiet: 'Quiet',
                low: 'Low',
                moderate: 'Moderate',
                high: 'High',
                fire: 'Fire',
                
                // First Viewer Alert
                firstViewerTitle: 'FIRST VIEWER!',
                firstViewerMessage: 'Someone just joined your stream!',
                welcomeToStream: 'Welcome to the stream!',
                close: 'Close',
                autoClosingIn: 'Auto-closing in',
                
                // AI Prompt Messages
                keepTalking: 'Keep talking! Your audience will find you.',
                firstViewerDetected: '🎉 FIRST VIEWER DETECTED! Welcome them warmly and make them feel special. This is the start of your community!',
                greatViewers: 'Great! You have viewers. Keep the energy up with engaging content, ask questions, and build your community!',
                aiCoPilotReady: 'AI Co-Pilot is ready to help!',
                
                // ABT Coach Prompts
                abtGameCommentary: [
                    'Narrate your thoughts out loud. Explain why you\'re making this move.',
                    'What\'s your strategy for this level/battle? Walk us through your thinking.',
                    'This part is tricky - let me explain what I\'m trying to do here.',
                    'I love how the developers designed this section. Notice the details...',
                    'If I were a new player, here\'s what I\'d want to know about this game.',
                    'This reminds me of [other game] - let me explain the similarities.',
                    'I\'m going to try a different approach this time. Watch this strategy...',
                    'The music in this area is perfect for the atmosphere. Listen to that...',
                    'I wonder what the developers were thinking when they created this mechanic.',
                    'This is one of my favorite parts of the game because...'
                ],
                abtPersonalStories: [
                    'What\'s the best movie you\'ve seen recently? Tell the story.',
                    'Share a funny story from your childhood that relates to gaming.',
                    'What\'s the most embarrassing thing that happened to you while streaming?',
                    'Tell us about your first gaming console and favorite childhood game.',
                    'What\'s the weirdest dream you\'ve had about this game?',
                    'Share a story about meeting another streamer or gamer in real life.',
                    'What\'s your most epic gaming fail that you can laugh about now?',
                    'Tell us about a time when gaming helped you through a tough situation.',
                    'What\'s the funniest thing your pet has done while you were streaming?',
                    'Share a story about your first time playing this game - what surprised you?'
                ],
                abtConversationStarters: [
                    'If you could have dinner with any game developer, who would it be and why?',
                    'What\'s your guilty pleasure game that you don\'t usually admit to playing?',
                    'If you could create your own game, what would it be about?',
                    'What\'s the most overrated game that everyone loves but you don\'t?',
                    'If you could live in any video game world, which one would you choose?',
                    'What\'s your favorite gaming memory from the past year?',
                    'If you could have any superpower from a video game, what would it be?',
                    'What\'s the most underrated game that more people should know about?',
                    'If you could ask the developers of this game one question, what would it be?',
                    'What\'s your dream collaboration between two different game franchises?'
                ],
                abtStreamingTips: [
                    'New streamers often ask me about [topic] - here\'s my advice...',
                    'The biggest mistake I made when I started streaming was...',
                    'If I could go back and tell my past self one streaming tip, it would be...',
                    'The most important thing I\'ve learned about building a community is...',
                    'Here\'s what I wish I knew about streaming equipment when I started...',
                    'The best piece of advice another streamer ever gave me was...',
                    'If you\'re thinking about starting to stream, here\'s what you should know...',
                    'The most challenging part of streaming for me was learning to...',
                    'Here\'s how I stay motivated when the chat is quiet...',
                    'The thing that surprised me most about streaming was...'
                ],
                abtInteractive: [
                    'I\'m curious - what\'s everyone\'s favorite part of this game so far?',
                    'If you could change one thing about this game, what would it be?',
                    'What\'s the most creative thing you\'ve seen someone do in this game?',
                    'I\'m going to try something new - what do you think will happen?',
                    'This is a great spot to take a screenshot. The lighting is perfect!',
                    'I wonder what secrets are hidden in this area. Let me explore...',
                    'If I were speedrunning this, here\'s the route I\'d take...',
                    'This achievement is tricky - let me show you the strategy...',
                    'I\'m going to play this section differently than usual. Watch this...',
                    'What\'s the most satisfying sound effect in this game? I love this one...'
                ],
                
                // Milestones
                first30min: 'First 30 Minutes',
                firstHour: 'First Hour',
                firstViewerMilestone: 'First Viewer',
                first5Viewers: 'First 5 Viewers',
                firstMessage: 'First Chat Message',
                
                // Status
                starting: 'Starting',
                offline: 'Offline',
                online: 'Online',
                notStreaming: 'Not streaming',
                streaming: 'Streaming',
                stable: 'Stable',
                growing: 'Growing',
                declining: 'Declining',
                positive: 'Positive',
                negative: 'Negative',
                neutral: 'Neutral',
                
                // Strategy Analytics
                strategicAnalytics: 'Strategic Analytics Dashboard',
                strategicView: 'Strategic View',
                healthScore: 'Health Score',
                engagementRate: 'Engagement Rate',
                retentionRate: 'Retention Rate',
                growthRate: 'Growth Rate',
                viewerGrowth: 'Viewer Growth',
                contentQuality: 'Content Quality',
                communityHealth: 'Community Health',
                streamConsistency: 'Stream Consistency',
                calculatingRecommendations: 'Calculating recommendations...',
                
                // Milestones & Gamification
                yourJourneyMilestones: 'Your Journey Milestones',
                sessionSummary: 'Session Summary',
                milestones: 'Milestones',
                first30Minutes: 'First 30 Minutes',
                firstHour: 'First Hour',
                firstViewer: 'First Viewer',
                first5Viewers: 'First 5 Viewers',
                first10Viewers: 'First 10 Viewers',
                first25Viewers: 'First 25 Viewers',
                firstMessage: 'First Chat Message',
                first10Messages: 'First 10 Messages',
                first50Messages: 'First 50 Messages',
                first100Messages: 'First 100 Messages',
                streamStreak3: '3-Day Streak',
                streamStreak7: '1-Week Streak',
                streamFor30Minutes: 'Stream for 30 minutes straight',
                completeFirstHour: 'Complete your first hour of streaming',
                getFirstViewer: 'Get your first viewer',
                reach5Viewers: 'Reach 5 concurrent viewers',
                reach10Viewers: 'Reach 10 concurrent viewers',
                reach25Viewers: 'Reach 25 concurrent viewers',
                receiveFirstMessage: 'Receive your first chat message',
                receive10Messages: 'Receive 10 chat messages',
                receive50Messages: 'Receive 50 chat messages',
                send100Messages: 'Send 100 messages total',
                stream3ConsecutiveDays: 'Stream for 3 consecutive days',
                stream7ConsecutiveDays: 'Stream for 7 consecutive days',
                completed: 'COMPLETED',
                
                // AI Intelligence
                aiAnalyzing: 'AI is analyzing news and facts to generate your next prompt...',
                newsCategory: 'News',
                factsCategory: 'Facts',
                fallbackCategory: 'Fallback',
                apiConfig: 'API Configuration',
                newsApiKey: 'News API Key',
                factsApiUrl: 'Facts API URL',
                saveConfig: 'Save Configuration',
                toggleConfig: 'Toggle Config',
                
                // AI Prompt Templates
                gamingNewsPrompt: 'This could be perfect for your next stream! What do you think about this development?',
                techNewsPrompt: 'TECH BREAKTHROUGH',
                techNewsDescription: 'This might affect how we stream! Have you tried anything like this?',
                entertainmentNewsPrompt: 'ENTERTAINMENT UPDATE',
                entertainmentNewsDescription: 'Could this be content inspiration? What\'s your take on this?',
                hotTopicPrompt: 'HOT TOPIC',
                hotTopicDescription: 'This is trending and perfect for discussion! What do you think?',
                interestingNewsPrompt: 'INTERESTING NEWS',
                interestingNewsDescription: 'This caught my attention - what do you think about this?',
                
                // Fact Prompt Templates
                mindBlowingFact: 'MIND-BLOWING FACT',
                mindBlowingDescription: 'Ask your viewers: "Did you know this about the human brain?!"',
                wildFact: 'WILD FACT',
                wildFactDescription: 'Perfect conversation starter! Ask: "Who knew this about animals?!"',
                cosmicFact: 'COSMIC FACT',
                cosmicFactDescription: 'This is out of this world! Ask your viewers: "Did you know this about space?!"',
                historicalFact: 'HISTORICAL FACT',
                historicalFactDescription: 'Blast from the past! Ask: "Can you believe this happened in history?!"',
                foodFact: 'FOOD FACT',
                foodFactDescription: 'This will surprise you! Ask: "Did you know this about food?!"',
                amazingFact: 'AMAZING FACT',
                amazingFactDescription: 'This is incredible! Ask your viewers: "Did you know this?!"',
                
                // Fact Content Translations
                ruleOfThumb: 'rule of thumb',
                beaten: 'beaten',
                wife: 'wife',
                widerThanThumb: 'wider than your thumb',
                oldEnglishLaw: 'old English law',
                uniqueViewers: 'Unique Viewers',
                messagesSent: 'Messages Sent',
                liveViewerCount: 'Live viewer count',
                highestViewerCount: 'Highest viewer count',
                today: 'Today',
                
                // Legacy translations
                streamStatus: 'Stream Status',
                currentViewers: 'Current Viewers',
                peakViewers: 'Peak Viewers',
                totalSubs: 'Total Subs',
                totalFollowers: 'Total Followers',
                newFollowers: 'New Followers',
                streamRevenue: 'Stream Revenue',
                newSubs: 'New Subs',
                bitsEarned: 'Bits Earned',
                raidsReceived: 'Raids Received',
                streamInfo: 'Chat score',
                chatSentiment: 'Chat Sentiment',
                recentChat: 'Recent Chat Activity',
                topUsers: 'Top Engaged Users',
                aiPrompts: 'AI-Generated Prompts',
                liveChatScore: 'Live Chat Score',
                chatActivity: 'Chat Activity'
            },
            fr: {
                // Main Dashboard Elements
                liveViewers: 'Spectateurs en Direct',
                aiCoPilot: 'Votre Co-Pilote IA',
                chatScore: 'Score du Chat',
                zeroViewers: 'Zéro Spectateurs',
                firstViewer: 'Premier Spectateur!',
                buildingAudience: 'Construire l\'Audience',
                
                // ABT Coach
                nextPromptIn: 'Prochain prompt dans',
                mute: 'Muet',
                unmute: 'Activer le son',
                
                // Gauge Levels
                quiet: 'Calme',
                low: 'Faible',
                moderate: 'Modéré',
                high: 'Élevé',
                fire: 'Feu',
                
                // First Viewer Alert
                firstViewerTitle: 'PREMIER SPECTATEUR!',
                firstViewerMessage: 'Quelqu\'un vient de rejoindre votre stream!',
                welcomeToStream: 'Bienvenue sur le stream!',
                close: 'Fermer',
                autoClosingIn: 'Fermeture automatique dans',
                
                // AI Prompt Messages
                keepTalking: 'Continuez à parler! Votre audience vous trouvera.',
                firstViewerDetected: '🎉 PREMIER SPECTATEUR DÉTECTÉ! Accueillez-les chaleureusement et faites-leur sentir qu\'ils sont spéciaux. C\'est le début de votre communauté!',
                greatViewers: 'Parfait! Vous avez des spectateurs. Gardez l\'énergie avec du contenu engageant, posez des questions et construisez votre communauté!',
                aiCoPilotReady: 'Le Co-Pilote IA est prêt à aider!',
                
                // ABT Coach Prompts
                abtGameCommentary: [
                    'Narrer vos pensées à voix haute. Expliquez pourquoi vous faites ce mouvement.',
                    'Quelle est votre stratégie pour ce niveau/combat? Marchez-nous à travers votre réflexion.',
                    'Cette partie est délicate - laissez-moi expliquer ce que j\'essaie de faire ici.',
                    'J\'adore comment les développeurs ont conçu cette section. Remarquez les détails...',
                    'Si j\'étais un nouveau joueur, voici ce que je voudrais savoir sur ce jeu.',
                    'Cela me rappelle [autre jeu] - laissez-moi expliquer les similitudes.',
                    'Je vais essayer une approche différente cette fois. Regardez cette stratégie...',
                    'La musique dans cette zone est parfaite pour l\'atmosphère. Écoutez ça...',
                    'Je me demande à quoi pensaient les développeurs quand ils ont créé cette mécanique.',
                    'C\'est une de mes parties préférées du jeu parce que...'
                ],
                abtPersonalStories: [
                    'Quel est le meilleur film que vous ayez vu récemment? Racontez l\'histoire.',
                    'Partagez une histoire drôle de votre enfance qui se rapporte au gaming.',
                    'Quelle est la chose la plus embarrassante qui vous soit arrivée en streaming?',
                    'Parlez-nous de votre première console de jeu et de votre jeu d\'enfance préféré.',
                    'Quel est le rêve le plus bizarre que vous ayez eu sur ce jeu?',
                    'Partagez une histoire sur la rencontre d\'un autre streamer ou gamer dans la vraie vie.',
                    'Quel est votre échec de jeu le plus épique dont vous puissiez rire maintenant?',
                    'Parlez-nous d\'une fois où le gaming vous a aidé à traverser une situation difficile.',
                    'Quelle est la chose la plus drôle que votre animal de compagnie ait faite pendant que vous streamiez?',
                    'Partagez une histoire sur votre première fois à jouer à ce jeu - qu\'est-ce qui vous a surpris?'
                ],
                abtConversationStarters: [
                    'Si vous pouviez dîner avec n\'importe quel développeur de jeu, qui serait-ce et pourquoi?',
                    'Quel est votre jeu de plaisir coupable que vous n\'admettez généralement pas jouer?',
                    'Si vous pouviez créer votre propre jeu, de quoi s\'agirait-il?',
                    'Quel est le jeu le plus surévalué que tout le monde aime mais pas vous?',
                    'Si vous pouviez vivre dans n\'importe quel monde de jeu vidéo, lequel choisiriez-vous?',
                    'Quel est votre souvenir de gaming préféré de l\'année dernière?',
                    'Si vous pouviez avoir n\'importe quel superpouvoir d\'un jeu vidéo, quel serait-il?',
                    'Quel est le jeu le plus sous-évalué que plus de gens devraient connaître?',
                    'Si vous pouviez poser une question aux développeurs de ce jeu, quelle serait-elle?',
                    'Quelle est votre collaboration de rêve entre deux franchises de jeux différentes?'
                ],
                abtStreamingTips: [
                    'Les nouveaux streamers me demandent souvent à propos de [sujet] - voici mon conseil...',
                    'La plus grosse erreur que j\'ai faite quand j\'ai commencé à streamer était...',
                    'Si je pouvais revenir en arrière et dire un conseil de streaming à mon moi du passé, ce serait...',
                    'La chose la plus importante que j\'ai apprise sur la construction d\'une communauté est...',
                    'Voici ce que j\'aurais aimé savoir sur l\'équipement de streaming quand j\'ai commencé...',
                    'Le meilleur conseil qu\'un autre streamer m\'ait jamais donné était...',
                    'Si vous pensez commencer à streamer, voici ce que vous devriez savoir...',
                    'La partie la plus difficile du streaming pour moi était d\'apprendre à...',
                    'Voici comment je reste motivé quand le chat est silencieux...',
                    'La chose qui m\'a le plus surpris du streaming était...'
                ],
                abtInteractive: [
                    'Je suis curieux - quelle est la partie préférée de tout le monde de ce jeu jusqu\'à présent?',
                    'Si vous pouviez changer une chose à ce jeu, ce serait quoi?',
                    'Quelle est la chose la plus créative que vous ayez vue quelqu\'un faire dans ce jeu?',
                    'Je vais essayer quelque chose de nouveau - que pensez-vous qu\'il va se passer?',
                    'C\'est un excellent endroit pour prendre une capture d\'écran. L\'éclairage est parfait!',
                    'Je me demande quels secrets sont cachés dans cette zone. Laissez-moi explorer...',
                    'Si je faisais du speedrun, voici l\'itinéraire que je prendrais...',
                    'Ce succès est délicat - laissez-moi vous montrer la stratégie...',
                    'Je vais jouer cette section différemment que d\'habitude. Regardez ça...',
                    'Quel est l\'effet sonore le plus satisfaisant de ce jeu? J\'adore celui-ci...'
                ],
                
                // Milestones
                first30min: 'Premières 30 Minutes',
                firstHour: 'Première Heure',
                firstViewerMilestone: 'Premier Spectateur',
                first5Viewers: 'Premiers 5 Spectateurs',
                firstMessage: 'Premier Message Chat',
                
                // Status
                starting: 'Démarrage',
                offline: 'Hors ligne',
                online: 'En ligne',
                notStreaming: 'Pas de stream',
                streaming: 'En stream',
                stable: 'Stable',
                growing: 'Croissant',
                declining: 'Déclinant',
                positive: 'Positif',
                negative: 'Négatif',
                neutral: 'Neutre',
                
                // Strategy Analytics
                strategicAnalytics: 'Tableau de Bord d\'Analyses Stratégiques',
                strategicView: 'Vue Stratégique',
                healthScore: 'Score de Santé',
                engagementRate: 'Taux d\'Engagement',
                retentionRate: 'Taux de Rétention',
                growthRate: 'Taux de Croissance',
                viewerGrowth: 'Croissance des Spectateurs',
                contentQuality: 'Qualité du Contenu',
                communityHealth: 'Santé de la Communauté',
                streamConsistency: 'Cohérence du Stream',
                calculatingRecommendations: 'Calcul des recommandations...',
                
                // Milestones & Gamification
                yourJourneyMilestones: 'Vos Jalons de Parcours',
                sessionSummary: 'Résumé de Session',
                milestones: 'Jalons',
                first30Minutes: 'Premières 30 Minutes',
                firstHour: 'Première Heure',
                firstViewer: 'Premier Spectateur',
                first5Viewers: 'Premiers 5 Spectateurs',
                first10Viewers: 'Premiers 10 Spectateurs',
                first25Viewers: 'Premiers 25 Spectateurs',
                firstMessage: 'Premier Message Chat',
                first10Messages: 'Premiers 10 Messages',
                first50Messages: 'Premiers 50 Messages',
                first100Messages: 'Premiers 100 Messages',
                streamStreak3: 'Série de 3 Jours',
                streamStreak7: 'Série de 1 Semaine',
                streamFor30Minutes: 'Streamer pendant 30 minutes d\'affilée',
                completeFirstHour: 'Terminer votre première heure de streaming',
                getFirstViewer: 'Obtenir votre premier spectateur',
                reach5Viewers: 'Atteindre 5 spectateurs simultanés',
                reach10Viewers: 'Atteindre 10 spectateurs simultanés',
                reach25Viewers: 'Atteindre 25 spectateurs simultanés',
                receiveFirstMessage: 'Recevoir votre premier message chat',
                receive10Messages: 'Recevoir 10 messages chat',
                receive50Messages: 'Recevoir 50 messages chat',
                send100Messages: 'Envoyer 100 messages au total',
                stream3ConsecutiveDays: 'Streamer pendant 3 jours consécutifs',
                stream7ConsecutiveDays: 'Streamer pendant 7 jours consécutifs',
                completed: 'TERMINÉ',
                
                // AI Intelligence
                aiAnalyzing: 'L\'IA analyse les actualités et faits pour générer votre prochain prompt...',
                newsCategory: 'Actualités',
                factsCategory: 'Faits',
                fallbackCategory: 'Sauvegarde',
                apiConfig: 'Configuration API',
                newsApiKey: 'Clé API Actualités',
                factsApiUrl: 'URL API Faits',
                saveConfig: 'Sauvegarder Configuration',
                toggleConfig: 'Basculer Config',
                
                // AI Prompt Templates
                gamingNewsPrompt: 'Cela pourrait être parfait pour votre prochain stream ! Que pensez-vous de ce développement ?',
                techNewsPrompt: 'PERCÉE TECHNIQUE',
                techNewsDescription: 'Cela pourrait affecter la façon dont nous streamons ! Avez-vous essayé quelque chose comme ça ?',
                entertainmentNewsPrompt: 'MISE À JOUR DIVERTISSEMENT',
                entertainmentNewsDescription: 'Cela pourrait être une inspiration de contenu ? Quel est votre avis là-dessus ?',
                hotTopicPrompt: 'SUJET TENDANCE',
                hotTopicDescription: 'C\'est tendance et parfait pour la discussion ! Qu\'en pensez-vous ?',
                interestingNewsPrompt: 'ACTUALITÉS INTÉRESSANTES',
                interestingNewsDescription: 'Cela a attiré mon attention - qu\'en pensez-vous ?',
                
                // Fact Prompt Templates
                mindBlowingFact: 'FAIT ÉPOUSTOUFLANT',
                mindBlowingDescription: 'Demandez à vos spectateurs : "Saviez-vous cela sur le cerveau humain ?!"',
                wildFact: 'FAIT SAUVAGE',
                wildFactDescription: 'Parfait pour démarrer une conversation ! Demandez : "Qui savait cela sur les animaux ?!"',
                cosmicFact: 'FAIT COSMIQUE',
                cosmicFactDescription: 'C\'est hors de ce monde ! Demandez à vos spectateurs : "Saviez-vous cela sur l\'espace ?!"',
                historicalFact: 'FAIT HISTORIQUE',
                historicalFactDescription: 'Retour dans le passé ! Demandez : "Pouvez-vous croire que cela s\'est passé dans l\'histoire ?!"',
                foodFact: 'FAIT ALIMENTAIRE',
                foodFactDescription: 'Cela va vous surprendre ! Demandez : "Saviez-vous cela sur la nourriture ?!"',
                amazingFact: 'FAIT INCROYABLE',
                amazingFactDescription: 'C\'est incroyable ! Demandez à vos spectateurs : "Saviez-vous cela ?!"',
                
                // Fact Content Translations
                ruleOfThumb: 'règle du pouce',
                beaten: 'battu',
                wife: 'épouse',
                widerThanThumb: 'plus large que votre pouce',
                oldEnglishLaw: 'ancienne loi anglaise',
                uniqueViewers: 'Spectateurs Uniques',
                messagesSent: 'Messages Envoyés',
                liveViewerCount: 'Nombre de spectateurs en direct',
                highestViewerCount: 'Nombre le plus élevé de spectateurs',
                today: 'Aujourd\'hui',
                
                // Legacy translations
                streamStatus: 'Statut du Stream',
                currentViewers: 'Spectateurs Actuels',
                peakViewers: 'Pic de Spectateurs',
                totalSubs: 'Total Abonnements',
                totalFollowers: 'Total Followers',
                newFollowers: 'Nouveaux Followers',
                streamRevenue: 'Revenus du Stream',
                newSubs: 'Nouveaux Subs',
                bitsEarned: 'Bits Gagnés',
                raidsReceived: 'Raids Reçus',
                streamInfo: 'Informations du Stream',
                chatSentiment: 'Sentiment du Chat',
                recentChat: 'Activité Récente du Chat',
                topUsers: 'Utilisateurs les Plus Engagés',
                aiPrompts: 'Prompts Générés par IA',
                liveChatScore: 'Score de Chat en Direct',
                chatActivity: 'Activité du Chat'
            },
            es: {
                // Main Dashboard Elements
                liveViewers: 'Espectadores en Vivo',
                aiCoPilot: 'Tu Co-Piloto IA',
                chatScore: 'Puntuación del Chat',
                zeroViewers: 'Cero Espectadores',
                firstViewer: '¡Primer Espectador!',
                buildingAudience: 'Construyendo Audiencia',
                
                // ABT Coach
                nextPromptIn: 'Siguiente prompt en',
                mute: 'Silenciar',
                unmute: 'Activar sonido',
                
                // Gauge Levels
                quiet: 'Tranquilo',
                low: 'Bajo',
                moderate: 'Moderado',
                high: 'Alto',
                fire: 'Fuego',
                
                // First Viewer Alert
                firstViewerTitle: '¡PRIMER ESPECTADOR!',
                firstViewerMessage: '¡Alguien acaba de unirse a tu stream!',
                welcomeToStream: '¡Bienvenido al stream!',
                close: 'Cerrar',
                autoClosingIn: 'Cierre automático en',
                
                // AI Prompt Messages
                keepTalking: '¡Sigue hablando! Tu audiencia te encontrará.',
                firstViewerDetected: '🎉 ¡PRIMER ESPECTADOR DETECTADO! Dales la bienvenida cálidamente y hazlos sentir especiales. ¡Este es el comienzo de tu comunidad!',
                greatViewers: '¡Genial! Tienes espectadores. Mantén la energía con contenido atractivo, haz preguntas y construye tu comunidad!',
                aiCoPilotReady: '¡El Co-Piloto IA está listo para ayudar!',
                
                // ABT Coach Prompts
                abtGameCommentary: [
                    'Narra tus pensamientos en voz alta. Explica por qué estás haciendo este movimiento.',
                    '¿Cuál es tu estrategia para este nivel/batalla? Guíanos a través de tu pensamiento.',
                    'Esta parte es complicada - déjame explicar lo que estoy tratando de hacer aquí.',
                    'Me encanta cómo los desarrolladores diseñaron esta sección. Nota los detalles...',
                    'Si fuera un jugador nuevo, esto es lo que querría saber sobre este juego.',
                    'Esto me recuerda a [otro juego] - déjame explicar las similitudes.',
                    'Voy a probar un enfoque diferente esta vez. Mira esta estrategia...',
                    'La música en esta área es perfecta para la atmósfera. Escucha eso...',
                    'Me pregunto en qué pensaban los desarrolladores cuando crearon esta mecánica.',
                    'Esta es una de mis partes favoritas del juego porque...'
                ],
                abtPersonalStories: [
                    '¿Cuál es la mejor película que has visto recientemente? Cuenta la historia.',
                    'Comparte una historia divertida de tu infancia que se relacione con los videojuegos.',
                    '¿Cuál es la cosa más embarazosa que te ha pasado mientras transmitías?',
                    'Cuéntanos sobre tu primera consola de videojuegos y tu juego favorito de la infancia.',
                    '¿Cuál es el sueño más extraño que has tenido sobre este juego?',
                    'Comparte una historia sobre conocer a otro streamer o gamer en la vida real.',
                    '¿Cuál es tu fallo de gaming más épico del que puedes reírte ahora?',
                    'Cuéntanos sobre una vez que los videojuegos te ayudaron a superar una situación difícil.',
                    '¿Cuál es la cosa más divertida que tu mascota ha hecho mientras transmitías?',
                    'Comparte una historia sobre tu primera vez jugando este juego - ¿qué te sorprendió?'
                ],
                abtConversationStarters: [
                    'Si pudieras cenar con cualquier desarrollador de juegos, ¿quién sería y por qué?',
                    '¿Cuál es tu juego de placer culpable que no sueles admitir jugar?',
                    'Si pudieras crear tu propio juego, ¿de qué trataría?',
                    '¿Cuál es el juego más sobrevalorado que todos aman pero tú no?',
                    'Si pudieras vivir en cualquier mundo de videojuego, ¿cuál elegirías?',
                    '¿Cuál es tu memoria de gaming favorita del año pasado?',
                    'Si pudieras tener cualquier superpoder de un videojuego, ¿cuál sería?',
                    '¿Cuál es el juego más infravalorado que más gente debería conocer?',
                    'Si pudieras hacer una pregunta a los desarrolladores de este juego, ¿cuál sería?',
                    '¿Cuál es tu colaboración de ensueño entre dos franquicias de juegos diferentes?'
                ],
                abtStreamingTips: [
                    'Los nuevos streamers me preguntan a menudo sobre [tema] - aquí está mi consejo...',
                    'El mayor error que cometí cuando empecé a transmitir fue...',
                    'Si pudiera volver atrás y decirme un consejo de streaming a mi yo del pasado, sería...',
                    'Lo más importante que he aprendido sobre construir una comunidad es...',
                    'Aquí está lo que desearía haber sabido sobre el equipo de streaming cuando empecé...',
                    'El mejor consejo que otro streamer me dio fue...',
                    'Si estás pensando en empezar a transmitir, aquí está lo que deberías saber...',
                    'La parte más desafiante del streaming para mí fue aprender a...',
                    'Aquí está cómo me mantengo motivado cuando el chat está silencioso...',
                    'Lo que más me sorprendió del streaming fue...'
                ],
                abtInteractive: [
                    'Tengo curiosidad - ¿cuál es la parte favorita de todos de este juego hasta ahora?',
                    'Si pudieras cambiar una cosa de este juego, ¿qué sería?',
                    '¿Cuál es la cosa más creativa que has visto hacer a alguien en este juego?',
                    'Voy a probar algo nuevo - ¿qué crees que va a pasar?',
                    'Este es un gran lugar para tomar una captura de pantalla. ¡La iluminación es perfecta!',
                    'Me pregunto qué secretos están ocultos en esta área. Déjame explorar...',
                    'Si estuviera haciendo speedrun, esta es la ruta que tomaría...',
                    'Este logro es complicado - déjame mostrarte la estrategia...',
                    'Voy a jugar esta sección de manera diferente a lo habitual. Mira esto...',
                    '¿Cuál es el efecto de sonido más satisfactorio de este juego? Me encanta este...'
                ],
                
                // Milestones
                first30min: 'Primeros 30 Minutos',
                firstHour: 'Primera Hora',
                firstViewerMilestone: 'Primer Espectador',
                first5Viewers: 'Primeros 5 Espectadores',
                firstMessage: 'Primer Mensaje de Chat',
                
                // Status
                starting: 'Iniciando',
                offline: 'Desconectado',
                online: 'En línea',
                notStreaming: 'No transmitiendo',
                streaming: 'Transmitiendo',
                stable: 'Estable',
                growing: 'Creciente',
                declining: 'Declinando',
                positive: 'Positivo',
                negative: 'Negativo',
                neutral: 'Neutral',
                
                // Strategy Analytics
                strategicAnalytics: 'Panel de Análisis Estratégico',
                strategicView: 'Vista Estratégica',
                healthScore: 'Puntuación de Salud',
                engagementRate: 'Tasa de Compromiso',
                retentionRate: 'Tasa de Retención',
                growthRate: 'Tasa de Crecimiento',
                viewerGrowth: 'Crecimiento de Espectadores',
                contentQuality: 'Calidad del Contenido',
                communityHealth: 'Salud de la Comunidad',
                streamConsistency: 'Consistencia del Stream',
                calculatingRecommendations: 'Calculando recomendaciones...',
                
                // Milestones & Gamification
                yourJourneyMilestones: 'Tus Hitos del Viaje',
                sessionSummary: 'Resumen de Sesión',
                milestones: 'Hitos',
                first30Minutes: 'Primeros 30 Minutos',
                firstHour: 'Primera Hora',
                firstViewer: 'Primer Espectador',
                first5Viewers: 'Primeros 5 Espectadores',
                first10Viewers: 'Primeros 10 Espectadores',
                first25Viewers: 'Primeros 25 Espectadores',
                firstMessage: 'Primer Mensaje de Chat',
                first10Messages: 'Primeros 10 Mensajes',
                first50Messages: 'Primeros 50 Mensajes',
                first100Messages: 'Primeros 100 Mensajes',
                streamStreak3: 'Racha de 3 Días',
                streamStreak7: 'Racha de 1 Semana',
                streamFor30Minutes: 'Transmitir durante 30 minutos seguidos',
                completeFirstHour: 'Completar tu primera hora de transmisión',
                getFirstViewer: 'Obtener tu primer espectador',
                reach5Viewers: 'Alcanzar 5 espectadores simultáneos',
                reach10Viewers: 'Alcanzar 10 espectadores simultáneos',
                reach25Viewers: 'Alcanzar 25 espectadores simultáneos',
                receiveFirstMessage: 'Recibir tu primer mensaje de chat',
                receive10Messages: 'Recibir 10 mensajes de chat',
                receive50Messages: 'Recibir 50 mensajes de chat',
                send100Messages: 'Enviar 100 mensajes en total',
                stream3ConsecutiveDays: 'Transmitir durante 3 días consecutivos',
                stream7ConsecutiveDays: 'Transmitir durante 7 días consecutivos',
                completed: 'COMPLETADO',
                
                // AI Intelligence
                aiAnalyzing: 'La IA está analizando noticias y hechos para generar tu próximo prompt...',
                newsCategory: 'Noticias',
                factsCategory: 'Hechos',
                fallbackCategory: 'Respaldo',
                apiConfig: 'Configuración API',
                newsApiKey: 'Clave API Noticias',
                factsApiUrl: 'URL API Hechos',
                saveConfig: 'Guardar Configuración',
                toggleConfig: 'Alternar Config',
                
                // AI Prompt Templates
                gamingNewsPrompt: '¡Esto podría ser perfecto para tu próxima transmisión! ¿Qué opinas de este desarrollo?',
                techNewsPrompt: 'AVANCE TECNOLÓGICO',
                techNewsDescription: '¡Esto podría afectar cómo transmitimos! ¿Has probado algo así?',
                entertainmentNewsPrompt: 'ACTUALIZACIÓN DE ENTRETENIMIENTO',
                entertainmentNewsDescription: '¿Podría ser inspiración de contenido? ¿Cuál es tu opinión?',
                hotTopicPrompt: 'TEMA TENDENCIA',
                hotTopicDescription: '¡Esto es tendencia y perfecto para discusión! ¿Qué opinas?',
                interestingNewsPrompt: 'NOTICIAS INTERESANTES',
                interestingNewsDescription: 'Esto llamó mi atención - ¿qué opinas de esto?',
                
                // Fact Prompt Templates
                mindBlowingFact: 'HECHO ALUCINANTE',
                mindBlowingDescription: 'Pregunta a tus espectadores: "¿Sabías esto sobre el cerebro humano?!"',
                wildFact: 'HECHO SALVAJE',
                wildFactDescription: '¡Perfecto para iniciar conversación! Pregunta: "¿Quién sabía esto sobre los animales?!"',
                cosmicFact: 'HECHO CÓSMICO',
                cosmicFactDescription: '¡Esto es fuera de este mundo! Pregunta a tus espectadores: "¿Sabías esto sobre el espacio?!"',
                historicalFact: 'HECHO HISTÓRICO',
                historicalFactDescription: '¡Flashback del pasado! Pregunta: "¿Puedes creer que esto pasó en la historia?!"',
                foodFact: 'HECHO DE COMIDA',
                foodFactDescription: '¡Esto te sorprenderá! Pregunta: "¿Sabías esto sobre la comida?!"',
                amazingFact: 'HECHO INCREÍBLE',
                amazingFactDescription: '¡Esto es increíble! Pregunta a tus espectadores: "¿Sabías esto?!"',
                
                // Fact Content Translations
                ruleOfThumb: 'regla del pulgar',
                beaten: 'golpeado',
                wife: 'esposa',
                widerThanThumb: 'más ancho que tu pulgar',
                oldEnglishLaw: 'antigua ley inglesa',
                uniqueViewers: 'Espectadores Únicos',
                messagesSent: 'Mensajes Enviados',
                liveViewerCount: 'Número de espectadores en vivo',
                highestViewerCount: 'Mayor número de espectadores',
                today: 'Hoy',
                
                // Legacy translations
                streamStatus: 'Estado del Stream',
                currentViewers: 'Espectadores Actuales',
                peakViewers: 'Pico de Espectadores',
                totalSubs: 'Total Suscripciones',
                totalFollowers: 'Total Seguidores',
                newFollowers: 'Nuevos Seguidores',
                streamRevenue: 'Ingresos del Stream',
                newSubs: 'Nuevos Subs',
                bitsEarned: 'Bits Ganados',
                raidsReceived: 'Raids Recibidos',
                streamInfo: 'Información del Stream',
                chatSentiment: 'Sentimiento del Chat',
                recentChat: 'Actividad Reciente del Chat',
                topUsers: 'Usuarios Más Comprometidos',
                aiPrompts: 'Prompts Generados por IA',
                liveChatScore: 'Puntuación de Chat en Vivo',
                chatActivity: 'Actividad del Chat'
            },
            de: {
                // Main Dashboard Elements
                liveViewers: 'Live Zuschauer',
                aiCoPilot: 'Dein KI Co-Pilot',
                chatScore: 'Chat Bewertung',
                zeroViewers: 'Null Zuschauer',
                firstViewer: 'Erster Zuschauer!',
                buildingAudience: 'Publikum Aufbauen',
                
                // ABT Coach
                nextPromptIn: 'Nächster Prompt in',
                mute: 'Stumm',
                unmute: 'Ton einschalten',
                
                // Gauge Levels
                quiet: 'Ruhig',
                low: 'Niedrig',
                moderate: 'Moderat',
                high: 'Hoch',
                fire: 'Feuer',
                
                // First Viewer Alert
                firstViewerTitle: 'ERSTER ZUSCHAUER!',
                firstViewerMessage: 'Jemand ist gerade deinem Stream beigetreten!',
                welcomeToStream: 'Willkommen im Stream!',
                close: 'Schließen',
                autoClosingIn: 'Automatisches Schließen in',
                
                // AI Prompt Messages
                keepTalking: 'Sprich weiter! Dein Publikum wird dich finden.',
                firstViewerDetected: '🎉 ERSTER ZUSCHAUER ERKANNT! Begrüße sie herzlich und lass sie sich besonders fühlen. Das ist der Anfang deiner Community!',
                greatViewers: 'Großartig! Du hast Zuschauer. Behalte die Energie mit fesselndem Inhalt, stelle Fragen und baue deine Community auf!',
                aiCoPilotReady: 'Der KI Co-Pilot ist bereit zu helfen!',
                
                // ABT Coach Prompts
                abtGameCommentary: [
                    'Erzähle deine Gedanken laut. Erkläre, warum du diesen Zug machst.',
                    'Was ist deine Strategie für dieses Level/diesen Kampf? Führe uns durch dein Denken.',
                    'Dieser Teil ist knifflig - lass mich erklären, was ich hier versuche zu tun.',
                    'Ich liebe, wie die Entwickler diesen Abschnitt gestaltet haben. Achte auf die Details...',
                    'Wenn ich ein neuer Spieler wäre, würde ich das über dieses Spiel wissen wollen.',
                    'Das erinnert mich an [anderes Spiel] - lass mich die Ähnlichkeiten erklären.',
                    'Ich werde diesmal einen anderen Ansatz versuchen. Schau dir diese Strategie an...',
                    'Die Musik in diesem Bereich ist perfekt für die Atmosphäre. Hör dir das an...',
                    'Ich frage mich, was die Entwickler dachten, als sie diese Mechanik erstellt haben.',
                    'Das ist einer meiner Lieblingsteile des Spiels, weil...'
                ],
                abtPersonalStories: [
                    'Was ist der beste Film, den du kürzlich gesehen hast? Erzähle die Geschichte.',
                    'Teile eine lustige Geschichte aus deiner Kindheit, die sich auf Gaming bezieht.',
                    'Was ist das Peinlichste, was dir beim Streamen passiert ist?',
                    'Erzähl uns von deiner ersten Spielekonsole und deinem Lieblingsspiel aus der Kindheit.',
                    'Was ist der seltsamste Traum, den du über dieses Spiel hattest?',
                    'Teile eine Geschichte über das Treffen eines anderen Streamers oder Gamers im echten Leben.',
                    'Was ist dein epischster Gaming-Fail, über den du jetzt lachen kannst?',
                    'Erzähl uns von einer Zeit, als Gaming dir durch eine schwere Situation geholfen hat.',
                    'Was ist das Lustigste, was dein Haustier gemacht hat, während du gestreamt hast?',
                    'Teile eine Geschichte über dein erstes Mal, dieses Spiel zu spielen - was hat dich überrascht?'
                ],
                abtConversationStarters: [
                    'Wenn du mit einem Spieleentwickler essen gehen könntest, wer wäre es und warum?',
                    'Was ist dein Schuldspiel, das du normalerweise nicht zugibst zu spielen?',
                    'Wenn du dein eigenes Spiel erstellen könntest, worum würde es gehen?',
                    'Was ist das überbewertetste Spiel, das alle lieben, aber du nicht?',
                    'Wenn du in einer Videospielwelt leben könntest, welche würdest du wählen?',
                    'Was ist deine liebste Gaming-Erinnerung aus dem letzten Jahr?',
                    'Wenn du eine Superkraft aus einem Videospiel haben könntest, welche wäre es?',
                    'Was ist das unterschätzteste Spiel, das mehr Leute kennen sollten?',
                    'Wenn du den Entwicklern dieses Spiels eine Frage stellen könntest, welche wäre es?',
                    'Was ist deine Traumkollaboration zwischen zwei verschiedenen Spielfranchises?'
                ],
                abtStreamingTips: [
                    'Neue Streamer fragen mich oft nach [Thema] - hier ist mein Rat...',
                    'Der größte Fehler, den ich beim Streamen gemacht habe, war...',
                    'Wenn ich zurückgehen und meinem vergangenen Ich einen Streaming-Tipp geben könnte, wäre es...',
                    'Das Wichtigste, was ich über den Aufbau einer Community gelernt habe, ist...',
                    'Hier ist, was ich über Streaming-Ausrüstung gewusst hätte, als ich anfing...',
                    'Der beste Rat, den mir jemals ein anderer Streamer gegeben hat, war...',
                    'Wenn du darüber nachdenkst, mit dem Streamen anzufangen, hier ist, was du wissen solltest...',
                    'Der herausforderndste Teil des Streamens für mich war das Lernen...',
                    'Hier ist, wie ich motiviert bleibe, wenn der Chat ruhig ist...',
                    'Das, was mich am meisten am Streamen überrascht hat, war...'
                ],
                abtInteractive: [
                    'Ich bin neugierig - was ist der Lieblingsteil von allen an diesem Spiel bisher?',
                    'Wenn du eine Sache an diesem Spiel ändern könntest, was wäre es?',
                    'Was ist das Kreativste, was du jemanden in diesem Spiel machen gesehen hast?',
                    'Ich werde etwas Neues ausprobieren - was denkst du wird passieren?',
                    'Das ist ein großartiger Ort für einen Screenshot. Die Beleuchtung ist perfekt!',
                    'Ich frage mich, welche Geheimnisse in diesem Bereich versteckt sind. Lass mich erkunden...',
                    'Wenn ich das speedrunnen würde, wäre das die Route, die ich nehmen würde...',
                    'Dieser Erfolg ist knifflig - lass mich dir die Strategie zeigen...',
                    'Ich werde diesen Abschnitt anders als gewöhnlich spielen. Schau dir das an...',
                    'Was ist der befriedigendste Soundeffekt in diesem Spiel? Ich liebe diesen...'
                ],
                
                // Milestones
                first30min: 'Erste 30 Minuten',
                firstHour: 'Erste Stunde',
                firstViewerMilestone: 'Erster Zuschauer',
                first5Viewers: 'Erste 5 Zuschauer',
                firstMessage: 'Erste Chat Nachricht',
                
                // Status
                starting: 'Startend',
                offline: 'Offline',
                online: 'Online',
                notStreaming: 'Nicht am Streamen',
                streaming: 'Am Streamen',
                stable: 'Stabil',
                growing: 'Wachsend',
                declining: 'Abnehmend',
                positive: 'Positiv',
                negative: 'Negativ',
                neutral: 'Neutral',
                
                // Strategy Analytics
                strategicAnalytics: 'Strategisches Analyse-Dashboard',
                strategicView: 'Strategische Ansicht',
                healthScore: 'Gesundheits-Score',
                engagementRate: 'Engagement-Rate',
                retentionRate: 'Retention-Rate',
                growthRate: 'Wachstumsrate',
                viewerGrowth: 'Zuschauer-Wachstum',
                contentQuality: 'Content-Qualität',
                communityHealth: 'Community-Gesundheit',
                streamConsistency: 'Stream-Konsistenz',
                calculatingRecommendations: 'Empfehlungen werden berechnet...',
                
                // Milestones & Gamification
                yourJourneyMilestones: 'Deine Reise-Meilensteine',
                sessionSummary: 'Session-Zusammenfassung',
                milestones: 'Meilensteine',
                first30Minutes: 'Erste 30 Minuten',
                firstHour: 'Erste Stunde',
                firstViewer: 'Erster Zuschauer',
                first5Viewers: 'Erste 5 Zuschauer',
                first10Viewers: 'Erste 10 Zuschauer',
                first25Viewers: 'Erste 25 Zuschauer',
                firstMessage: 'Erste Chat-Nachricht',
                first10Messages: 'Erste 10 Nachrichten',
                first50Messages: 'Erste 50 Nachrichten',
                first100Messages: 'Erste 100 Nachrichten',
                streamStreak3: '3-Tage-Serie',
                streamStreak7: '1-Woche-Serie',
                streamFor30Minutes: '30 Minuten am Stück streamen',
                completeFirstHour: 'Deine erste Stunde Streaming abschließen',
                getFirstViewer: 'Deinen ersten Zuschauer bekommen',
                reach5Viewers: '5 gleichzeitige Zuschauer erreichen',
                reach10Viewers: '10 gleichzeitige Zuschauer erreichen',
                reach25Viewers: '25 gleichzeitige Zuschauer erreichen',
                receiveFirstMessage: 'Deine erste Chat-Nachricht erhalten',
                receive10Messages: '10 Chat-Nachrichten erhalten',
                receive50Messages: '50 Chat-Nachrichten erhalten',
                send100Messages: '100 Nachrichten insgesamt senden',
                stream3ConsecutiveDays: '3 aufeinanderfolgende Tage streamen',
                stream7ConsecutiveDays: '7 aufeinanderfolgende Tage streamen',
                completed: 'ABGESCHLOSSEN',
                
                // AI Intelligence
                aiAnalyzing: 'KI analysiert Nachrichten und Fakten, um deinen nächsten Prompt zu generieren...',
                newsCategory: 'Nachrichten',
                factsCategory: 'Fakten',
                fallbackCategory: 'Fallback',
                apiConfig: 'API-Konfiguration',
                newsApiKey: 'Nachrichten-API-Schlüssel',
                factsApiUrl: 'Fakten-API-URL',
                saveConfig: 'Konfiguration Speichern',
                toggleConfig: 'Config Umschalten',
                
                // AI Prompt Templates
                gamingNewsPrompt: 'Das könnte perfekt für deinen nächsten Stream sein! Was denkst du über diese Entwicklung?',
                techNewsPrompt: 'TECHNOLOGISCHER DURCHBRUCH',
                techNewsDescription: 'Das könnte beeinflussen, wie wir streamen! Hast du so etwas schon mal ausprobiert?',
                entertainmentNewsPrompt: 'UNTERHALTUNGS-UPDATE',
                entertainmentNewsDescription: 'Könnte das Content-Inspiration sein? Was ist deine Meinung dazu?',
                hotTopicPrompt: 'HEISSES THEMA',
                hotTopicDescription: 'Das ist im Trend und perfekt für Diskussionen! Was denkst du?',
                interestingNewsPrompt: 'INTERESSANTE NACHRICHTEN',
                interestingNewsDescription: 'Das hat meine Aufmerksamkeit erregt - was denkst du darüber?',
                
                // Fact Prompt Templates
                mindBlowingFact: 'VERBLÜFFENDER FAKT',
                mindBlowingDescription: 'Frag deine Zuschauer: "Wusstest du das über das menschliche Gehirn?!"',
                wildFact: 'WILDER FAKT',
                wildFactDescription: 'Perfekt für Gesprächsstarter! Frag: "Wer wusste das über Tiere?!"',
                cosmicFact: 'KOSMISCHER FAKT',
                cosmicFactDescription: 'Das ist nicht von dieser Welt! Frag deine Zuschauer: "Wusstest du das über den Weltraum?!"',
                historicalFact: 'HISTORISCHER FAKT',
                historicalFactDescription: 'Blast from the past! Frag: "Kannst du glauben, dass das in der Geschichte passiert ist?!"',
                foodFact: 'ESSENS-FAKT',
                foodFactDescription: 'Das wird dich überraschen! Frag: "Wusstest du das über Essen?!"',
                amazingFact: 'ERSTAUNLICHER FAKT',
                amazingFactDescription: 'Das ist unglaublich! Frag deine Zuschauer: "Wusstest du das?!"',
                
                // Fact Content Translations
                ruleOfThumb: 'Faustregel',
                beaten: 'geschlagen',
                wife: 'Ehefrau',
                widerThanThumb: 'breiter als dein Daumen',
                oldEnglishLaw: 'altes englisches Gesetz',
                uniqueViewers: 'Eindeutige Zuschauer',
                messagesSent: 'Gesendete Nachrichten',
                liveViewerCount: 'Live-Zuschauerzahl',
                highestViewerCount: 'Höchste Zuschauerzahl',
                today: 'Heute',
                
                // Legacy translations
                streamStatus: 'Stream-Status',
                currentViewers: 'Aktuelle Zuschauer',
                peakViewers: 'Höchste Zuschauerzahl',
                totalSubs: 'Gesamte Abonnements',
                totalFollowers: 'Gesamte Follower',
                newFollowers: 'Neue Follower',
                streamRevenue: 'Stream-Einnahmen',
                newSubs: 'Neue Subs',
                bitsEarned: 'Bits Verdient',
                raidsReceived: 'Raids Erhalten',
                streamInfo: 'Stream-Informationen',
                chatSentiment: 'Chat-Stimmung',
                recentChat: 'Aktuelle Chat-Aktivität',
                topUsers: 'Top Engagierte Benutzer',
                aiPrompts: 'KI-Generierte Prompts',
                liveChatScore: 'Live-Chat-Bewertung',
                chatActivity: 'Chat-Aktivität'
            }
        };

        // Zero to One Phase System Functions
        function updatePhase(phase) {
            if (currentPhase === phase) return;
            
            console.log(`🔄 [PHASE] Transitioning from ${currentPhase} to ${phase}`);
            
            const previousPhase = currentPhase;
            currentPhase = phase;
            phaseTransitionTime = Date.now();
            
            // Get dashboard container
            if (!dashboardContainer) {
                dashboardContainer = document.getElementById('dashboard-container');
            }
            
            if (dashboardContainer) {
                // Update main container class for phase-based styling
                dashboardContainer.className = `phase-${phase}`;
            }
            
            // Zero to One Features Integration
            switch (phase) {
                case 'zero_viewers':
                    startABTCoach();
                    document.getElementById('milestonesSection').style.display = 'block';
                    // Initialize Persistence Engine
                    initializePersistenceEngine();
                    break;
                case 'first_viewer':
                    stopABTCoach();
                    if (!firstViewerAlertShown) {
                        showEnhancedFirstViewerAlert(1, 1);
                        firstViewerAlertShown = true;
                    }
                    break;
                case 'building_audience':
                    stopABTCoach();
                hideFirstViewerAlert();
                    document.getElementById('milestonesSection').style.display = 'block';
                    break;
                default:
                    stopABTCoach();
            }
            
            // Update AI prompt area and gauge subtitle
            updateAIPromptArea(phase);
            updateGaugeSubtitle(phase);
            
            console.log(`✅ [PHASE] Successfully transitioned to ${phase}`);
        }
        
        // Update gauge subtitle based on phase
        function updateGaugeSubtitle(phase) {
            const gaugeSubtitle = document.getElementById('gaugeSubtitle');
            if (gaugeSubtitle) {
                switch(phase) {
                    case 'zero_viewers':
                        gaugeSubtitle.textContent = 'Keep Talking!';
                        break;
                    case 'first_viewer':
                        gaugeSubtitle.textContent = 'First Viewer!';
                        break;
                    case 'building_audience':
                        gaugeSubtitle.textContent = 'Building Audience';
                        break;
                    default:
                        gaugeSubtitle.textContent = 'Chat Score';
                }
            }
        }
        
        
        
        function closeFirstViewerAlert() {
            hideFirstViewerAlert();
        }
        
        function updateAIPromptArea(phase, customData = null) {
            const phaseElement = document.getElementById('aiPromptPhase');
            const messageElement = document.getElementById('aiPromptMessage');
            const priorityElement = document.getElementById('aiPromptPriority');
            const categoryElement = document.getElementById('aiPromptCategory');
            const areaElement = document.getElementById('aiPromptAreaEnhanced');
            const aiIndicator = document.getElementById('aiAnalysisIndicator');
            
            if (!phaseElement || !messageElement || !priorityElement || !areaElement) return;
            
            // Update phase indicator
            phaseElement.textContent = phase.replace('_', ' ').toUpperCase();
            
            // Update message and priority based on phase or custom data
            let message, priority, className, category, isAIAnalyzed = false;
            
            if (customData) {
                // Use custom data (from ABT Coach)
                message = customData.message;
                priority = customData.priority || 'high';
                category = customData.category || null;
                className = priority === 'high' ? 'high-priority' : priority === 'urgent' ? 'urgent' : '';
                
                // Check if this is AI-analyzed content
                isAIAnalyzed = customData.relevance !== undefined || customData.engagement !== undefined;
            } else {
                // Use default phase-based messages
            switch (phase) {
                case 'zero_viewers':
                    message = "Keep talking! Even with no visible chat, you never know who might be lurking. Share your thoughts, ask questions, or talk about what you're passionate about!";
                    priority = "high";
                    className = "high-priority";
                    break;
                case 'first_viewer':
                    message = "🎉 FIRST VIEWER DETECTED! Welcome them warmly and make them feel special. This is the start of your community!";
                    priority = "urgent";
                    className = "urgent";
                    break;
                case 'building_audience':
                    message = "Great! You have viewers. Keep the energy up with engaging content, ask questions, and build your community!";
                    priority = "medium";
                    className = "";
                    break;
                default:
                    message = "AI Co-Pilot is ready to help!";
                    priority = "medium";
                    className = "";
                }
            }
            
            messageElement.textContent = message;
            priorityElement.textContent = priority;
            
            // Update category if provided
            if (categoryElement) {
                if (category) {
                    categoryElement.textContent = category.replace(/([A-Z])/g, ' $1').trim();
                    categoryElement.style.display = 'inline-block';
                } else {
                    categoryElement.style.display = 'none';
                }
            }
            
            // Show/hide AI analysis indicator
            if (aiIndicator) {
                if (isAIAnalyzed) {
                    aiIndicator.style.display = 'block';
                } else {
                    aiIndicator.style.display = 'none';
                }
            }
            
            // Update styling
            areaElement.className = `ai-prompt-area-enhanced ai-prompt-card ${className}`;
        }
        
        function updatePhaseFromData(data) {
            console.log('🔄 [PHASE] Checking phase update - Current:', currentPhase, 'Data:', data.streamPhase);
            
            // Check for first viewer detection
            if (data.currentViewerCount > lastViewerCount && data.currentViewerCount >= 1 && data.currentViewerCount <= 5) {
                const viewerName = data.newViewerName || 'New Viewer';
                uniqueViewers.add(viewerName);
                showEnhancedFirstViewerAlert(uniqueViewers.size, 1);
            }
            
            // Update last viewer count
            lastViewerCount = data.currentViewerCount || 0;
            
            // If no streamPhase in data, determine it from viewer count
            let phaseToUse = data.streamPhase;
            if (!phaseToUse) {
                const viewerCount = data.currentViewerCount || 0;
                if (viewerCount === 0) {
                    phaseToUse = 'zero_viewers';
                } else if (viewerCount === 1) {
                    phaseToUse = 'first_viewer';
                } else {
                    phaseToUse = 'building_audience';
                }
                console.log('🔄 [PHASE] No streamPhase in data, determined from viewer count:', phaseToUse);
            }
            
            if (phaseToUse && phaseToUse !== currentPhase) {
                console.log('🔄 [PHASE] Phase change detected, updating...');
                updatePhase(phaseToUse);
            } else {
                console.log('🔄 [PHASE] No phase change needed');
            }
        }
        
        // Test function to manually trigger phase changes (for debugging)
        function testPhaseChange(phase) {
            console.log('🧪 [TEST] Manually triggering phase change to:', phase);
            updatePhase(phase);
        }
        
        // Make test function available globally for debugging
        window.testPhaseChange = testPhaseChange;
        
        function updateEnhancedAIPrompt(data) {
            const messageElement = document.getElementById('aiPromptMessage');
            const priorityElement = document.getElementById('aiPromptPriority');
            const areaElement = document.getElementById('aiPromptAreaEnhanced');
            
            if (!messageElement || !priorityElement || !areaElement) return;
            
            // Get the latest prompt from prompt history
            if (data.promptHistory && data.promptHistory.length > 0) {
                const latestPrompt = data.promptHistory[data.promptHistory.length - 1];
                
                if (latestPrompt && latestPrompt.prompt) {
                    messageElement.textContent = latestPrompt.prompt.message || messageElement.textContent;
                    priorityElement.textContent = latestPrompt.prompt.priority || 'medium';
                    
                    // Update styling based on priority
                    let className = 'ai-prompt-area-enhanced ai-prompt-card';
                    if (latestPrompt.prompt.priority === 'urgent') {
                        className += ' urgent';
                    } else if (latestPrompt.prompt.priority === 'high') {
                        className += ' high-priority';
                    }
                    
                    areaElement.className = className;
                }
            }
        }

        // Initialize WebSocket connection
        function initWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            let wsUrl = `${protocol}//${window.location.host}`;
            
            // Add sessionId to WebSocket URL if available
            if (currentSessionId) {
                wsUrl += `?sessionId=${currentSessionId}`;
            }
            
            console.log('🔌 [WEBSOCKET] Connecting to:', wsUrl);
            ws = new WebSocket(wsUrl);

            ws.onopen = function() {
                console.log('WebSocket connected');
                // Only update status if we're actually connected to a channel
                if (currentChannel) {
                    updateConnectionStatus('connected', `Connected to ${currentChannel}`);
                } else {
                    updateConnectionStatus('disconnected', 'Not Connected');
                }
                reconnectAttempts = 0;
            };

            ws.onmessage = function(event) {
                try {
                    console.log('📨 [WEBSOCKET] Received message:', event.data);
                    const data = JSON.parse(event.data);
                    console.log('📊 [WEBSOCKET] Parsed data:', data);
                    updateDashboard(data);
                } catch (error) {
                    console.error('❌ [WEBSOCKET] Error parsing message:', error);
                    console.error('Raw message:', event.data);
                }
            };

            ws.onclose = function() {
                console.log('WebSocket disconnected');
                updateConnectionStatus('disconnected', 'Disconnected');
                
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    console.log(`Attempting to reconnect... (${reconnectAttempts}/${maxReconnectAttempts})`);
                    setTimeout(initWebSocket, 2000); // Faster reconnection
                } else {
                    console.error('Max reconnection attempts reached');
                    updateConnectionStatus('failed');
                }
            };

            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateConnectionStatus('error');
            };
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('statusText');
            const indicatorElement = document.getElementById('sessionStatus');
            
            switch(status) {
                case 'connected':
                    statusElement.textContent = 'Connected';
                    indicatorElement.className = 'status-indicator status-online';
                    break;
                case 'disconnected':
                    statusElement.textContent = 'Disconnected';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
                case 'connecting':
                    statusElement.textContent = 'Connecting...';
                    indicatorElement.className = 'status-indicator status-connecting';
                    break;
                case 'error':
                    statusElement.textContent = 'Error';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
                case 'failed':
                    statusElement.textContent = 'Connection Failed';
                    indicatorElement.className = 'status-indicator status-offline';
                    break;
            }
        }

        // Toggle strategic view panel
        function toggleStrategicView() {
            const panel = document.getElementById('strategicPanel');
            const button = document.getElementById('strategicToggle');
            
            console.log('🔄 Toggling strategic view panel...');
            console.log('Panel element:', panel);
            console.log('Button element:', button);
            
            if (panel && button) {
                if (panel.classList.contains('visible')) {
                    panel.classList.remove('visible');
                    panel.style.display = 'none';
                    button.textContent = '📊 Strategic View';
                    console.log('✅ Strategic panel hidden');
                } else {
                    panel.classList.add('visible');
                    panel.style.display = 'block';
                    button.textContent = '📊 Hide Strategic';
                    console.log('✅ Strategic panel shown');
                }
            } else {
                console.error('❌ Could not find strategic panel or button elements');
            }
        }


        // Update dashboard with new data
        function updateDashboard(data) {
            console.log('🔄 [DASHBOARD] Updating dashboard with data:', data);
            console.log('🔄 [DASHBOARD] Stream Phase:', data.streamPhase, 'Chat Score:', data.chatScore);
            
            // Update phase system first
            updatePhaseFromData(data);
            
            // Update last update timestamp
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            
            // Update session info
            document.getElementById('sessionId').textContent = data.sessionId ? new Date(data.sessionId).toLocaleTimeString() : 'N/A';
            document.getElementById('channelName').textContent = data.channelName || 'No Channel';
            document.getElementById('streamTopic').textContent = data.streamTitle || 'No Stream';
            
            // Update uptime
            if (data.streamStartTime) {
                const uptime = Date.now() - data.streamStartTime;
                document.getElementById('uptime').textContent = formatUptime(uptime);
            }

            // Update stream status
            const isLive = data.isLive || false;
            document.getElementById('streamStatus').textContent = isLive ? 'Online' : 'Offline';
            document.getElementById('streamStatusText').textContent = isLive ? 'Streaming' : 'Not streaming';
            
            const statusIndicator = document.querySelector('.metric-card .status-indicator');
            if (statusIndicator) {
                statusIndicator.className = `status-indicator ${isLive ? 'status-online' : 'status-offline'}`;
            }
            
            // Update session status based on connection and stream status
            const sessionStatus = document.getElementById('sessionStatus');
            const statusText = document.getElementById('statusText');
            if (data.channelName && data.channelName !== 'No Channel') {
                if (isLive) {
                    sessionStatus.className = 'status-indicator status-connected';
                    statusText.textContent = 'Live & Connected';
                } else {
                    sessionStatus.className = 'status-indicator status-connecting';
                    statusText.textContent = 'Connected (Offline)';
                }
            } else {
                sessionStatus.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Not Connected';
            }

            // Update viewer metrics
            const currentViewers = data.currentViewerCount || 0;
            const peakViewers = data.peakViewerCount || 0;
            const totalSubs = data.totalSubs || 0;
            const sessionSubs = data.sessionSubsGained || 0;
            
            updateMetricValue('currentViewers', formatNumber(currentViewers));
            updateMetricValue('peakViewers', formatNumber(peakViewers));
            updateMetricValue('totalSubsMain', formatNumber(totalSubs));
            
            // Update subs trend
            document.getElementById('subsTrend').textContent = `+${formatNumber(sessionSubs)} this session`;

            // Update viewer trend
            if (lastViewerCount > 0) {
                const change = currentViewers - lastViewerCount;
                const trendElement = document.getElementById('viewerTrend');
                const changeElement = document.getElementById('viewerChange');
                
                if (change > 0) {
                    trendElement.className = 'trend-up';
                    changeElement.textContent = `+${change}`;
                } else if (change < 0) {
                    trendElement.className = 'trend-down';
                    changeElement.textContent = change.toString();
                } else {
                    trendElement.className = 'trend-stable';
                    changeElement.textContent = '0';
                }
            }
            lastViewerCount = currentViewers;

            // Update followers metrics
            const totalFollowers = data.totalFollowers || 0;
            const sessionFollowers = data.sessionFollowersGained || 0;
            
            // Display total followers (from Twitch API)
            updateMetricValue('totalFollowers', formatNumber(totalFollowers));
            document.getElementById('followersTrend').textContent = `+${formatNumber(sessionFollowers)} this session`;
            
            // Update stream total revenue
            let streamTotalRevenue = 0;
            if (data.revenue && data.revenue.total) {
                streamTotalRevenue = data.revenue.total;
            } else {
                // Fallback calculation
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                streamTotalRevenue = bitsValue + subsValue;
            }
            document.getElementById('streamTotalRevenue').textContent = `$${streamTotalRevenue.toFixed(2)}`;
            
            // Update revenue trend (session revenue)
            let sessionRevenue = 0;
            if (data.revenue && data.revenue.breakdown) {
                const sessionBits = (data.sessionBitsEarned || 0) * 0.01;
                const sessionTier1 = (data.sessionTier1Subs || 0) * 2.50;
                const sessionTier2 = (data.sessionTier2Subs || 0) * 5.00;
                const sessionTier3 = (data.sessionTier3Subs || 0) * 12.50;
                sessionRevenue = sessionBits + sessionTier1 + sessionTier2 + sessionTier3;
            } else {
                // Fallback calculation
                const sessionBits = (data.sessionBitsEarned || 0) * 0.01;
                const sessionSubs = (data.sessionSubsGained || 0) * 2.50;
                sessionRevenue = sessionBits + sessionSubs;
            }
            document.getElementById('revenueTrendText').textContent = `$${sessionRevenue.toFixed(2)} this session`;

            // Update Twitch specific metrics
            updateMetricValue('newFollowers', data.sessionFollowersGained || 0);
            updateMetricValue('newSubs', data.sessionSubsGained || 0);
            updateMetricValue('bitsEarned', data.sessionBitsEarned || 0);
            updateMetricValue('raidsReceived', data.sessionRaidsReceived || 0);

            // Update stream information
            document.getElementById('streamTitle').textContent = data.streamTitle || 'No stream';
            document.getElementById('gameCategory').textContent = data.gameCategory || 'Not set';
            document.getElementById('streamLanguage').textContent = data.streamLanguage || 'en';
            
            if (data.streamStartTime) {
                const startTime = new Date(data.streamStartTime);
                document.getElementById('streamStartTime').textContent = startTime.toLocaleTimeString();
            }

            // Update sentiment
            const sentiment = data.rollingSentimentScore || 0;
            document.getElementById('sentimentScore').textContent = sentiment.toFixed(1);
            
            const sentimentEmoji = document.getElementById('sentimentEmoji');
            const sentimentText = document.getElementById('sentimentText');
            
            if (sentiment > 0.5) {
                sentimentEmoji.textContent = '😊';
                sentimentText.textContent = 'Positive';
            } else if (sentiment < -0.5) {
                sentimentEmoji.textContent = '😞';
                sentimentText.textContent = 'Negative';
            } else {
                sentimentEmoji.textContent = '😐';
                sentimentText.textContent = 'Neutral';
            }

            // Update chat messages
            if (data.recentMessages && data.recentMessages.length > 0) {
                updateChatMessages(data.recentMessages);
            }

            // Update top users
            if (data.topEngagedUsers && data.topEngagedUsers.length > 0) {
                updateTopUsers(data.topEngagedUsers);
            }

            // Update AI prompts
            if (data.promptHistory && data.promptHistory.length > 0) {
                updateAIPrompts(data.promptHistory);
            }

            // Update enhanced AI prompt area with latest prompt
            updateEnhancedAIPrompt(data);

            // Update Live Viewers count
            updateLiveViewers(data.currentViewerCount || 0);
            
            // FLAGSHIP FEATURE: First Viewer Catcher Logic
            checkForFirstViewers(data.currentViewerCount || 0);

            // Update chat score gauge - use backend calculated score
            const newChatScore = data.chatScore || calculateChatScore(data);
            updateChatScoreGauge(newChatScore);
            
            // Update revenue metrics
            updateMetricValue('totalBits', formatNumber(data.totalBits || 0));
            updateMetricValue('sessionBits', formatNumber(data.sessionBitsEarned || 0));
            updateMetricValue('totalSubs', formatNumber(data.totalSubs || 0));
            updateMetricValue('sessionSubs', formatNumber(data.sessionSubsGained || 0));
            updateMetricValue('totalRaids', formatNumber(data.totalRaids || 0));
            updateMetricValue('sessionRaids', formatNumber(data.sessionRaidsReceived || 0));
            updateMetricValue('bitsPerMinute', (data.bitsPerMinute || 0).toFixed(1));
            
            // Use accurate revenue calculation from backend
            let totalRevenue = 0;
            let hourlyRate = 0;
            
            if (data.revenue) {
                // Use backend-calculated accurate revenue
                totalRevenue = data.revenue.total;
                
                // Calculate hourly rate if we have stream duration
                if (data.streamStartTime) {
                    const streamDurationHours = (Date.now() - data.streamStartTime) / (1000 * 60 * 60);
                    if (streamDurationHours > 0) {
                        hourlyRate = totalRevenue / streamDurationHours;
                    }
                }
            } else {
                // Fallback to frontend calculation (accurate Twitch rates)
                // Bits: 1 bit = $0.01 USD (streamer receives full value)
                // Subs: Average of Tier 1 ($2.50), Tier 2 ($5.00), Tier 3 ($12.50) = ~$2.50 per sub
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                totalRevenue = bitsValue + subsValue;
                
                if (data.streamStartTime) {
                    const streamDurationHours = (Date.now() - data.streamStartTime) / (1000 * 60 * 60);
                    if (streamDurationHours > 0) {
                        hourlyRate = totalRevenue / streamDurationHours;
                    }
                }
            }
            
            document.getElementById('revenueRate').textContent = `$${hourlyRate.toFixed(2)}/hr`;
            
            // Update revenue breakdown
            if (data.revenue && data.revenue.breakdown) {
                document.getElementById('bitsRevenue').textContent = `$${data.revenue.breakdown.bits.toFixed(2)}`;
                document.getElementById('tier1Revenue').textContent = `$${data.revenue.breakdown.tier1.toFixed(2)}`;
                document.getElementById('tier2Revenue').textContent = `$${data.revenue.breakdown.tier2.toFixed(2)}`;
                document.getElementById('tier3Revenue').textContent = `$${data.revenue.breakdown.tier3.toFixed(2)}`;
                document.getElementById('totalRevenue').textContent = `$${data.revenue.total.toFixed(2)}`;
            } else {
                // Fallback values
                const bitsValue = (data.totalBits || 0) * 0.01;
                const subsValue = (data.totalSubs || 0) * 2.50;
                document.getElementById('bitsRevenue').textContent = `$${bitsValue.toFixed(2)}`;
                document.getElementById('tier1Revenue').textContent = '$0.00';
                document.getElementById('tier2Revenue').textContent = '$0.00';
                document.getElementById('tier3Revenue').textContent = '$0.00';
                document.getElementById('totalRevenue').textContent = `$${(bitsValue + subsValue).toFixed(2)}`;
            }

            // Update strategic view metrics
            updateMetricValue('peakViewersStrategic', formatNumber(peakViewers));
            if (data.streamStartTime) {
                const streamDuration = Date.now() - data.streamStartTime;
                document.getElementById('streamDuration').textContent = formatUptime(streamDuration);
                document.getElementById('streamDurationText').textContent = 'Live now';
            } else {
                document.getElementById('streamDuration').textContent = '00:00:00';
                document.getElementById('streamDurationText').textContent = 'Not live';
            }

            // Update new strategic metrics
            updateMetricValue('healthScore', Math.round(data.healthScore || 0));
            updateMetricValue('predictedRetention', `${Math.round(data.predictedRetention || 0)}%`);
            updateMetricValue('projectedRevenue', `$${(data.projectedRevenue || 0).toFixed(2)}`);
            updateMetricValue('scheduleSuggestion', data.scheduleSuggestion || '--:--');
            
            // Update recommendation texts with color coding
            const healthScore = data.healthScore || 0;
            const healthScoreElement = document.getElementById('healthScoreText');
            if (healthScore >= 70) {
                healthScoreElement.textContent = 'Excellent';
                healthScoreElement.className = 'health-score-excellent';
            } else if (healthScore >= 50) {
                healthScoreElement.textContent = 'Good';
                healthScoreElement.className = 'health-score-good';
            } else {
                healthScoreElement.textContent = 'Needs improvement';
                healthScoreElement.className = 'health-score-poor';
            }
            
            document.getElementById('retentionRec').textContent = data.retentionRec || 'Calculating...';
            document.getElementById('revenueTip').textContent = data.revenueTip || 'Calculating...';
            document.getElementById('scheduleReason').textContent = data.scheduleReason || 'Calculating...';
            document.getElementById('viewerRec').textContent = data.viewerRec || 'Calculating recommendations...';
            document.getElementById('growthRec').textContent = data.growthRec || 'Calculating recommendations...';
        }

        // Update chat messages
        function updateChatMessages(messages) {
            const chatContainer = document.getElementById('chatMessages');
            chatContainer.innerHTML = '';
            
            messages.slice(-10).forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                
                const timestamp = new Date(msg.timestamp || Date.now());
                messageDiv.innerHTML = `
                    <span class="chat-username">${msg.username}:</span>
                    <span class="chat-text">${msg.message}</span>
                    <span class="chat-timestamp">${timestamp.toLocaleTimeString()}</span>
                `;
                
                chatContainer.appendChild(messageDiv);
            });
        }

        // Update top users
        function updateTopUsers(users) {
            const usersContainer = document.getElementById('topUsers');
            usersContainer.innerHTML = '';
            
            users.slice(0, 10).forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div class="user-name">${user.username}</div>
                    <div class="user-stats">
                        <span>Messages: ${user.messages || 0}</span>
                        <span>Bits: ${user.bits || 0}</span>
                        <span>Subs: ${user.subs || 0}</span>
                    </div>
                `;
                usersContainer.appendChild(userDiv);
            });
        }

        // Update AI prompts
        function updateAIPrompts(prompts) {
            const promptsContainer = document.getElementById('aiPrompts');
            const historyContainer = document.getElementById('aiPromptsHistory');
            
            // Update main AI prompts (Tier 2)
            if (promptsContainer) {
                promptsContainer.innerHTML = '';
            prompts.slice(-5).forEach(prompt => {
                const promptDiv = document.createElement('div');
                promptDiv.className = 'prompt-item';
                
                const timestamp = new Date(prompt.timestamp || Date.now());
                    const message = prompt.prompt?.message || 'No message';
                    
                promptDiv.innerHTML = `
                        <div class="prompt-type">${prompt.prompt?.type || 'AI Assistant'}</div>
                        <div class="prompt-message">${message}</div>
                    <div class="prompt-timestamp">${timestamp.toLocaleTimeString()}</div>
                `;
                promptsContainer.appendChild(promptDiv);
            });
            }
            
            // Update AI prompts history (Tier 3)
            if (historyContainer) {
                historyContainer.innerHTML = '';
                prompts.slice(-10).forEach(prompt => {
                    const promptDiv = document.createElement('div');
                    promptDiv.className = 'prompt-item';
                    
                    const timestamp = new Date(prompt.timestamp || Date.now());
                    const message = prompt.prompt?.message || 'No message';
                    
                    promptDiv.innerHTML = `
                        <div class="prompt-type">${prompt.prompt?.type || 'AI Assistant'}</div>
                        <div class="prompt-message">${message}</div>
                        <div class="prompt-timestamp">${timestamp.toLocaleTimeString()}</div>
                    `;
                    historyContainer.appendChild(promptDiv);
                });
            }
        }

        // Set language
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update active button
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the correct button
            const targetButton = document.querySelector(`[onclick="setLanguage('${lang}')"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // Send language preference to server
            fetch('/api/set-language', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ language: lang })
            }).catch(error => {
                console.error('Error setting language:', error);
            });
            
            // Update text content
            updateLanguage();
        }

        // Update language
        function updateLanguage() {
            const t = translations[currentLanguage];
            
            // Update all elements with data-translate attribute
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (t[key]) {
                    // Special handling for elements with dynamic content
                    if (element.id === 'aiPromptPhase') {
                        // Don't translate phase as it's set dynamically
                        return;
                    }
                    if (element.id === 'aiPromptMessage') {
                        // Don't translate AI prompt message as it's set dynamically
                        return;
                    }
                    if (element.id === 'firstViewerMessage' || element.id === 'firstViewerGreeting') {
                        // Don't translate these as they're set dynamically with viewer names
                        return;
                    }
                    if (element.id === 'autoHideCountdown') {
                        // Handle countdown text specially
                        const countdownNumber = element.querySelector('#countdownNumber');
                        if (countdownNumber) {
                            element.innerHTML = t[key] + ' <span id="countdownNumber">' + countdownNumber.textContent + '</span>s';
                        }
                        return;
                    }
                    
                    // Special handling for gauge levels to preserve emojis
                    if (element.classList.contains('gauge-level')) {
                        const emoji = element.getAttribute('data-emoji');
                        if (emoji) {
                            element.textContent = emoji + ' ' + t[key];
                        } else {
                            element.textContent = t[key];
                        }
                        return;
                    }
                    
                    element.textContent = t[key];
                }
            });
            
            // Update ABT Coach timer text
            const timerText = document.querySelector('.abt-timer-text');
            if (timerText && t.nextPromptIn) {
                timerText.textContent = t.nextPromptIn;
            }
            
            // Update mute button text
            const muteButton = document.getElementById('abtMuteToggle');
            if (muteButton) {
                if (muteButton.textContent.includes('Mute')) {
                    muteButton.textContent = '🔊 ' + t.mute;
                } else {
                    muteButton.textContent = '🔊 ' + t.unmute;
                }
            }
            
            // Update gauge status
            const gaugeStatus = document.getElementById('gaugeStatus');
            if (gaugeStatus && t.starting) {
                if (gaugeStatus.textContent === 'Starting') {
                    gaugeStatus.textContent = t.starting;
                }
            }
            
            // Update strategic view button
            const strategicToggle = document.getElementById('strategicToggle');
            if (strategicToggle && t.strategicView) {
                strategicToggle.textContent = '📊 ' + t.strategicView;
            }
            
            // Update strategic panel close button
            const strategicCloseBtn = document.querySelector('#strategicPanel button[onclick="toggleStrategicView()"]');
            if (strategicCloseBtn && t.close) {
                strategicCloseBtn.textContent = '✕ ' + t.close;
            }
            
            // Update "Today" text in strategic panel
            const todayElements = document.querySelectorAll('#peakViewerTime, #peakViewerTimeStrategic');
            todayElements.forEach(element => {
                if (element && t.today) {
                    element.textContent = t.today;
                }
            });
            
            // Update calculating recommendations text
            const calculatingElements = document.querySelectorAll('.recommendation-text');
            calculatingElements.forEach(element => {
                if (element && element.textContent.includes('Calculating recommendations')) {
                    element.textContent = t.calculatingRecommendations;
                }
            });
            
            console.log('🌍 Language updated to:', currentLanguage);
        }

        // Format number with commas
        function formatNumber(num, decimals = 0) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        // Format uptime
        function formatUptime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            return `${hours.toString().padStart(2, '0')}:${(minutes % 60).toString().padStart(2, '0')}:${(seconds % 60).toString().padStart(2, '0')}`;
        }

        // Update metric value with animation
        function updateMetricValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue) {
                element.textContent = newValue;
                element.classList.add('updated');
                setTimeout(() => {
                    element.classList.remove('updated');
                }, 500);
            }
        }

        // Calculate chat score based on activity
        function calculateChatScore(data) {
            const totalMessages = data.totalMessages || 0;
            const viewerCount = data.currentViewerCount || 0;
            const sentiment = data.rollingSentimentScore || 0;
            const streamDuration = data.streamStartTime ? (Date.now() - data.streamStartTime) / (1000 * 60) : 1; // minutes
            
            // Calculate messages per minute for scoring
            const messagesPerMinute = streamDuration > 0 ? totalMessages / streamDuration : 0;
            
            // Base score from message rate (0-50 points)
            let score = Math.min(messagesPerMinute * 2, 50);
            
            // Viewer engagement bonus (0-30 points)
            const engagementRate = viewerCount > 0 ? (messagesPerMinute / viewerCount) * 1000 : 0;
            score += Math.min(engagementRate * 3, 30);
            
            // Sentiment bonus (0-20 points)
            const sentimentBonus = Math.max(0, sentiment + 1) * 10;
            score += Math.min(sentimentBonus, 20);
            
            // Ensure score is between 0 and 100
            return Math.max(0, Math.min(100, Math.round(score)));
        }

        // Update Live Viewers count
        function updateLiveViewers(count) {
            const viewersElement = document.getElementById('viewersCount');
            if (viewersElement) {
                viewersElement.textContent = count;
                viewersElement.style.transition = 'all 0.3s ease';
                viewersElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    viewersElement.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Update chat score gauge
        function updateChatScoreGauge(score) {
            console.log('🎯 Updating clean chat score gauge with score:', score);
            
            // Update gauge score
            const scoreElement = document.getElementById('gaugeScore');
            const statusElement = document.getElementById('gaugeStatus');
            
            // Update score with animation
            if (score !== lastChatScore) {
                if (scoreElement) {
                scoreElement.textContent = score;
                    scoreElement.style.transition = 'all 0.3s ease';
                    scoreElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                        scoreElement.style.transform = 'scale(1)';
                    }, 300);
                }
                
                lastChatScore = score;
            }
            
            // Update status text based on score
            if (statusElement) {
                let status = 'Starting';
                if (score >= 80) status = 'Fire! 🔥';
                else if (score >= 60) status = 'High Energy';
                else if (score >= 40) status = 'Moderate';
                else if (score >= 20) status = 'Low Activity';
                else status = 'Quiet';
                
                statusElement.textContent = status;
            }
            
            // Update gauge levels
            updateGaugeLevels(score);
            
            // Update legacy gauges (if they exist)
            const legacyScoreElement = document.getElementById('chatScore');
            const legacyNeedleElement = document.getElementById('gaugeNeedle');
            const scoreElementStrategic = document.getElementById('chatScoreStrategic');
            const needleElementStrategic = document.getElementById('gaugeNeedleStrategic');
            
            if (legacyScoreElement) {
                legacyScoreElement.textContent = score;
                legacyScoreElement.classList.add('updated');
                setTimeout(() => {
                    legacyScoreElement.classList.remove('updated');
                }, 600);
            }
            
            if (legacyNeedleElement) {
                legacyNeedleElement.style.transform = `rotate(${rotation}deg)`;
            }
            
            if (scoreElementStrategic) {
                scoreElementStrategic.textContent = score;
                scoreElementStrategic.classList.add('updated');
                setTimeout(() => {
                    scoreElementStrategic.classList.remove('updated');
                }, 600);
            }
            
            if (needleElementStrategic) {
                needleElementStrategic.style.transform = `rotate(${rotation}deg)`;
            }
            
            // Update level indicators
            let level = 1;
            
            if (score >= 80) {
                level = 5;
            } else if (score >= 60) {
                level = 4;
            } else if (score >= 40) {
                level = 3;
            } else if (score >= 20) {
                level = 2;
            } else {
                level = 1;
            }
            
            console.log('🎯 Setting active level to:', level);
            
            // Update level indicators - only highlight the current level
            for (let i = 1; i <= 5; i++) {
                const levelElement = document.getElementById(`level${i}`);
                if (levelElement) {
                    if (i === level) {
                        levelElement.classList.add('active');
                        console.log(`✅ Level ${i} set to active`);
                    } else {
                        levelElement.classList.remove('active');
                        console.log(`❌ Level ${i} set to inactive`);
                    }
                } else {
                    console.log(`❌ Level element ${i} not found`);
                }
            }
        }

        // Test function for gauge (for debugging)
        function testGauge() {
            console.log('🧪 Testing gauge with different scores...');
            updateChatScoreGauge(25); // Should be level 2
            setTimeout(() => updateChatScoreGauge(45), 2000); // Should be level 3
            setTimeout(() => updateChatScoreGauge(65), 4000); // Should be level 4
            setTimeout(() => updateChatScoreGauge(85), 6000); // Should be level 5
        }

        // Test SVG gauge specifically
        function testSVGGauge() {
            console.log('🧪 Testing SVG gauge...');
            const progressArc = document.getElementById('gaugeProgressArc');
            if (progressArc) {
                console.log('✅ SVG progress arc found:', progressArc);
                console.log('✅ Current stroke-dasharray:', progressArc.style.strokeDasharray);
                console.log('✅ Current stroke-dashoffset:', progressArc.style.strokeDashoffset);
                
                // Test with different scores
                updateChatScoreGauge(0);
                setTimeout(() => updateChatScoreGauge(25), 1000);
                setTimeout(() => updateChatScoreGauge(50), 2000);
                setTimeout(() => updateChatScoreGauge(75), 3000);
                setTimeout(() => updateChatScoreGauge(100), 4000);
            } else {
                console.error('❌ SVG progress arc not found!');
            }
        }
        
        // Update gauge levels
        function updateGaugeLevels(score) {
            const levels = document.querySelectorAll('.gauge-level');
            const levelThresholds = [0, 20, 40, 60, 80, 100];
            
            levels.forEach((level, index) => {
                const levelValue = levelThresholds[index + 1];
                const isActive = score >= levelThresholds[index] && score < levelValue;
                
                if (isActive) {
                    level.classList.add('active');
                } else {
                    level.classList.remove('active');
                }
            });
        }

        // ===== ZERO TO ONE FEATURES =====

        // AI Intelligence - External API Integration
        async function fetchNews() {
            try {
                const currentTime = Date.now();
                if (cachedNews.length > 0 && (currentTime - lastNewsFetch) < CACHE_DURATION) {
                    return cachedNews;
                }

                // Check if API key is valid
                if (!newsApiKey || newsApiKey === 'your_news_api_key_here' || newsApiKey.length < 10) {
                    console.warn('🚨 NewsAPI key not configured or invalid, using fallback news');
                    return getFallbackNews();
                }

                // Fetch news from multiple relevant categories for streamers
                const categories = ['technology', 'entertainment', 'gaming', 'business'];
                const allNews = [];
                
                for (const category of categories) {
                    try {
                        const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&category=${category}&pageSize=3&apiKey=${newsApiKey}`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.articles) {
                                // Add category tag and AI analysis
                                const processedArticles = data.articles.map(article => ({
                                    ...article,
                                    category: category,
                                    streamerRelevance: analyzeNewsForStreamers(article),
                                    engagementPotential: calculateEngagementPotential(article)
                                }));
                                allNews.push(...processedArticles);
                            }
                        } else if (response.status === 426) {
                            console.warn(`🚨 NewsAPI returned 426 (Upgrade Required) for category ${category}. This usually means the API key is invalid or the account needs to be upgraded.`);
                            // Don't try other categories if we get 426 - the API key is likely invalid
                            break;
                        } else if (response.status === 401) {
                            console.warn(`🚨 NewsAPI returned 401 (Unauthorized) for category ${category}. The API key is invalid.`);
                            break;
                        } else if (response.status === 429) {
                            console.warn(`🚨 NewsAPI returned 429 (Too Many Requests) for category ${category}. Rate limit exceeded.`);
                            break;
                        } else {
                            console.warn(`⚠️ NewsAPI failed for category ${category}:`, response.status, response.statusText);
                        }
                    } catch (catError) {
                        console.log(`⚠️ Failed to fetch ${category} news:`, catError.message);
                    }
                }
                
                // If we got no news from API, use fallback
                if (allNews.length === 0) {
                    console.log('📰 No news from API, using fallback news');
                    return getFallbackNews();
                }
                
                // Sort by streamer relevance and engagement potential
                cachedNews = allNews
                    .filter(article => article.title && article.description)
                    .sort((a, b) => (b.streamerRelevance + b.engagementPotential) - (a.streamerRelevance + a.engagementPotential))
                    .slice(0, 10); // Keep top 10 most relevant articles
                
                lastNewsFetch = currentTime;
                
                console.log('📰 News fetched and analyzed successfully:', cachedNews.length, 'articles');
                return cachedNews;
            } catch (error) {
                console.log('⚠️ News API failed, using fallback:', error.message);
                return getFallbackNews();
            }
        }

        // AI Analysis function for news relevance to streamers
        function analyzeNewsForStreamers(article) {
            const title = (article.title || '').toLowerCase();
            const description = (article.description || '').toLowerCase();
            const content = `${title} ${description}`;
            
            // Keywords that are highly relevant to streamers
            const streamerKeywords = [
                'streaming', 'twitch', 'youtube', 'gaming', 'esports', 'content creator',
                'influencer', 'social media', 'live stream', 'broadcast', 'audience',
                'viewer', 'subscriber', 'follower', 'engagement', 'community',
                'technology', 'software', 'platform', 'app', 'digital', 'online',
                'entertainment', 'media', 'video', 'content', 'creator', 'monetization'
            ];
            
            // Calculate relevance score
            let relevanceScore = 0;
            streamerKeywords.forEach(keyword => {
                if (content.includes(keyword)) {
                    relevanceScore += 1;
                }
            });
            
            // Bonus for gaming and tech news
            if (content.includes('gaming') || content.includes('game')) relevanceScore += 2;
            if (content.includes('technology') || content.includes('tech')) relevanceScore += 1.5;
            if (content.includes('ai') || content.includes('artificial intelligence')) relevanceScore += 2;
            if (content.includes('streaming') || content.includes('stream')) relevanceScore += 3;
            
            return Math.min(relevanceScore, 10); // Cap at 10
        }

        // Calculate engagement potential for news
        function calculateEngagementPotential(article) {
            const title = article.title || '';
            const description = article.description || '';
            
            // Factors that make news more engaging for streamers
            let engagementScore = 0;
            
            // Question words increase engagement
            if (title.includes('?') || description.includes('?')) engagementScore += 2;
            
            // Controversial or trending topics
            const trendingWords = ['new', 'latest', 'breaking', 'trending', 'viral', 'popular'];
            trendingWords.forEach(word => {
                if (title.toLowerCase().includes(word)) engagementScore += 1;
            });
            
            // Numbers and statistics
            if (/\d+/.test(title)) engagementScore += 1;
            
            // Length of content (not too short, not too long)
            const titleLength = title.length;
            if (titleLength > 20 && titleLength < 100) engagementScore += 1;
            
            return Math.min(engagementScore, 5); // Cap at 5
        }

        async function fetchFacts() {
            try {
                const currentTime = Date.now();
                if (cachedFacts.length > 0 && (currentTime - lastFactsFetch) < CACHE_DURATION) {
                    return cachedFacts;
                }

                const response = await fetch(factsApiUrl);
                
                if (!response.ok) {
                    throw new Error('Facts API failed');
                }
                
                const data = await response.json();
                const fact = data.text || data.fact || 'Did you know? The human brain contains approximately 86 billion neurons!';
                
                cachedFacts = [fact];
                lastFactsFetch = currentTime;
                
                console.log('🧠 Fact fetched successfully:', fact);
                return cachedFacts;
            } catch (error) {
                console.log('⚠️ Facts API failed, using fallback:', error.message);
                return getFallbackFacts();
            }
        }

        function getFallbackNews() {
            return [
                {
                    title: "Streaming Technology Advances",
                    description: "New streaming technologies are making it easier for content creators to reach global audiences.",
                    url: "#"
                },
                {
                    title: "Gaming Industry Growth",
                    description: "The gaming industry continues to grow with new platforms and technologies emerging.",
                    url: "#"
                },
                {
                    title: "Social Media Trends",
                    description: "Latest social media trends are changing how people consume content online.",
                    url: "#"
                }
            ];
        }

        function getFallbackFacts() {
            return [
                "Did you know? The human brain contains approximately 86 billion neurons!",
                "Fun fact: Honey never spoils - archaeologists have found edible honey in ancient Egyptian tombs!",
                "Amazing: A group of flamingos is called a 'flamboyance'!",
                "Interesting: The shortest war in history lasted only 38-45 minutes!",
                "Cool fact: Octopuses have three hearts and blue blood!",
                "Did you know? Bananas are berries, but strawberries aren't!",
                "Fun fact: The human body produces 25 million new cells every second!",
                "Amazing: There are more possible games of chess than atoms in the observable universe!",
                "Interesting: A jiffy is an actual unit of time - it's 1/100th of a second!",
                "Cool fact: The human brain uses 20% of the body's total energy!"
            ];
        }

        async function generateIntelligentPrompt() {
            try {
                // Try to get fresh data from APIs
                const [news, facts] = await Promise.all([
                    fetchNews(),
                    fetchFacts()
                ]);

                // Smart selection based on news quality and relevance
                const hasHighQualityNews = news.length > 0 && news.some(article => article.streamerRelevance > 5);
                const useNews = hasHighQualityNews && Math.random() < 0.4; // 40% news if high quality
                
                if (useNews) {
                    // Select the most relevant news article
                    const bestNews = news[0]; // Already sorted by relevance
                    const prompt = generateNewsPrompt(bestNews);
                    return {
                        message: prompt,
                        category: 'news',
                        priority: 'high',
                        relevance: bestNews.streamerRelevance,
                        engagement: bestNews.engagementPotential
                    };
                } else {
                    const randomFact = facts[Math.floor(Math.random() * facts.length)];
                    const prompt = generateFactPrompt(randomFact);
                    return {
                        message: prompt,
                        category: 'facts',
                        priority: 'high'
                    };
                }
            } catch (error) {
                console.log('⚠️ Intelligent prompt generation failed, using fallback:', error.message);
                return getFallbackPrompt();
            }
        }

        // Generate AI-optimized news prompts
        function generateNewsPrompt(article) {
            const t = translations[currentLanguage];
            const category = article.category;
            const title = article.title;
            const description = article.description;
            const relevance = article.streamerRelevance;
            
            // Different prompt styles based on category and relevance
            if (category === 'gaming' && relevance > 7) {
                return `🎮 ${t.newsCategory || 'NEWS'}: "${title}" - ${description} ${t.gamingNewsPrompt || 'This could be perfect for your next stream! What do you think about this development?'}`;
            } else if (category === 'technology' && relevance > 6) {
                return `⚡ ${t.techNewsPrompt || 'TECH BREAKTHROUGH'}: "${title}" - ${description} ${t.techNewsDescription || 'This might affect how we stream! Have you tried anything like this?'}`;
            } else if (category === 'entertainment' && relevance > 5) {
                return `🎬 ${t.entertainmentNewsPrompt || 'ENTERTAINMENT UPDATE'}: "${title}" - ${description} ${t.entertainmentNewsDescription || 'Could this be content inspiration? What\'s your take on this?'}`;
            } else if (relevance > 8) {
                return `🔥 ${t.hotTopicPrompt || 'HOT TOPIC'}: "${title}" - ${description} ${t.hotTopicDescription || 'This is trending and perfect for discussion! What do you think?'}`;
            } else {
                return `📰 ${t.interestingNewsPrompt || 'INTERESTING NEWS'}: "${title}" - ${description} ${t.interestingNewsDescription || 'This caught my attention - what do you think about this?'}`;
            }
        }

        // Generate AI-optimized fact prompts
        function generateFactPrompt(fact) {
            const t = translations[currentLanguage];
            // Analyze fact type and create engaging prompts
            const factLower = fact.toLowerCase();
            
            // Translate the fact content if not in English
            const translatedFact = translateFactContent(fact);
            
            if (factLower.includes('brain') || factLower.includes('mind')) {
                return `🧠 ${t.mindBlowingFact || 'MIND-BLOWING FACT'}: "${translatedFact}" - ${t.mindBlowingDescription || 'Ask your viewers: "Did you know this about the human brain?!"'}`;
            } else if (factLower.includes('animal') || factLower.includes('creature')) {
                return `🐾 ${t.wildFact || 'WILD FACT'}: "${translatedFact}" - ${t.wildFactDescription || 'Perfect conversation starter! Ask: "Who knew this about animals?!"'}`;
            } else if (factLower.includes('space') || factLower.includes('universe')) {
                return `🌌 ${t.cosmicFact || 'COSMIC FACT'}: "${translatedFact}" - ${t.cosmicFactDescription || 'This is out of this world! Ask your viewers: "Did you know this about space?!"'}`;
            } else if (factLower.includes('history') || factLower.includes('ancient')) {
                return `🏛️ ${t.historicalFact || 'HISTORICAL FACT'}: "${translatedFact}" - ${t.historicalFactDescription || 'Blast from the past! Ask: "Can you believe this happened in history?!"'}`;
            } else if (factLower.includes('food') || factLower.includes('eat')) {
                return `🍕 ${t.foodFact || 'FOOD FACT'}: "${translatedFact}" - ${t.foodFactDescription || 'This will surprise you! Ask: "Did you know this about food?!"'}`;
            } else {
                return `🤯 ${t.amazingFact || 'AMAZING FACT'}: "${translatedFact}" - ${t.amazingFactDescription || 'This is incredible! Ask your viewers: "Did you know this?!"'}`;
            }
        }

        // Translate fact content based on current language
        function translateFactContent(fact) {
            const t = translations[currentLanguage];
            
            // If already in English or no translation available, return as is
            if (currentLanguage === 'en' || !t.factTranslations) {
                return fact;
            }
            
            // Try to find a translation for this specific fact
            const factKey = fact.toLowerCase().replace(/[^a-z0-9\s]/g, '').substring(0, 50);
            if (t.factTranslations[factKey]) {
                return t.factTranslations[factKey];
            }
            
            // If no specific translation, try to translate common patterns
            let translatedFact = fact;
            
            // Common fact patterns that can be translated
            if (fact.includes('rule of thumb')) {
                translatedFact = fact.replace('rule of thumb', t.ruleOfThumb || 'règle du pouce');
            }
            if (fact.includes('beaten')) {
                translatedFact = translatedFact.replace('beaten', t.beaten || 'battu');
            }
            if (fact.includes('wife')) {
                translatedFact = translatedFact.replace('wife', t.wife || 'épouse');
            }
            if (fact.includes('wider than your thumb')) {
                translatedFact = translatedFact.replace('wider than your thumb', t.widerThanThumb || 'plus large que votre pouce');
            }
            if (fact.includes('old English law')) {
                translatedFact = translatedFact.replace('old English law', t.oldEnglishLaw || 'ancienne loi anglaise');
            }
            
            return translatedFact;
        }

        function getFallbackPrompt() {
            const fallbackPrompts = [
                "Chat is quiet! Share a personal story about your favorite game or streaming moment!",
                "No one chatting? Ask your viewers what their favorite game genre is!",
                "Silent chat? Try talking about your streaming setup or what you're planning to play next!",
                "Quiet moment? Share a fun fact about the game you're playing!",
                "No messages? Ask your viewers about their weekend plans or hobbies!",
                "Silent chat? Try discussing your favorite streaming memories or funny moments!",
                "Quiet time? Share what inspired you to start streaming!",
                "No one talking? Ask about your viewers' favorite streamers or content creators!",
                "Silent moment? Discuss your streaming goals or what you're working on!",
                "Quiet chat? Share a tip about gaming or streaming that you've learned!"
            ];
            
            const randomPrompt = fallbackPrompts[Math.floor(Math.random() * fallbackPrompts.length)];
            return {
                message: randomPrompt,
                category: 'fallback',
                priority: 'high'
            };
        }

        // ABT Coach Functions - Enhanced for Zero Viewers
        function startABTCoach() {
            console.log('🎯 Starting ABT Coach for zero viewers');
            const timerContainer = document.getElementById('abtTimerContainer');
            const timerDisplay = document.getElementById('abtTimerDisplay');
            const muteToggle = document.getElementById('abtMuteToggle');
            
            if (timerContainer) {
                timerContainer.style.display = 'flex';
            }
            
            if (muteToggle) {
                muteToggle.addEventListener('click', toggleABTMute);
            }
            
            // Start 30-second timer
            abtTimer = 30;
            if (timerDisplay) {
                timerDisplay.textContent = abtTimer;
            }
            
            // Enhanced ABT logic with zero viewer detection
            abtInterval = setInterval(() => {
                // Check if we still have zero viewers
                const currentViewers = parseInt(document.getElementById('viewersCount')?.textContent || '0');
                const timeSinceLastMessage = Date.now() - lastMessageTime;
                
                // Only trigger if: zero viewers AND (no messages in 30+ seconds OR timer reached 0)
                if (currentViewers === 0 && (timeSinceLastMessage > 30000 || abtTimer <= 0)) {
                    // Use intelligent prompts instead of old static prompts
                    triggerIntelligentABTPrompt();
                    abtTimer = 30; // Reset timer
                    if (timerDisplay) {
                        timerDisplay.textContent = abtTimer;
                    }
                } else if (currentViewers > 0) {
                    // If viewers arrive, pause the timer but don't stop completely
                    console.log('👥 Viewers detected, pausing ABT timer');
                    return;
                }
                
                // Only decrement if we haven't just reset
                if (abtTimer > 0) {
                    abtTimer--;
                    if (timerDisplay) {
                        timerDisplay.textContent = abtTimer;
                    }
                }
            }, 1000);
        }

        function stopABTCoach() {
            console.log('🛑 Stopping ABT Coach');
            const timerContainer = document.getElementById('abtTimerContainer');
            
            if (abtInterval) {
                clearInterval(abtInterval);
                abtInterval = null;
            }
            
            if (timerContainer) {
                timerContainer.style.display = 'none';
            }
        }

        function toggleABTMute() {
            abtMuted = !abtMuted;
            const muteToggle = document.getElementById('abtMuteToggle');
            
            if (muteToggle) {
                if (abtMuted) {
                    muteToggle.textContent = '🔇 Muted';
                    muteToggle.classList.add('muted');
                } else {
                    muteToggle.textContent = '🔊 Mute';
                    muteToggle.classList.remove('muted');
                }
            }
        }

        // New intelligent ABT prompt function
        async function triggerIntelligentABTPrompt() {
            if (abtMuted) return;
            
            // Check cooldown to prevent rapid-fire prompts
            const currentTime = Date.now();
            if (currentTime - lastPromptTime < promptCooldown) {
                console.log('⏰ ABT Prompt on cooldown, skipping...');
                return;
            }
            
            console.log('🤖 Generating intelligent ABT prompt...');
            
            try {
                // Try to generate intelligent prompt with real-time data
                const intelligentPrompt = await generateIntelligentPrompt();
                
                console.log('💬 Intelligent ABT Prompt triggered:', intelligentPrompt.message, 'Category:', intelligentPrompt.category);
                
                // Update last prompt time
                lastPromptTime = currentTime;
                
                updateAIPromptArea('zero_viewers', {
                    message: intelligentPrompt.message,
                    priority: intelligentPrompt.priority,
                    category: intelligentPrompt.category,
                    relevance: intelligentPrompt.relevance,
                    engagement: intelligentPrompt.engagement
                });
                
            } catch (error) {
                console.log('⚠️ Intelligent prompt failed, using fallback:', error.message);
                
                // Fallback to traditional prompts
                const t = translations[currentLanguage];
                const translatedPrompts = {
                    gameCommentary: t.abtGameCommentary || abtPrompts.gameCommentary,
                    personalStories: t.abtPersonalStories || abtPrompts.personalStories,
                    conversationStarters: t.abtConversationStarters || abtPrompts.conversationStarters,
                    streamingTips: t.abtStreamingTips || abtPrompts.streamingTips,
                    interactive: t.abtInteractive || abtPrompts.interactive
                };
                
                // Get a random prompt from a random category
                const categories = Object.keys(translatedPrompts);
                const randomCategory = categories[Math.floor(Math.random() * categories.length)];
                const categoryPrompts = translatedPrompts[randomCategory];
                const randomPrompt = categoryPrompts[Math.floor(Math.random() * categoryPrompts.length)];
                
                console.log('💬 Fallback ABT Prompt triggered:', randomPrompt, 'Category:', randomCategory);
                
                // Update last prompt time
                lastPromptTime = currentTime;
                
                updateAIPromptArea('zero_viewers', {
                    message: randomPrompt,
                    priority: 'high',
                    category: randomCategory
                });
            }
        }

        // Keep old function for backward compatibility
        async function triggerABTPrompt() {
            return triggerIntelligentABTPrompt();
        }

        // PERSISTENCE ENGINE FUNCTIONS - Emotional Support & Validation
        function initializePersistenceEngine() {
            console.log('💪 Initializing Persistence Engine...');
            persistenceEngine.sessionData.startTime = Date.now();
            persistenceEngine.sessionData.totalStreamTime = 0;
            persistenceEngine.sessionData.milestonesReached = 0;
            
            // Initialize milestones display
            initializeMilestones();
            
            // Start milestone checking interval
            setInterval(checkMilestones, 30000); // Check every 30 seconds
            
            console.log('✅ Persistence Engine initialized');
        }

        function checkMilestones() {
            const currentTime = Date.now();
            const streamDuration = Math.floor((currentTime - persistenceEngine.sessionData.startTime) / 60000); // minutes
            const currentViewers = parseInt(document.getElementById('viewersCount').textContent) || 0;
            
            // Check time-based milestones
            checkTimeMilestones(streamDuration);
            
            // Check viewer-based milestones
            checkViewerMilestones(currentViewers);
            
            // Update session data
            updateSessionData(streamDuration, currentViewers);
        }

        function checkTimeMilestones(streamDuration) {
            const timeMilestones = [30, 60, 120, 180]; // minutes
            
            timeMilestones.forEach(minutes => {
                if (streamDuration >= minutes && !persistenceEngine.milestones.streamTime[minutes]) {
                    persistenceEngine.milestones.streamTime[minutes] = true;
                    showMilestoneCelebration('time', minutes);
                    persistenceEngine.sessionData.milestonesReached++;
                    milestonesReached++;
                    updateStreamSummary();
                }
            });
        }

        function checkViewerMilestones(currentViewers) {
            const viewerMilestones = [1, 5, 10, 25];
            
            viewerMilestones.forEach(count => {
                if (currentViewers >= count && !persistenceEngine.milestones.viewers[count]) {
                    persistenceEngine.milestones.viewers[count] = true;
                    showMilestoneCelebration('viewers', count);
                    persistenceEngine.sessionData.milestonesReached++;
                    milestonesReached++;
                    updateStreamSummary();
                }
            });
        }

        function showMilestoneCelebration(type, value) {
            console.log(`🎉 Milestone reached: ${type} - ${value}`);
            
            let message = '';
            let icon = '';
            
            if (type === 'time') {
                const timeText = value >= 60 ? `${Math.floor(value/60)} hour${Math.floor(value/60) > 1 ? 's' : ''}` : `${value} minutes`;
                message = getRandomEncouragement('timeBased', { time: timeText });
                icon = '⏰';
            } else if (type === 'viewers') {
                message = getRandomEncouragement('viewerBased', { count: value });
                icon = '👥';
            }
            
            // Show milestone notification
            showMilestoneNotification(icon, message);
        }

        function getRandomEncouragement(category, data) {
            const messages = persistenceEngine.encouragementMessages[category];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            // Replace placeholders with actual data
            return randomMessage.replace(/\{(\w+)\}/g, (match, key) => data[key] || match);
        }

        function showMilestoneNotification(icon, message) {
            // Create milestone notification element
            const notification = document.createElement('div');
            notification.className = 'milestone-notification';
            notification.innerHTML = `
                <div class="milestone-content">
                    <div class="milestone-icon">${icon}</div>
                    <div class="milestone-message">${message}</div>
                    <div class="milestone-close">✕</div>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Show animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto-hide after 8 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 8000);
            
            // Close button functionality
            notification.querySelector('.milestone-close').addEventListener('click', () => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            });
        }

        function updateSessionData(streamDuration, currentViewers) {
            persistenceEngine.sessionData.totalStreamTime = streamDuration;
            persistenceEngine.sessionData.peakViewers = Math.max(persistenceEngine.sessionData.peakViewers, currentViewers);
            persistenceEngine.sessionData.uniqueViewersToday = uniqueViewers.size;
            persistenceEngine.sessionData.totalMessages = messagesSent;
            
            // Calculate engagement rate (messages per minute)
            if (streamDuration > 0) {
                persistenceEngine.sessionData.engagementRate = (messagesSent / streamDuration).toFixed(2);
            }
        }

        function generateStreamSummary() {
            const data = persistenceEngine.sessionData;
            const t = translations[currentLanguage];
            
            let summary = `
                <div class="stream-summary">
                    <h3>📊 Stream Summary - You Did Great!</h3>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="stat-value">${data.totalStreamTime} min</div>
                            <div class="stat-label">Total Stream Time</div>
                        </div>
                        <div class="summary-stat">
                            <div class="stat-value">${data.peakViewers}</div>
                            <div class="stat-label">Peak Viewers</div>
                        </div>
                        <div class="summary-stat">
                            <div class="stat-value">${data.uniqueViewersToday}</div>
                            <div class="stat-label">Unique Viewers</div>
                        </div>
                        <div class="summary-stat">
                            <div class="stat-value">${data.milestonesReached}</div>
                            <div class="stat-label">Milestones Reached</div>
                        </div>
                    </div>
                    <div class="encouragement-message">
                        ${generateEncouragementMessage(data)}
                    </div>
                </div>
            `;
            
            return summary;
        }

        function generateEncouragementMessage(data) {
            const messages = [];
            
            // Time-based encouragement
            if (data.totalStreamTime >= 30) {
                messages.push(getRandomEncouragement('timeBased', { time: `${data.totalStreamTime} minutes` }));
            }
            
            // Viewer-based encouragement
            if (data.uniqueViewersToday > 0) {
                messages.push(getRandomEncouragement('viewerBased', { count: data.uniqueViewersToday }));
            }
            
            // Engagement-based encouragement
            if (data.engagementRate > 0) {
                messages.push(getRandomEncouragement('engagementBased', { time: data.engagementRate }));
            }
            
            // Always include resilience message
            messages.push(getRandomEncouragement('resilience', {}));
            
            return messages.join('<br><br>');
        }

        // First Viewer Catcher Functions - FLAGSHIP FEATURE
        // Global variable to track auto-hide timeout
        let overlayAutoHideTimeout = null;
        let firstViewerThreshold = 5; // Detect first few viewers (1-4)
        let firstViewerDetected = false;
        let viewerJoinTimes = []; // Track when viewers join

        // FLAGSHIP FEATURE: Enhanced First Viewer Detection
        function checkForFirstViewers(currentViewerCount) {
            // Detect viewer increase (new viewers joining)
            if (currentViewerCount > lastViewerCount && currentViewerCount <= firstViewerThreshold) {
                const newViewers = currentViewerCount - lastViewerCount;
                const timestamp = Date.now();
                
                // Track join times for better detection
                viewerJoinTimes.push(timestamp);
                
                // Clean old join times (older than 30 seconds)
                viewerJoinTimes = viewerJoinTimes.filter(time => timestamp - time < 30000);
                
                console.log(`🎯 First Viewer Catcher: ${newViewers} new viewer(s) detected! Total: ${currentViewerCount}`);
                
                // Show enhanced first viewer alert
                showEnhancedFirstViewerAlert(currentViewerCount, newViewers);
                
                // Update phase if this is the very first viewer
                if (currentViewerCount === 1 && !firstViewerDetected) {
                    firstViewerDetected = true;
                    updatePhase('first_viewer');
                }
            }
            
            // Reset detection if viewers drop to zero
            if (currentViewerCount === 0) {
                firstViewerDetected = false;
                viewerJoinTimes = [];
            }
            
            lastViewerCount = currentViewerCount;
        }

        function generatePersonalizedGreetings(totalViewers, newViewers) {
            const t = translations[currentLanguage];
            
            if (totalViewers === 1) {
                return [
                    {
                        message: "🎯 ACTION REQUIRED: Your first viewer just joined! This is your moment to shine!",
                        greeting: "💬 SAY: 'Welcome to the stream! What brought you here today?'"
                    },
                    {
                        message: "🚀 CRITICAL MOMENT: First viewer detected! Make them feel special and valued!",
                        greeting: "💬 SAY: 'Hey there! Thanks for being my first viewer today! What's your name?'"
                    },
                    {
                        message: "⚡ ZERO TO ONE: Your first viewer is here! Engage them immediately!",
                        greeting: "💬 ASK: 'Welcome! I'm so glad you're here. What games do you like to watch?'"
                    },
                    {
                        message: "🎉 BREAKTHROUGH: First viewer joined! This is the start of your community!",
                        greeting: "💬 SAY: 'Welcome! You're my first viewer today - let's make this awesome!'"
                    }
                ];
            } else if (totalViewers <= 3) {
                return [
                    {
                        message: `🔥 MOMENTUM: You now have ${totalViewers} viewers! Keep the energy flowing!`,
                        greeting: "💬 SAY: 'Welcome everyone! Thanks for joining the stream! How's everyone doing?'"
                    },
                    {
                        message: `⚡ GROWTH: ${newViewers} more viewer(s) just joined! Build that community!`,
                        greeting: "💬 ASK: 'Hey new people! What brought you here today? Let's chat!'"
                    },
                    {
                        message: `🎯 ENGAGEMENT: ${totalViewers} viewers watching! Keep them engaged!`,
                        greeting: "💬 ASK: 'What should we play next? I want to hear your suggestions!'"
                    }
                ];
            } else {
                return [
                    {
                        message: `🚀 SUCCESS: Your community is growing - ${totalViewers} viewers now!`,
                        greeting: "💬 SAY: 'Welcome to all the new people! Great to have you here!'"
                    },
                    {
                        message: `⚡ MOMENTUM: ${newViewers} more viewer(s) joined! Keep the energy up!`,
                        greeting: "💬 SAY: 'Thanks for the support everyone! What do you want to see next?'"
                    }
                ];
            }
        }

        function showEnhancedFirstViewerAlert(totalViewers, newViewers) {
            console.log('🎉 ENHANCED First viewer detected!', { totalViewers, newViewers });
            const alert = document.getElementById('firstViewerAlert');
            const message = document.getElementById('firstViewerMessage');
            const greeting = document.getElementById('firstViewerGreeting');
            
            if (alert && message && greeting) {
                // Clear any existing timeout
                if (overlayAutoHideTimeout) {
                    clearTimeout(overlayAutoHideTimeout);
                    overlayAutoHideTimeout = null;
                }
                
                // Generate highly personalized and actionable greetings
                const personalizedGreetings = generatePersonalizedGreetings(totalViewers, newViewers);
                const randomGreeting = personalizedGreetings[Math.floor(Math.random() * personalizedGreetings.length)];
                
                // Update message with actionable content
                message.textContent = randomGreeting.message;
                greeting.textContent = randomGreeting.greeting;
                
                // Add visual emphasis for flagship feature
                alert.style.animation = 'firstViewerCelebration 3s ease-in-out, urgentPulse 1s infinite';
                alert.style.border = '3px solid #ff6b6b';
                alert.style.boxShadow = '0 0 30px rgba(255, 107, 107, 0.8)';
                
                // Show the alert
                alert.classList.add('show');
                
                // Setup button handlers
                setupOverlayButtons();
                
                // Enhanced countdown with visual feedback
                showEnhancedCountdown();
                
                // Trigger confetti effect
                triggerConfettiEffect();
                
                // Auto-hide after 5 seconds
                overlayAutoHideTimeout = setTimeout(() => {
                    console.log('⏰ Auto-hiding enhanced overlay after 5 seconds');
                    hideFirstViewerAlert();
                }, 5000);
                
                console.log('✅ Enhanced first viewer alert shown - FLAGSHIP FEATURE');
            } else {
                console.log('❌ First viewer alert elements not found');
            }
        }

        function showEnhancedCountdown() {
            const countdownElement = document.getElementById('autoHideCountdown');
            const countdownNumber = document.getElementById('countdownNumber');
            
            if (countdownElement && countdownNumber) {
                countdownElement.style.display = 'block';
                countdownElement.style.background = 'rgba(255, 107, 107, 0.2)';
                countdownNumber.textContent = '5';
                countdownElement.style.border = '1px solid #ff6b6b';
                countdownElement.style.borderRadius = '10px';
                countdownElement.style.padding = '8px 12px';
                
                let countdown = 5;
                countdownNumber.textContent = countdown;
                countdownNumber.style.color = '#ff6b6b';
                countdownNumber.style.fontWeight = 'bold';
                
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownNumber.textContent = countdown;
                    
                    // Change color as countdown approaches zero
                    if (countdown <= 3) {
                        countdownNumber.style.color = '#ff4757';
                        countdownElement.style.background = 'rgba(255, 71, 87, 0.3)';
                    }
                    
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
                
                // Auto-hide after 8 seconds (longer for flagship feature)
                overlayAutoHideTimeout = setTimeout(() => {
                    console.log('⏰ Auto-hiding enhanced overlay after 8 seconds');
                    clearInterval(countdownInterval);
                    hideFirstViewerAlert();
                }, 8000);
            }
        }

        function triggerConfettiEffect() {
            // Enhanced confetti for flagship feature
            const confettiElements = document.querySelectorAll('.confetti');
            confettiElements.forEach((confetti, index) => {
                confetti.style.animation = `confettiFall ${2 + index * 0.5}s linear infinite`;
                confetti.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
            });
        }

        function showFirstViewerAlert(viewerName = 'New Viewer') {
            console.log('🎉 First viewer detected:', viewerName);
            const alert = document.getElementById('firstViewerAlert');
            const message = document.getElementById('firstViewerMessage');
            const greeting = document.getElementById('firstViewerGreeting');
            
            if (alert) {
                // Clear any existing timeout
                if (overlayAutoHideTimeout) {
                    clearTimeout(overlayAutoHideTimeout);
                    overlayAutoHideTimeout = null;
                }
                
                // Update message with actual username
                if (message) {
                    message.textContent = `${viewerName} just joined your stream!`;
                }
                
                // Generate personalized greeting
                if (greeting) {
                    const greetings = [
                        `Welcome ${viewerName}! Thanks for joining!`,
                        `Hey ${viewerName}! You're my first viewer today!`,
                        `Welcome to the stream, ${viewerName}! Glad you're here!`,
                        `${viewerName}, you just made my day! Welcome!`,
                        `First viewer alert! Welcome ${viewerName}!`
                    ];
                    
                    const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
                    greeting.textContent = randomGreeting;
                }
                
                alert.classList.add('show');
                
                // Setup button handlers
                setupOverlayButtons();
                
                // Show countdown and start auto-hide
                const countdown = document.getElementById('autoHideCountdown');
                const countdownNumber = document.getElementById('countdownNumber');
                
                if (countdown) {
                    countdown.style.display = 'block';
                }
                
                let countdownValue = 5;
                if (countdownNumber) {
                    countdownNumber.textContent = countdownValue;
                }
                
                // Start countdown
                const countdownInterval = setInterval(() => {
                    countdownValue--;
                    if (countdownNumber) {
                        countdownNumber.textContent = countdownValue;
                    }
                    if (countdownValue <= 0) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
                
                // Auto-hide after 5 seconds
                overlayAutoHideTimeout = setTimeout(() => {
                    console.log('⏰ Auto-hiding overlay after 5 seconds');
                    clearInterval(countdownInterval);
                    hideFirstViewerAlert();
                }, 5000);
            }
        }

        function hideFirstViewerAlert() {
            const alert = document.getElementById('firstViewerAlert');
            const countdown = document.getElementById('autoHideCountdown');
            
            if (alert) {
                alert.classList.remove('show');
                console.log('✅ First viewer alert hidden');
                
                // Hide countdown
                if (countdown) {
                    countdown.style.display = 'none';
                }
                
                // Clear auto-hide timeout
                if (overlayAutoHideTimeout) {
                    clearTimeout(overlayAutoHideTimeout);
                    overlayAutoHideTimeout = null;
                    console.log('⏰ Auto-hide timeout cleared');
                }
            }
        }


        // Add event listeners for buttons
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 Setting up first viewer alert button handlers');
            setupOverlayButtons();
        });

        // Setup overlay button handlers
        function setupOverlayButtons() {
            const closeBtn = document.getElementById('closeAlertBtn');
            
            if (closeBtn) {
                // Remove any existing event listeners
                closeBtn.replaceWith(closeBtn.cloneNode(true));
                const newCloseBtn = document.getElementById('closeAlertBtn');
                
                // Add click event listener
                newCloseBtn.addEventListener('click', function() {
                    console.log('✕ Close button clicked');
                    hideFirstViewerAlert();
                });
                
                // Also add onclick as backup
                newCloseBtn.onclick = function() {
                    console.log('✕ Close button clicked (onclick)');
                    hideFirstViewerAlert();
                };
                
                console.log('✅ Close button event listeners attached');
            } else {
                console.log('❌ Close button not found');
            }
        }

        // Persistence Engine Functions
        function initializeMilestones() {
            const milestonesGrid = document.getElementById('milestonesGrid');
            if (!milestonesGrid) return;
            
            milestonesGrid.innerHTML = '';
            const t = translations[currentLanguage];
            
            milestones.forEach(milestone => {
                const milestoneCard = document.createElement('div');
                milestoneCard.className = 'milestone-card';
                milestoneCard.id = `milestone-${milestone.id}`;
                
                const isCompleted = localStorage.getItem(`milestone_${milestone.id}`) === 'true';
                if (isCompleted) {
                    milestoneCard.classList.add('completed');
                }
                
                const progress = getMilestoneProgress(milestone);
                const progressPercent = Math.min(Math.round((progress / milestone.threshold) * 100), 100);
                
                const milestoneName = t[milestone.nameKey] || milestone.nameKey;
                const milestoneDescription = t[milestone.descriptionKey] || milestone.descriptionKey;
                const completedText = t.completed || 'COMPLETED';
                
                milestoneCard.innerHTML = `
                    <div class="milestone-header">
                        <span class="milestone-icon">${milestone.icon}</span>
                        <span class="milestone-name">${milestoneName}</span>
                    </div>
                    <div class="milestone-progress">
                        <div class="milestone-progress-bar">
                            <div class="milestone-progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="milestone-progress-text">${progressPercent}%</div>
                    </div>
                    <div class="milestone-description">${milestoneDescription}</div>
                    ${isCompleted ? `<div class="milestone-badge">${completedText}</div>` : ''}
                `;
                
                milestonesGrid.appendChild(milestoneCard);
            });
        }

        function getMilestoneProgress(milestone) {
            switch (milestone.type) {
                case 'time':
                    const streamDuration = Math.floor((Date.now() - persistenceEngine.sessionData.startTime) / 60000);
                    return Math.min(streamDuration, milestone.threshold);
                case 'viewers':
                    const currentViewers = parseInt(document.getElementById('viewersCount')?.textContent || '0');
                    return Math.min(currentViewers, milestone.threshold);
                case 'messages':
                    return Math.min(messagesSent, milestone.threshold);
                case 'streak':
                    return getStreamingStreak();
                default:
                    return 0;
            }
        }

        function getStreamingStreak() {
            // This would typically be stored in localStorage or backend
            return parseInt(localStorage.getItem('streaming_streak') || '0');
        }

        function checkMilestones() {
            milestones.forEach(milestone => {
                const isCompleted = localStorage.getItem(`milestone_${milestone.id}`) === 'true';
                if (!isCompleted) {
                    const progress = getMilestoneProgress(milestone);
                    if (progress >= milestone.threshold) {
                        completeMilestone(milestone);
                    }
                }
            });
        }

        function completeMilestone(milestone) {
            console.log('🏆 Milestone completed:', milestone.name);
            localStorage.setItem(`milestone_${milestone.id}`, 'true');
            milestonesReached++;
            
            // Update UI
            const milestoneCard = document.getElementById(`milestone-${milestone.id}`);
            if (milestoneCard) {
                milestoneCard.classList.add('completed');
                milestoneCard.innerHTML += '<div class="milestone-badge">COMPLETED</div>';
            }
            
            // Show celebration
            showMilestoneCelebration(milestone);
            
            // Update summary
            updateStreamSummary();
        }

        function showMilestoneCelebration(milestone) {
            // Create temporary celebration element
            const celebration = document.createElement('div');
            celebration.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #4ecdc4, #9146ff);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                text-align: center;
                z-index: 10000;
                font-size: 1.2rem;
                font-weight: 700;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;
            celebration.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${milestone.icon}</div>
                <div>Milestone Unlocked!</div>
                <div style="font-size: 1.5rem; margin-top: 0.5rem;">${milestone.name}</div>
            `;
            
            document.body.appendChild(celebration);
            
            // Remove after 3 seconds
            setTimeout(() => {
                document.body.removeChild(celebration);
            }, 3000);
        }

        function updateStreamSummary() {
            const totalStreamTimeEl = document.getElementById('totalStreamTime');
            const uniqueViewersEl = document.getElementById('uniqueViewers');
            const messagesSentEl = document.getElementById('messagesSent');
            const milestonesReachedEl = document.getElementById('milestonesReached');
            
            if (totalStreamTimeEl) {
                const streamDuration = Math.floor((Date.now() - persistenceEngine.sessionData.startTime) / 60000);
                totalStreamTimeEl.textContent = streamDuration + 'm';
            }
            if (uniqueViewersEl) {
                uniqueViewersEl.textContent = uniqueViewers.size;
            }
            if (messagesSentEl) {
                messagesSentEl.textContent = messagesSent;
            }
            if (milestonesReachedEl) {
                milestonesReachedEl.textContent = milestonesReached;
            }
            
            // Update milestone cards
            updateMilestoneCards();
        }
        
        function updateMilestoneCards() {
            const t = translations[currentLanguage];
            
            milestones.forEach(milestone => {
                const milestoneCard = document.getElementById(`milestone-${milestone.id}`);
                if (milestoneCard) {
                    const isCompleted = getMilestoneStatus(milestone);
                    const progress = getMilestoneProgress(milestone);
                    const progressPercent = Math.min(Math.round((progress / milestone.threshold) * 100), 100);
                    
                    const milestoneName = t[milestone.nameKey] || milestone.nameKey;
                    const milestoneDescription = t[milestone.descriptionKey] || milestone.descriptionKey;
                    const completedText = t.completed || 'COMPLETED';
                    
                    milestoneCard.innerHTML = `
                        <div class="milestone-icon">${milestone.icon}</div>
                        <div class="milestone-content">
                            <div class="milestone-name">${milestoneName}</div>
                            <div class="milestone-description">${milestoneDescription}</div>
                            <div class="milestone-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <span class="progress-text">${progressPercent}%</span>
                            </div>
                        </div>
                        ${isCompleted ? `<div class="milestone-badge">${completedText}</div>` : ''}
                    `;
                }
            });
        }
        
        function getMilestoneStatus(milestone) {
            if (milestone.type === 'time') {
                const streamDuration = Math.floor((Date.now() - persistenceEngine.sessionData.startTime) / 60000);
                return streamDuration >= milestone.threshold;
            } else if (milestone.type === 'viewers') {
                const currentViewers = parseInt(document.getElementById('viewersCount')?.textContent || '0');
                return currentViewers >= milestone.threshold;
            }
            return false;
        }
        

        // Stream time tracking
        function startStreamTimeTracking() {
            setInterval(() => {
                streamTime++;
                checkMilestones();
                updateStreamSummary();
            }, 1000);
        }

        // API Configuration Functions
        function toggleApiConfig() {
            const configElement = document.getElementById('apiConfig');
            if (configElement) {
                const isVisible = configElement.style.display !== 'none';
                configElement.style.display = isVisible ? 'none' : 'block';
            }
        }

        function saveApiConfig() {
            const newsApiKeyInput = document.getElementById('newsApiKey');
            const factsApiUrlInput = document.getElementById('factsApiUrl');
            
            if (newsApiKeyInput) {
                newsApiKey = newsApiKeyInput.value || 'YOUR_NEWS_API_KEY';
                localStorage.setItem('newsApiKey', newsApiKey);
            }
            
            if (factsApiUrlInput) {
                factsApiUrl = factsApiUrlInput.value || 'https://uselessfacts.jsph.pl/random.json?language=en';
                localStorage.setItem('factsApiUrl', factsApiUrl);
            }
            
            console.log('✅ API configuration saved');
            alert('API configuration saved successfully!');
            
            // Hide config panel
            toggleApiConfig();
        }

        function loadApiConfig() {
            const savedNewsApiKey = localStorage.getItem('newsApiKey');
            const savedFactsApiUrl = localStorage.getItem('factsApiUrl');
            
            if (savedNewsApiKey) {
                newsApiKey = savedNewsApiKey;
                const newsApiKeyInput = document.getElementById('newsApiKey');
                if (newsApiKeyInput) {
                    newsApiKeyInput.value = savedNewsApiKey;
                }
            }
            
            if (savedFactsApiUrl) {
                factsApiUrl = savedFactsApiUrl;
                const factsApiUrlInput = document.getElementById('factsApiUrl');
                if (factsApiUrlInput) {
                    factsApiUrlInput.value = savedFactsApiUrl;
                }
            }
        }

        // Quick test function for immediate gauge testing
        function testGaugeNow(score = 85) {
            console.log('🧪 Testing BULLETPROOF gauge immediately with score:', score);
            
            // Debug gauge visibility with inline styles
            const gaugeContainer = document.querySelector('.chat-score-gauge-enhanced');
            const gaugeScore = document.getElementById('gaugeScoreEnhanced');
            const gaugeNeedle = document.getElementById('gaugeNeedleEnhanced');
            
            console.log('🔍 BULLETPROOF Gauge Debug Info:');
            console.log('- Gauge Container:', gaugeContainer);
            console.log('- Gauge Score Element:', gaugeScore);
            console.log('- Gauge Needle Element:', gaugeNeedle);
            
            if (gaugeContainer) {
                console.log('- Container computed style:', window.getComputedStyle(gaugeContainer));
                console.log('- Container display:', window.getComputedStyle(gaugeContainer).display);
                console.log('- Container visibility:', window.getComputedStyle(gaugeContainer).visibility);
            }
            
            if (gaugeScore) {
                console.log('- Score element found:', gaugeScore);
                console.log('- Score text:', gaugeScore.textContent);
                console.log('- Score computed style:', window.getComputedStyle(gaugeScore));
            }
            
            if (gaugeNeedle) {
                console.log('- Needle element found:', gaugeNeedle);
                console.log('- Needle computed style:', window.getComputedStyle(gaugeNeedle));
            }
            
            updateChatScoreGauge(score);
        }

        // Force gauge to show on desktop
        function forceGaugeDisplay() {
            console.log('🔧 Forcing gauge display...');
            const container = document.querySelector('.circular-gauge-container');
            const ring = document.querySelector('.gauge-ring');
            const center = document.querySelector('.gauge-center');
            const score = document.getElementById('gaugeScoreEnhanced');
            const needle = document.getElementById('gaugeNeedleEnhanced');
            
            if (container) {
                container.style.display = 'block';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                container.style.width = '250px';
                container.style.height = '250px';
            }
            
            if (ring) {
                ring.style.display = 'flex';
                ring.style.visibility = 'visible';
                ring.style.opacity = '1';
                ring.style.width = '250px';
                ring.style.height = '250px';
                ring.style.borderRadius = '50%';
                ring.style.background = 'conic-gradient(from -90deg, #ff4444 0deg, #ff8800 30deg, #ffdd00 60deg, #88ff88 90deg, #00ddff 120deg, #8844ff 150deg, #ff44ff 180deg, #ff4444 270deg, #ff4444 360deg)';
            }
            
            if (center) {
                center.style.display = 'flex';
                center.style.visibility = 'visible';
                center.style.opacity = '1';
            }
            
            if (score) {
                score.style.display = 'block';
                score.style.visibility = 'visible';
                score.style.opacity = '1';
            }
            
            if (needle) {
                needle.style.display = 'block';
                needle.style.visibility = 'visible';
                needle.style.opacity = '1';
            }
            
            console.log('✅ Gauge display forced');
        }

        // Make test functions globally available
        window.testGauge = testGauge;
        window.testGaugeNow = testGaugeNow;
        // Test function for modern gauge visibility
        function testModernGauge() {
            console.log('🔍 Testing modern gauge visibility...');
            const gauge = document.getElementById('chatScoreGaugeEnhanced');
            const container = document.querySelector('.modern-gauge-container');
            const outerRing = document.querySelector('.gauge-outer-ring');
            const progressRing = document.querySelector('.gauge-progress-ring');
            const progressFill = document.querySelector('.gauge-progress-fill');
            const score = document.getElementById('gaugeScoreEnhanced');

            console.log('Gauge elements found:');
            console.log('- Gauge container:', !!gauge);
            console.log('- Modern container:', !!container);
            console.log('- Outer ring:', !!outerRing);
            console.log('- Progress ring:', !!progressRing);
            console.log('- Progress fill:', !!progressFill);
            console.log('- Score element:', !!score);

            // Test gauge update
            if (progressFill) {
                console.log('Testing gauge update...');
                updateChatScoreGauge(75);
            }
        }

        // Force gauge visibility function
        function forceGaugeVisibility() {
            console.log('🔧 Forcing gauge visibility...');
            const gauge = document.getElementById('chatScoreGaugeEnhanced');
            const container = document.querySelector('.modern-gauge-container');
            const outerRing = document.querySelector('.gauge-outer-ring');
            const innerRing = document.querySelector('.gauge-inner-ring');
            const progressRing = document.querySelector('.gauge-progress-ring');
            const progressFill = document.querySelector('.gauge-progress-fill');
            const score = document.getElementById('gaugeScoreEnhanced');
            const status = document.getElementById('gaugeStatus');

            // Force visibility with inline styles
            if (gauge) {
                gauge.style.display = 'flex';
                gauge.style.visibility = 'visible';
                gauge.style.opacity = '1';
                gauge.style.zIndex = '10';
            }

            if (container) {
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
            }

            if (outerRing) {
                outerRing.style.display = 'block';
                outerRing.style.visibility = 'visible';
                outerRing.style.opacity = '1';
            }

            if (innerRing) {
                innerRing.style.display = 'flex';
                innerRing.style.visibility = 'visible';
                innerRing.style.opacity = '1';
            }

            if (progressRing) {
                progressRing.style.display = 'block';
                progressRing.style.visibility = 'visible';
                progressRing.style.opacity = '1';
            }

            if (progressFill) {
                progressFill.style.display = 'block';
                progressFill.style.visibility = 'visible';
                progressFill.style.opacity = '1';
            }

            if (score) {
                score.style.display = 'block';
                score.style.visibility = 'visible';
                score.style.opacity = '1';
            }

            if (status) {
                status.style.display = 'block';
                status.style.visibility = 'visible';
                status.style.opacity = '1';
            }

            console.log('✅ Gauge visibility forced');
            
            // Test with a score
            updateChatScoreGauge(50);
        }

        window.testGaugeVisibility = testGaugeVisibility;
        window.forceGaugeDisplay = forceGaugeDisplay;
        window.testSVGGauge = testSVGGauge;
        window.testModernGauge = testModernGauge;
        window.forceGaugeVisibility = forceGaugeVisibility;
        
        // Test first viewer alert
        window.testFirstViewerAlert = function() {
            console.log('🧪 Testing first viewer alert...');
            showEnhancedFirstViewerAlert(1, 1);
        };

        // Test First Viewer Catcher - FLAGSHIP FEATURE
        window.testFirstViewerCatcher = function() {
            console.log('🎯 Testing First Viewer Catcher - FLAGSHIP FEATURE');
            // Simulate viewer count increase
            const currentCount = parseInt(document.getElementById('viewersCount').textContent) || 0;
            const newCount = currentCount + 1;
            
            // Update viewer count
            document.getElementById('viewersCount').textContent = newCount;
            
            // Trigger first viewer detection
            checkForFirstViewers(newCount);
            
            console.log(`✅ Simulated viewer increase: ${currentCount} → ${newCount}`);
        };

        // Test multiple viewers joining
        window.testMultipleViewers = function() {
            console.log('🎯 Testing Multiple Viewers - FLAGSHIP FEATURE');
            const currentCount = parseInt(document.getElementById('viewersCount').textContent) || 0;
            const newCount = currentCount + 2; // Simulate 2 viewers joining
            
            document.getElementById('viewersCount').textContent = newCount;
            checkForFirstViewers(newCount);
            
            console.log(`✅ Simulated multiple viewers: ${currentCount} → ${newCount}`);
        };

        // Test Persistence Engine - Milestone Celebrations
        window.testPersistenceEngine = function() {
            console.log('💪 Testing Persistence Engine...');
            initializePersistenceEngine();
            
            // Simulate 30-minute milestone
            setTimeout(() => {
                showMilestoneCelebration('time', 30);
            }, 1000);
            
            // Simulate 5 viewers milestone
            setTimeout(() => {
                showMilestoneCelebration('viewers', 5);
            }, 3000);
            
            console.log('✅ Persistence Engine test initiated');
        };

        // Test Stream Summary
        window.testStreamSummary = function() {
            console.log('📊 Testing Stream Summary...');
            
            // Update session data for testing
            persistenceEngine.sessionData.totalStreamTime = 45;
            persistenceEngine.sessionData.peakViewers = 8;
            persistenceEngine.sessionData.uniqueViewersToday = 12;
            persistenceEngine.sessionData.totalMessages = 25;
            persistenceEngine.sessionData.engagementRate = 0.56;
            persistenceEngine.sessionData.milestonesReached = 3;
            
            const summary = generateStreamSummary();
            console.log('Stream Summary:', summary);
            
            // Show summary in a modal or alert
            const summaryDiv = document.createElement('div');
            summaryDiv.innerHTML = summary;
            summaryDiv.style.position = 'fixed';
            summaryDiv.style.top = '50%';
            summaryDiv.style.left = '50%';
            summaryDiv.style.transform = 'translate(-50%, -50%)';
            summaryDiv.style.zIndex = '10003';
            summaryDiv.style.maxWidth = '600px';
            summaryDiv.style.maxHeight = '80vh';
            summaryDiv.style.overflow = 'auto';
            summaryDiv.style.background = 'rgba(0, 0, 0, 0.9)';
            summaryDiv.style.padding = '2rem';
            summaryDiv.style.borderRadius = '20px';
            summaryDiv.style.border = '2px solid #4ecdc4';
            
            document.body.appendChild(summaryDiv);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                summaryDiv.remove();
            }, 10000);
            
            console.log('✅ Stream Summary test completed');
        };
        
        // Test live viewers update
        window.testLiveViewers = function(count = 5) {
            console.log('🧪 Testing live viewers update...');
            updateLiveViewers(count);
        };
        
        // Test gauge visibility function
        function testGaugeVisibility() {
            console.log('🔍 Testing gauge visibility...');
            const gauge = document.getElementById('chatScoreGaugeEnhanced');
            const container = document.querySelector('.circular-gauge-container');
            const ring = document.querySelector('.gauge-ring');
            const center = document.querySelector('.gauge-center');
            const score = document.getElementById('gaugeScoreEnhanced');
            const needle = document.getElementById('gaugeNeedleEnhanced');
            
            console.log('Gauge elements found:');
            console.log('- Main gauge:', gauge);
            console.log('- Container:', container);
            console.log('- Ring:', ring);
            console.log('- Center:', center);
            console.log('- Score:', score);
            console.log('- Needle:', needle);
            
            if (gauge) {
                const styles = window.getComputedStyle(gauge);
                console.log('Gauge computed styles:');
                console.log('- Display:', styles.display);
                console.log('- Visibility:', styles.visibility);
                console.log('- Opacity:', styles.opacity);
                console.log('- Z-index:', styles.zIndex);
            }
            
            // Test with a score update
            if (score) {
                updateChatScoreGauge(75);
                console.log('✅ Gauge test completed - score updated to 75');
            }
        }

        // Channel connection functionality
        let isConnecting = false;
        let currentChannel = '';

        function updateConnectionStatus(status, text) {
            const statusElement = document.getElementById('connectionStatus');
            const textElement = document.getElementById('connectionText');
            const connectBtn = document.getElementById('connectBtn');
            const connectBtnText = document.getElementById('connectBtnText');
            
            statusElement.className = `status-${status}`;
            textElement.textContent = text;
            
            if (status === 'connecting') {
                connectBtn.disabled = true;
                connectBtnText.textContent = 'Connecting...';
            } else if (status === 'connected') {
                connectBtn.disabled = false;
                connectBtnText.textContent = 'Disconnect';
            } else {
                connectBtn.disabled = false;
                connectBtnText.textContent = 'Connect';
            }
        }

        async function connectToChannel() {
            const channelInput = document.getElementById('channelInput');
            const channel = channelInput.value.trim().toLowerCase();
            
            if (!channel) {
                alert('Please enter a Twitch channel name');
                return;
            }
            
            if (isConnecting) return;
            
            isConnecting = true;
            updateConnectionStatus('connecting', 'Connecting...');
            
            // Add timeout to prevent stuck "connecting" status
            const connectionTimeout = setTimeout(() => {
                if (isConnecting) {
                    isConnecting = false;
                    updateConnectionStatus('disconnected', 'Connection timeout');
                    alert('Connection timeout. Please try again.');
                }
            }, 15000); // 15 second timeout
            
            try {
                const response = await fetch('/api/connect-channel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ channel: channel })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    clearTimeout(connectionTimeout);
                    currentChannel = channel;
                    currentSessionId = result.sessionId; // Store the session ID
                    updateConnectionStatus('connected', `Connected to ${channel}`);
                    document.getElementById('channelName').textContent = channel;
                    
                    console.log('🔗 [SESSION] Connected to session:', currentSessionId);
                    
                    // Reconnect WebSocket to get new data
                    if (ws) {
                        ws.close();
                    }
                    initWebSocket();
                } else {
                    clearTimeout(connectionTimeout);
                    updateConnectionStatus('disconnected', `Failed: ${result.error}`);
                    alert(`Failed to connect to channel: ${result.error}`);
                }
            } catch (error) {
                clearTimeout(connectionTimeout);
                console.error('Connection error:', error);
                updateConnectionStatus('disconnected', 'Connection failed');
                alert('Failed to connect to channel. Please try again.');
            } finally {
                isConnecting = false;
            }
        }

        async function disconnectFromChannel() {
            try {
                console.log('🔄 [DISCONNECT] Attempting to disconnect - currentSessionId:', currentSessionId);
                
                const response = await fetch('/api/disconnect-channel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sessionId: currentSessionId })
                });
                
                if (response.ok) {
                    currentChannel = '';
                    currentSessionId = null; // Clear the session ID
                    updateConnectionStatus('disconnected', 'Not Connected');
                    document.getElementById('channelName').textContent = 'Not Connected';
                    
                    console.log('🔗 [SESSION] Disconnected from session');
                    
                    // Close WebSocket
                    if (ws) {
                        ws.close();
                    }
                }
            } catch (error) {
                console.error('Disconnect error:', error);
            }
        }

        // Initialize phased UI system
        function initializePhasedUI() {
            console.log('🎯 [PHASE] Initializing phased UI system...');
            
            // Get dashboard container
            dashboardContainer = document.getElementById('dashboard-container');
            
            if (dashboardContainer) {
                // Set initial phase
                dashboardContainer.className = 'phase-zero_viewers';
                currentPhase = 'zero_viewers';
                
                // Initialize gauge subtitle
                updateGaugeSubtitle('zero_viewers');
                
                // Force show milestones section for zero_viewers phase
                const milestonesSection = document.getElementById('milestonesSection');
                if (milestonesSection) {
                    milestonesSection.style.display = 'block';
                    console.log('✅ [PHASE] Milestones section shown for zero_viewers phase');
                }
                
                // Initialize Persistence Engine
                initializePersistenceEngine();
                
                console.log('✅ [PHASE] Phased UI initialized - starting with zero_viewers phase');
            } else {
                console.error('❌ [PHASE] Dashboard container not found!');
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Twitch Dashboard initialized');
            
            // Load API configuration
            loadApiConfig();
            
            // Initialize phased UI system
            initializePhasedUI();
            
            // Initialize Zero to One features
            initializeMilestones();
            startStreamTimeTracking();
            
            // Initialize AI Intelligence with first prompt
            setTimeout(async () => {
                try {
                    const intelligentPrompt = await generateIntelligentPrompt();
                    updateAIPromptArea('zero_viewers', {
                        message: intelligentPrompt.message,
                        priority: intelligentPrompt.priority,
                        category: intelligentPrompt.category
                    });
                } catch (error) {
                    console.log('⚠️ Initial AI prompt failed, using fallback');
                }
            }, 2000);
            
            // Force gauge display on desktop
            setTimeout(() => {
                forceGaugeDisplay();
            }, 1000);
            
            // Set default values
            document.getElementById('sessionId').textContent = 'Not Started';
            document.getElementById('channelName').textContent = 'No Channel';
            
            // Initialize strategic view panel
            const strategicPanel = document.getElementById('strategicPanel');
            const strategicToggle = document.getElementById('strategicToggle');
            
            if (strategicPanel && strategicToggle) {
                console.log('✅ Strategic view elements found and initialized');
                strategicPanel.style.display = 'none';
                strategicToggle.textContent = '📊 Strategic View';
            } else {
                console.error('❌ Strategic view elements not found');
            }
            
            // Channel input event listeners
            const channelInput = document.getElementById('channelInput');
            const connectBtn = document.getElementById('connectBtn');
            const connectBtnText = document.getElementById('connectBtnText');
            
            connectBtn.addEventListener('click', function() {
                if (currentChannel) {
                    disconnectFromChannel();
                } else {
                    connectToChannel();
                }
            });
            
            channelInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !currentChannel) {
                    connectToChannel();
                }
            });
            
            // Initialize connection status
            updateConnectionStatus('disconnected', 'Not Connected');
            
            // Set initial button state
            connectBtn.disabled = false;
            connectBtnText.textContent = 'Connect';
            document.getElementById('uptime').textContent = '00:00:00';
            
            // Test gauge on load
            setTimeout(() => {
                console.log('🧪 Starting gauge test...');
                testGauge();
            }, 1000);
            
            initWebSocket();
            updateLanguage();
            
            // Update uptime every second
            setInterval(() => {
                const uptime = Date.now() - sessionStartTime;
                document.getElementById('uptime').textContent = formatUptime(uptime);
            }, 1000);
        });

        // Test Intelligent AI Prompts
        window.testIntelligentPrompts = async function() {
            console.log('🤖 Testing Intelligent AI Prompts...');
            try {
                const intelligentPrompt = await generateIntelligentPrompt();
                console.log('✅ Intelligent prompt generated:', intelligentPrompt);
                
                updateAIPromptArea('zero_viewers', {
                    message: intelligentPrompt.message,
                    priority: intelligentPrompt.priority,
                    category: intelligentPrompt.category
                });
            } catch (error) {
                console.error('❌ Intelligent prompt test failed:', error);
            }
        };

        // Test API Configuration
        window.testApiConfig = function() {
            console.log('⚙️ Testing API Configuration...');
            toggleApiConfig();
        };

        // Test NewsAPI Status
        window.testNewsApiStatus = async function() {
            console.log('🔍 Testing NewsAPI Status...');
            
            if (!newsApiKey || newsApiKey === 'your_news_api_key_here') {
                console.log('❌ NewsAPI key not configured');
                return;
            }
            
            try {
                const response = await fetch(`https://newsapi.org/v2/top-headlines?country=us&category=technology&pageSize=1&apiKey=${newsApiKey}`);
                console.log('📊 NewsAPI Response Status:', response.status, response.statusText);
                
                if (response.status === 426) {
                    console.log('🚨 NewsAPI Error 426: Upgrade Required - Your API key may be invalid or account needs upgrade');
                } else if (response.status === 401) {
                    console.log('🚨 NewsAPI Error 401: Unauthorized - API key is invalid');
                } else if (response.status === 429) {
                    console.log('🚨 NewsAPI Error 429: Too Many Requests - Rate limit exceeded');
                } else if (response.ok) {
                    console.log('✅ NewsAPI is working correctly');
                } else {
                    console.log('⚠️ NewsAPI returned unexpected status:', response.status);
                }
            } catch (error) {
                console.log('❌ NewsAPI test failed:', error.message);
            }
        };

        // Test Gamification Features
        window.testGamification = function() {
            console.log('🏆 Testing Gamification Features...');
            
            // Force show milestones section
            const milestonesSection = document.getElementById('milestonesSection');
            if (milestonesSection) {
                milestonesSection.style.display = 'block';
                console.log('✅ Milestones section shown');
            } else {
                console.log('❌ Milestones section not found');
            }
            
            // Force initialize milestones
            initializeMilestones();
            
            // Test milestone completion
            setTimeout(() => {
                const testMilestone = milestones[0]; // First milestone
                if (testMilestone) {
                    completeMilestone(testMilestone);
                    console.log('✅ Test milestone completed:', testMilestone.name);
                }
            }, 1000);
        };

        // Show Current Phase Status
        window.showPhaseStatus = function() {
            console.log('📊 Current Phase Status:');
            console.log('- Current Phase:', currentPhase);
            console.log('- Dashboard Container Class:', document.getElementById('dashboard-container')?.className);
            console.log('- Milestones Section Display:', document.getElementById('milestonesSection')?.style.display);
            console.log('- Milestones Grid Children:', document.getElementById('milestonesGrid')?.children.length);
            console.log('- Persistence Engine Initialized:', persistenceEngine ? 'Yes' : 'No');
        };
    </script>
</body>
</html>